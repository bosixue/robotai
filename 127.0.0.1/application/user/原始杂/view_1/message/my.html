{extend name="public/base" /}
{block name="body"}
<style type="text/css">

	.form-group .col-lg-10.col-sm-10 {
		padding-top: 7px;
	}


	.imgclass > td > p>img{
	  width:50px;
	}

	.statusSelect {
	    line-height: 30px;
	    float: left;
	}
	.navbar{
	    margin-bottom: 8px;
	}

	.classifyBox>span {
	    display: inline-block;
	    padding: 6px 12px;
	    border-radius: 4px;
	    background: #fff;
	    font-size: 14px;
	    margin-right: 10px;
	    border: 1px solid rgb(0, 166, 90);
	    color: rgb(0, 166, 90);
	    margin-bottom: 10px;
	    cursor: pointer;
	    transition: all 1s cubic-bezier(.215,.61,.355,1);
	}
	.n_panel_title img{
		vertical-align: sub;
		margin-right:8px;
	}
  .n_panel_title i {
    font-size: 20px;
  }
	.c_selectimg {
	  background: url(/public/img_sj/jiantou.png) 94% 50% no-repeat;
	}
	.resetSel {
	  background-clip: padding-box;
	  border-color: #e0e3e4;
	  color: #404040;
	  appearance: none;
	  -webkit-appearance: none;
	  -moz-appearance: none;
	}

	.l-padding{
		padding:7px 0px!important;
	}
</style>
<div class="row">
<div class="col-lg-12">
	<div class="main-box clearfix fadeInRight animated pz_manping_height">
		<header class="main-box-header n_head_box n_head_box_b clearfix">
		  <div class="pull-left">
			  <span class="n_panel_title"><img src="/public/img/pz_xiaoxi.png"/>我的消息</span>
		  </div>
			<button class="btn btn-primary pull-right" data-title="批量删除我的消息" onclick="popTipswin(this);" target-form="ids" style="padding: 4px 24px;">批量删除</button>
		</header>


		<div class="main-box-body clearfix">
	        <section class="navbar main-box-header l-padding clearfix">
              <input type="hidden" name="typelevel" id="typelevel" value="" />
						<div class="pull-left">
								 <form class="form-inline">
											<div class="form-group">
													<label class="statusSelect">消息状态：</label>
													<select style="width:160px;" name="status" id="status" class="form-control c_selectimg resetSel">
														<option value="" selected="">全部</option>
														<option value="0">未读</option>
														<option value="1">已读</option>
													</select>
										 </div>&nbsp;
										 <div class="btn btn-primary" onclick="show_data();">搜索</div>
								</form>
						</div>
					</section>
		    <table class="table table-bordered table-hover">
				<thead>
					<tr>
						<th class="text-center"><input class="check-all" name='all_checked' type="checkbox"/></th>
						<th class="text-center">序号</th>
						<th class="text-center">标题</th>
						<th class="text-center">发布时间</th>
						<th class="text-center">状态</th>

						<th class="text-center">操作</th>
					</tr>
				</thead>
          <tbody id="tablepagelist">
				</tbody>
			</table>
			<div class="component-page-empty" id="consumeempty">
				<div class="empty-tip line">暂无数据</div>
			</div>
			<footer class="main-box-footer clearfix pz-fenye">
				<div class="pull-left margintop">
          <input class="ppzrolecheck all_checked_count"  type="checkbox"/>全选（已选中<span id='user_count'>0</span>个消息）</div>
        <div class="text-right pull-right">
        	<div class="paging clearfix">
        	</div>
        </div>
			</footer>
		</div>
	</div>
</div>

<style type="text/css">
	.textwidth{
		  width:250px;
	}
	.add_yuyin{height:.85rem;border-top:1px solid #e5e5e5;margin-left:.28rem;line-height: .85rem;width:100%;;float:left;}
	.luzhiyy{position:relative;font-size:.3rem;color:#666}
	.luzhiyy::after{position:absolute;right:.25rem;top:.28rem;width:.3rem;height:.3rem;content:"";background:url("../images/icon.png") no-repeat -5.78rem -3.59rem;background-size:14.57rem 4.86rem;}
	.luzhiyy s{display: inline-block;width:.48rem;height:.48rem;background:url("../images/icon.png") no-repeat -5.59rem -2.86rem;background-size:14.57rem 4.86rem;vertical-align: middle;margin-right:.24rem;}
	.tijaobtn{width:90%;height:.8rem;background-color:#f16461;text-align: center;line-height: .8rem;color:#fff;margin:0rem auto;display: block;border-radius: 6px;font-size:.3rem;}
	.tijaobtn[disabled]{background-color:#f4cac9;}
	.r_yuyin{color:#999999;height:.4rem;line-height:.4rem;padding:0 .1rem;    background-color: #95ce73;
	    border: 1px solid #368e42;border-radius: 6px;max-width: 75%;min-width: 18%;position: relative;float:right;}
	.r_yuyin s{width:.4rem;height:.4rem;position:absolute;right:.2rem;top:.09rem;background:url("../images/icon.png") no-repeat -7.11rem -3.62rem;background-size:14.57rem 4.86rem;}
	 .deleteicon{width:.55rem;height:.5rem;background:url("../images/icon.png") no-repeat -6.17rem -3.41rem;background-size:14.57rem 4.86rem;margin-top:.12rem;margin-left:.1rem;float:left;}

	.luyin_dialog{position: absolute;z-index: 500;top:0;left:0;bottom:0;right:0;background: url("../images/luyinbg.jpg") no-repeat center center;background-size: cover;display: none;}
	.r_yuyin i{    float: right;
	    color: #ffffff;
	    font-size: 21px;
	    font-weight: 600;
		}
	.header_img {
	   font-size:30px;
	}
	.audio-c{
	 width: 100%;
	    background-color: #6b9cb6;
	    text-align: center;
		padding-top: 5px;

	}
	.info{
		display:block;
		float:left;
		width:27%;
		background-color:#fff;
		margin-right:7px;

	}
	.info h4{
	    font-weight: bold;
	    background-color: #6b9cb6;
	    color: #fff;
	    padding: 5px;
	    margin-top: 0px;
		width:100%

	}
	.item{
		border-bottom:2px solid #ccc;

		padding:5px;

	}

	.greenactive{

	    background-color: green;
		color:white;
	}

	.tip{
		font-size:12px;
	}
	.popover-content{
		color:#008cee;
		text-align: right;
		margin-right: 50px;
}
</style>


<link href="__STATIC__/css/chat.css" rel="stylesheet" type="text/css">
<script src="__STATIC__/js/audio.js"></script>


<!--  通话详情  -->

<div class="modal fade" id="my-message" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
		<div class="modal-dialog" style="width:450px;">
			<div class="modal-content">
					<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal" aria-label="Close">
								 <span aria-hidden="true">&times;</span>
							</button>
							<h4 class="modal-title" id="myModalLabel" style="color:#000;">消息详情</h4>
				 </div>
				 <div class="modal-body" style="padding: 15px 60px;">
							<form id="form" method="post" class="form-horizontal" enctype="multipart/form-data" >
									<div class="form-group">
										<label class="col-lg-3 control-label">消息标题：</label>
										<div class="col-lg-9 col-sm-9" style="padding-top:8px;">
												<span id="title"></span>
										</div>
									</div>

									<div class="form-group">
										<label class="col-lg-3 control-label">消息内容：</label>
										<div class="col-lg-9 col-sm-9" style="padding-top:8px;">
												<span id="content" style="word-wrap:break-word; word-break:break-all;"></span>
										</div>
									</div>
									<div class="form-group">
										<label class="col-lg-3 control-label">发布时间：</label>
										<div class="col-lg-9 col-sm-9" style="padding-top:8px;">
												<span id="time"></span>
										</div>
									</div>

							</form>
				  <br/>
				 </div>
				 <div style="clear:both;"></div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
					<button type="button" class="btn btn-primary" data-dismiss="modal" onclick="shauxin();">确定</button>
				</div>
			</div>

			</div>

<script type="text/javascript" src='/public/js/paging.js'></script>
<script src="__PUBLIC__/js_manage/account_manage.js"></script>
<script id='my_datalist' type='text/tepmate'>
 <tr>
	 <td class="text-center">
		 <input class="blackcheck" name='checkids' value="{%id%}" type="checkbox"/>
	 </td>
	 <td class="text-center">{%sequence%}</td>
	 <td class="text-center">{%title%}</td>
	 <td class="text-center">{%create_time%}</td>
	 <td class="text-center">{%status%}</td>
	 <td class="text-center">
		<a href="javascript:void(0);" onclick="gotoDetail({%id%});">查看详情</a>
	 </td>
 </tr>
</script>
<script type="text/javascript">
  //点击确认 刷新整个页面
  function shauxin(){ 
     window.location.href='{:url("message/my")}';
  }



	var Paging = new Paging01();
		Paging.init_args({
		// url:
		page: 1, //初始页码
		limit: 10, //初始每页显示的数据量
		paging_class: 'paging', //放置分页的class
		callback: show_data //回调函数 比如show_datas(页码, 显示条数)
	});
	show_data();
	function show_data(page,limit){
		var url = "{:url('ajax_my')}";
		if(!page){
			var page = 1;
		}
		if(!limit){
			var limit = 10;
		}
		var statusz = $('#status').val();
		$.ajax({
				type: 'POST',
				url: url,
				data:{
					'page':page,
					'limit':limit,
					'statusz':statusz
				},
				success: function(result){
					console.log(result);
					var htmls = '';
					var data = result.data.list;
					if(data.length > 0){
						$('#consumeempty').hide();
						$('.main-box-footer').show();
						var total = result.data.page;   //总页数
						var Nowpage = result.data.Nowpage;  //当前页码
						var count  = result.data.total;  //总条数
						window.count = count;
						var Nowpage = parseInt(Nowpage);
						var i = (Nowpage - 1) * limit + 1;
						$.each(data, function(index, object){
							 data.i = i;
							 var html = $('#my_datalist').html();
									 html = html.replace('{%id%}', object.id);
									 html = html.replace('{%sequence%}', i);
									 html = html.replace('{%title%}', object.title);
									 html = html.replace('{%create_time%}', object.create_time);
									 html = html.replace('{%status%}', object.status);
									 html = html.replace('{%id%}', object.id);
									 htmls += html;
									 i++;
						 });
					 }
					 else{
					 		$('#consumeempty').show();
					 		$('.main-box-footer').hide();
					 		window.count = 0;
					 }
					 $('#tablepagelist').html(htmls);
				   Paging.paging(Nowpage, count, limit);
					 election();
				},
				error:function(){
					console.log('获取失败');
				}
		})
	}
	function gotoDetail(id){
		$('#my-message').modal('show');
	    $.post("{:url('getMessageById')}",{'id':id},function(res){
				if(res.code == 0){
					$('#title').text(res.data.title);
					$('#content').html(res.data.content);
					$('#time').text(res.data.create_time);
					$('#my-message').modal('show');
				}else{
					alert(res.msg);
				}
		 });
	}
	function delRole(){
			var data = {};
			data.type = 0 ;
			var arr = new Array();
			var checkedsub = $("input[name='checkids'][type='checkbox']:checked").length; //获取选中的checkids的个数
			if(checkedsub > 0 ){
				if($('.all_checked_count').is(':checked')){
					data.type = 1 ;
				}
				if($("input[name='checkids'][type='checkbox']").is(':checked')){
		    	$("input[name='checkids'][type='checkbox']").each(function(i){
						if($(this).context.checked == true){
								arr[i] = $(this).val();
						}
					});
					data.vals = arr.join();
	    	}
	    	console.log(data);
	    	var url = "{:url('del_message')}";
	    	$.ajax({
		  		type:'POST',
		  		data: data,
		  		dataType:'json',
		  		url:url,
		  		success:function(data){
		  			console.log(data);
		  			if(data.code == 0){
		  				alert(data.msg);
		  				$('#tips_model').modal('hide');
		  				show_data();
		  			}else{
		  				alert(data.msg);
		  				$('#tips_model').modal('hide');
		  			}
		  		},
		  		error:function(e){
		  			alert('数据提交失败！');
		  		}
		  	});
			}else{
				alert('请选择批量删除的数据');
			}
		}



</script>

</div>


<script type="text/javascript">

	$(function(){

	})



	//重置
	function reset_click(){
		$('input[name="startDate"][type="text"]').val("");//开始日期
		$('input[name="endTime"][type="text"]').val("");//结束日期
		$('select[name="status"] option:eq(0)').prop("selected", 'selected');//模板类型
		$('select[name="shenghe"] option:eq(0)').prop("selected", 'selected');//审核状态
		$('input[name="keyword"]').val("");//签名内容关键字
	}
 </script>

</div>
{include file="sms/sms_targer"/}
{/block}
