{extend name="public/base" /}
{block name="body"}


<link href="/public/plugs/datepicker/css/foundation-datepicker.min.css" rel="stylesheet" type="text/css">
<script src="/public/plugs/datepicker/js/foundation-datepicker.js"></script>
<script src="/public/plugs/datepicker/js/foundation-datepicker.zh-CN.js"></script>

<link href="/public/css/callrecord.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="__PUBLIC__/js_manage/account_manage.js"></script>

<div class="row">
<div class="col-lg-12 l-margin">
	<div class="main-box clearfix fadeInRight animated pz_manping_height">
		<header class="main-box-header n_head_box_b clearfix">
		  <div class="pull-left">
		  	<div class="pull-left">
						<span class="n_panel_title"><img src="__PUBLIC__/img/pz_tonghuajilu.png" alt="">历史通话记录</span>
					</div>
		  </div>
			<div class="form-inline pull-right">
				<!-- <div class="input-group">
					 <span class="input-group-addon" id="basic-addon1">联系电话</span>
					  <input type="text" class="form-control" name="contactNumber" id="contactNumber" placeholder="请输入联系电话" style="height:34px;">
					  <span class="input-group-btn">
						<button class="btn btn-primary" type="button" onclick="searchdata(1,1);">搜索</button>
					  </span>
				</div> -->
				<style>
					.l-margin{
						margin-bottom: 35px;
					}
					.c_headbutton button.pz_prim {
					    background-color: #ffffff !important;
					    border: 1px solid #0e90fe;
					    color: #0e90fe;
					}

					#footer-bar{
						position: absolute;
						left: 0px;
					}
					.main-box .main-box-header {
						padding: 20px 20px 14px !important;
					}
					.radio_t{
						position: relative;
						display: inline-block;
						margin-right: 10px;
						font-weight: normal;
					}
					.radio_levelcheck{
						cursor: pointer;
				    display: inline-block;
				    width: 100%;
				    height: 23px;
				    position: absolute;
					}
				</style>
				<div class="form-inline pull-right c_headbutton">
					<button class="btn btn-primary" onclick="refresh()">刷新</button>
					<button class="btn btn-primary"  data-title="加入CRM" onclick="popTipswin(this);">加入CRM</button>
					<button class="btn btn-primary" data-title="导出话单" data-valf="123" onclick="popTipswin(this);">导出话单</button>
					<button class="btn btn-primary" data-title="当前通话导出号码" onclick="popTipswin(this);">导出号码</button>
					<button class="btn btn-primary" data-title="生成任务" onclick="addtask(this);">新建拨打任务</button>
					<!--<button class="btn btn-primary" data-title="批量删除通话记录" id="delete_all" onclick="del();">批量删除</button>-->
				</div>
			</div>
		</header>


		<div class="main-box-body clearfix">
			<section class="navbar navbar-default clearfix pr">
				<div class="pull-left">
					 <form method="get" role="form">
					 		<div class="form-inline c_filter">
								<div class="main-box-header">
									<!-- 筛选条件 -->
									<div class="form-group form-inline c_dflex">
										<label class="levelSelect statusSelect">筛选条件:</label>
										<div class="formgroup c_topsel c_dflex_1">
											<!-- 请选择任务/话术 -->
											<!--<div class="dis_in c_selectset pr c_tasks_cenario">-->
											<!--	<select name="tasks_cenario" id="tasks_cenario" onchange="n_change();" class="form-control textwidth resetSel c_selectimg">-->
											<!--		<option value="">请选择任务</option>-->
											<!--		<option value="calltask">呼叫任务</option>-->
											<!--		<option value="scenarios">场景话术</option>-->
											<!--	</select>-->
											<!--</div>-->
											<!-- 请先选择任务/话术 -->
											<!--<div class="dis_in c_selectset pr" id="sel_taskshow">-->
											<!--	<select name="mustsel" class="form-control textwidth resetSel c_selectimg">-->
											<!--		<option value="">请先选择任务/话术</option>-->
											<!--	</select>-->
											<!--</div>-->
											<!-- 呼叫任务 -->
											<div class="dis_in c_selectset pr c_calltask">
												<select name="calltask" id="calltask" onchange="monitor_task()"  class="form-control textwidth resetSel c_selectimg">
													<option value="">请选择呼叫任务</option>
													{volist name="tasklist" id="item"}
														<option value="{$item['task_id']}">
															{$item['task_name']}
														</option>
													{/volist}
												</select>
											</div>
											<!--场景话术-->
											<div class="dis_in c_selectset pr c_scenarios ">
												<select name="scenarios" id="scenarios" onchange="monitor_scen()"  class="form-control textwidth resetSel c_selectimg">
													<option value="">请选择场景话术</option>
													{volist name="scenarioslist" id="item"}
														<option value="{$item['id']}">
															{$item['name']}
														</option>
													{/volist}
												</select>
											</div>
											<!-- 选择日期 -->
											<div class="form-group form-inline c_seldate">
												<!-- <label class="levelSelect statusSelect">选择日期:</label> -->
												<div class="formgroup">
													<div class="dis_in c_dateSelbg pr">
														<input type="text" class="form-control c_datebgimg" placeholder="开始拨打时间" id="startDate" name="startDate" value="" readonly="" />
														<script>
																$('#startDate').fdatepicker({
																	format: 'yyyy-mm-dd hh:ii',
																	pickTime: true
																});
														</script>
													</div>
													<span style="margin:0px 4px;">至</span>
													<div class="dis_in c_dateSelbg pr">
														<input type="text" class="form-control c_datebgimg"  placeholder="结束拨打时间" id="endTime" name="endTime" value="" readonly=""/>
														<script>
															$('#endTime').fdatepicker({
																format: 'yyyy-mm-dd hh:ii',
																pickTime: true
															});
														</script>
													</div>
												</div>
											</div>
											<!-- 号码查询 -->
											<div class="form-group form-inline h_numsel">
												<input type="text" name=""  id="h_phone"   class="form-control" placeholder="请输入查询号码"/>
											</div>
											<!-- 完成进度 -->
											<div class="form-group form-inline schedule_total" style="margin-left:10px;">
												完成进度： <span id="schedule">0</span>/<span id="total">0</span>
											</div>

										</div>
							 		</div>

									<!-- 意向等级 -->
									<div class="form-inline">
									  <div class="form-group l-width c_dflex" style="margin-top:5px;">
								  		<label class="levelSelect statusSelect">意向等级:</label>
								  		<div class="formgroup statusSelect c_dflex_1">
								  			<!-- <label class="checkbox-wrapper">
								  					<input class="check-all-level levelcheck" type="checkbox"/>
								  				  <span class="word">全选</span>
								  			</label> -->

											<div class="checkbox-wrapper radio_t" data-type="false">
												 <div class="radio_levelcheck"></div>
												 <input type="radio" name="levelcheck" class="levelcheck" value="6"/>
												 <span class="word">A级(意向客户)</span>
											</div>

											<div class="checkbox-wrapper radio_t" data-type="false">
												<div class="radio_levelcheck"></div>
												<input type="radio" name="levelcheck" class="levelcheck" value="5"/>
												<span class="word">B级(一般意向)</span>
											</div>

											<div class="checkbox-wrapper radio_t" data-type="false">
												<div class="radio_levelcheck"></div>
												<input type="radio" name="levelcheck" class="levelcheck" value="4" />
												<span class="word">C级(简单对话)</span>
											</div>

											<div class="checkbox-wrapper radio_t" data-type="false">
												<div class="radio_levelcheck"></div>
												<input type="radio" name="levelcheck" class="levelcheck" value="3" />
												<span class="word">D级(无有效对话)</span>
											</div>

											<div class="checkbox-wrapper radio_t" data-type="false">
												<div class="radio_levelcheck"></div>
												<input type="radio" name="levelcheck" class="levelcheck" value="2" />
												<span class="word">E级(有效未接通)</span>
											</div>
											<div class="checkbox-wrapper radio_t" data-type="false">
												<div class="radio_levelcheck"></div>
												<input type="radio" name="levelcheck" class="levelcheck" value="1" />
												<span class="word">F级(无效号码)</span>
											</div>
								  		</div>
           <!--<a href="javascript:;" class="c_levelexplain" onclick="levelfun();">意向等级规则说明</a>-->
									  </div>
								  </div>

									<!-- 通话状态 -->
									<div class="form-inline">
											<div class="form-group l-width c_dflex">
													<label class="levelSelect statusSelect">通话状态:</label>
													<div class="formgroup statusSelect c_dflex_1">
														<label class="checkbox-wrapper">
																<input type="checkbox" class="check-all-status statuscheck conversation_state" />
																<span class="word">全选</span>
														</label>
														<label class="checkbox-wrapper">
															<input type="checkbox" name="conversation" class="statuscheck conversation" value="2" />
															<span class="word">已接通</span>
														</label>
														<label class="checkbox-wrapper">
															<input type="checkbox" name="conversation" class="statuscheck conversation" value="3" />
															<span class="word">无人接听</span>
														</label>

														<label class="checkbox-wrapper">
															<input type="checkbox" name="conversation" class="statuscheck conversation" value="4" />
															<span class="word">停机</span>
														</label>

														<label class="checkbox-wrapper">
															<input type="checkbox" name="conversation" class="statuscheck conversation" value="5" />
															<span class="word">空号</span>
														</label>

														<label class="checkbox-wrapper">
															<input type="checkbox" name="conversation" class="statuscheck conversation" value="6" />
															<span class="word">正在通话中</span>
														</label>

														<label class="checkbox-wrapper">
															<input type="checkbox" name="conversation" class="statuscheck conversation" value="7" />
															<span class="word">关机</span>
														</label>

														<label class="checkbox-wrapper">
															<input type="checkbox" name="conversation" class="statuscheck conversation" value="8" />
															<span class="word">用户拒接</span>
														</label>

														<label class="checkbox-wrapper">
															<input type="checkbox" name="conversation" class="statuscheck conversation" value="9" />
															<span class="word">网络忙</span>
														</label>

														<label class="checkbox-wrapper">
															<input type="checkbox" name="conversation" class="statuscheck conversation" value="10" />
															<span class="word">来电提醒</span>
														</label>

														<label class="checkbox-wrapper">
															<input type="checkbox" name="conversation" class="statuscheck conversation" value="11" />
															<span class="word">呼叫转移失败</span>
														</label>
													</div>
											</div>
									</div>

									<!-- 通话时长 -->
									<div class="form-group form-inline c_selcalltime c_dflex">
										<label class="levelSelect statusSelect">通话时长:</label>
										<div class="formgroup">
											<input type="number" name="startNum" id="startNum" min="0" class="form-control" />
											<span style="margin:0px 3px;">至</span>
											<input type="number" name="endNum" id="endNum" min="0" class="form-control"/>
											<span class="suffix">秒</span>
										</div>
										<div class="formgroup h_range">
											<input type="number" name="second_upper" id="second_upper" min="0" class="form-control" />
											<span style="margin:0px 20px 0px 3px;">秒以上</span>
											<input type="number" name="second_lower" id="second_lower" min="0" class="form-control"/>
											<span class="suffix">秒以下</span>
										</div>
									</div>

									<!-- 说话次数 -->
									<div class="form-inline h_topsetother">
										<div class="form-group c_dflex">
											<label class="levelSelect statusSelect">说话次数:</label>
											<div class="formgroup c_dflex_1">
												<div class="c_callstate">
													<label>客户说话次数：<span>>=</span></label>
													<input type="number" name="mood" min="0" class="form-control" id="call_times"/>
												</div>
												<div class="c_callstate">
													<label>有效对话次数：<span>>=</span></label>
													<input type="number" name="mood" min="0" class="form-control" id="effective_times"/>
												</div>
												<div class="c_callstate">
													<label>触发问题次数：<span>>=</span></label>
													<input type="number" name="mood" min="0" class="form-control" id="hit_times"/>
												</div>
											</div>
										</div>

									</div>

									<!-- 语气标签 -->
									<div class="form-inline h_topset">
										<div class="form-group c_dflex">
											<label class="levelSelect statusSelect">客户语气:</label>
											<div class="formgroup c_dflex_1">
												<div class="c_callstate">
													<label>肯定次数：<span>>=</span></label>
													<input type="number" name="mood" min="0" class="form-control" id="affirm_times" />
												</div>
												<div class="c_callstate">
													<label>中性次数：<span>>=</span></label>
													<input type="number" name="mood" min="0" class="form-control" id="neutral_times"/>
												</div>
												<div class="c_callstate">
													<label>否定次数：<span> <= </span></label>
													<input type="number" name="mood" min="0" class="form-control" id="negative_times"/>
												</div>
												<div class="c_callstate">
													<label>是否邀约成功：</label>
													<div class="dis_in c_selectset pr">
														<select name="calltask" id="invitations" class="form-control textwidth resetSel c_selectimg c_inviteselectimg">
															<option value="">请选择</option>
															<option value="1">是</option>
																<option value="0">否</option>
														</select>
													</div>
												</div>
											</div>
										</div>

									</div>

									<div class="c_factor">
										<!-- 语义标签 -->
										<div class="form-inline">
											<div class="form-group c_dflex">
													<label class="levelSelect statusSelect">语义标签:</label>
													<div class="formgroup statusSelect c_dflex_1" id='semantic_label'>
														<!--<label class="checkbox-wrapper">-->
														<!--		<input type="checkbox" class="check-all-status statuscheck allsemantic" />-->
														<!--		<span class="word">全选</span>-->
														<!--</label>-->
													 
													</div>
											</div>
										</div>

										<!-- 流程标签 -->
										<div class="form-inline">
											<div class="form-group c_dflex">
												<label class="levelSelect statusSelect">流程标签:</label>
												<div class="formgroup statusSelect c_dflex_1" id="flowLabels_list">
													<!--<label class="checkbox-wrapper">-->
													<!--		<input type="checkbox" class="check-all-status statuscheck allflabellist"/>-->
													<!--		<span class="word">全选</span>-->
													<!--</label>-->
													 <!--{volist name="flowLabels" id="flow" key="k"}-->
														<!--<label class="checkbox-wrapper">-->
														<!--	<input type="checkbox" name="flow-label" class="flow-label" value="{$flow.label}" />-->
														<!--	<span class="word">{$flow.label}</span>-->
														<!--</label>-->
													 <!--{/volist}-->
												</div>
											</div>
										</div>

										<div class="form-inline h_topset">
											<div class="form-group c_dflex">
												<label class="levelSelect statusSelect">问答标签:</label>
												<div class="formgroup statusSelect c_dflex_1" id="knlgLabels_lsit">
													<!--<label class="checkbox-wrapper">-->
													<!--		<input type="checkbox" class="check-all-status statuscheck allknowledge" />-->
													<!--		<span class="word">全选</span>-->
													<!--</label>-->
													 <!--{volist name="knlgLabels" id="kn" key="k"}-->
														<!--<label class="checkbox-wrapper">-->
														<!--	<input type="checkbox" name="knowledge-label" class="knowledge-label" value="{$kn.label}" />-->
														<!--	<span class="word">{$kn.label}</span>-->
														<!--</label>-->
													 <!--{/volist}-->
												</div>
											</div>
										</div>

									</div>
								</div>
							</div>
						</form>
				</div>
				<div class="c_selshowhide">
					<a href="javascript:;" id="c_selectstate" data-state="1" onclick="c_selectshow(this);" class="pr c_selshowhide_a">收起全部</a>
				</div>
			</section>



			<div id="head_modalpagebody" class="clearfix">
				<div class="pull-left clearfix">
					<div class="pull-left h_page" style="margin-left:8px"><input type="checkbox" class="member_check rolecheck all_checked_count" name="">全选<span class="check_count" id="check_count">(0)</span> 条</div>
					<!-- 查询、重置 -->
					<div class="c_selreset pull-left">
						<button class="btn btn-primary" type="button"  onclick="show_datas(1);">查询</button>
						<button class="btn btn-primary" type="button" onclick="reset_click();">重置</button>
					</div>
				</div>
				<div class="text-right pull-right ">
					<div class="paging"></div>
					<!--<span class="h_page">总页数：55页</span>-->
					<!--<ul class="pagination">-->
					<!--	<li id="prevbtn" class="disabled"><span>«</span></li>-->
					<!--	<li class="active"><a href="javascript:void(0);" onclick="show_datas(1);">1 </a></li>-->
					<!--	<li><a href="javascript:void(0);" onclick="show_datas(2);">2 </a></li>-->
					<!--	<li><a href="javascript:void(0);" onclick="show_datas(3);">3 </a></li>-->
					<!--	<li><a href="javascript:void(0);" onclick="show_datas(4);">4 </a></li>-->
					<!--	<li><a href="javascript:void(0);" onclick="show_datas(5);">5 </a></li>-->
					<!--	<li><a href="javascript:void(0);" onclick="show_datas(6);">6 </a></li>-->
					<!--	<li><a href="javascript:void(0);" onclick="show_datas(2);"><span>»</span></a></li>-->
					<!--</ul>-->
				</div>

			</div>
		    <table class="table table-bordered table-hover">
					<thead>
						<tr>
							<!-- <th class="text-center">选择</th>
						  <th class="text-center">任务名称</th>
						  <th class="text-center">话术名称</th>
							<th class="text-center">姓名</th>
							<th class="text-center">手机号</th>
							<th class="text-center">状态</th>
							<th class="text-center">拨打时间</th>
							<th class="text-center" style="width: 139px;">通话时长</th>
							<th class="text-center">意向等级</th>
							<th class="text-center">操作</th> -->
							<th class="text-center"><input class="icheckbox_square-blue" id="member_all_check" type="checkbox" name='all_checked' ></th>
							<th class="text-center">序号</th>
							<th class="text-center">手机号码</th>
							<th class="text-center">通话时长(S)<div class="sort"><i data-type='duration' data-value='desc' class="first gray-color"></i><i data-type='duration' data-value='asc' class="second gray-color1"></i></div></th>
							<th class="text-center">状态</th>
						  <th class="text-center">意向等级</th>
							<th class="text-center">任务名称</th>
							<th class="text-center">话术名称</th>
							<th class="text-center">拨打时间<div class="sort"><i data-type='call_time' data-value='desc' class="first active-selected"></i><i data-type='call_time' data-value='asc' class="second gray-color1"></i></div></th>
							<th class="text-center">操作</th>
						</tr>
					</thead>
					<tbody id="tablepagelist">

					</tbody>
				</table>

			  <div id="modalpagebody">

			  </div>
        <div class="component-page-empty" id="pegeempty">
        	<div class="empty-tip line">暂无数据</div>
        </div>
        <div class="pull-left h_page" style="margin-left:8px"><input type="checkbox" class="member_check rolecheck all_checked_count" name="">全选<span class="check_count" id="check_count">(0)</span> 条</div>
	<div class="paging"></div>
		</div>
	</div>


	<!--等级说明弹窗-->
	<div class="modal fade" id="levelexplain" tabindex="-1" role="dialog" aria-labelledby="myModalLabellevel" aria-hidden="true">
		<div class="modal-dialog" style="width:660px;">
			<div class="modal-content modal-contenttips">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
						&times;
					</button>
					<h4 class="modal-title" id="myModalLabellevel">
						意向等级规则说明
					</h4>
				</div>
				<div class="modal-body c_levelpop">
					<img src="__PUBLIC__/img/level.jpg" alt="">
				</div>
			</div>
		</div>
	</div>

 <!--添加拨打弹窗-->
<div class="modal fade" id="joinShout" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-sm" style="width:450px; ">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"	aria-hidden="true">
          <span aria-hidden="true">×</span>
        </button>
        <h4 class="modal-title" id="myModalLabel">
        添加拨打
        </h4>
      </div>
      <div class="modal-body l-modal-body" style="padding: 20px 20px 3px;">
        <form id="addblacklist-number" method="post" id="addForm" class="form-horizontal margintop" enctype="multipart/form-data" >
           <div class="form-group">
              <label class="col-lg-3 control-label">号码：</label>
              <div class="col-lg-7 col-sm-7">
                 <input type="text" class="form-control"  name="joinPhone"  id="joinPhone"  value="" readonly />
              </div>
            </div>
            <p ></p>
            <div class="form-group">
              <label class="col-lg-3 control-label"><span class="asterisk">*</span>线路：</label>
              <div class="col-lg-7 col-sm-7">
                   <select name="line_id" id="line_id" class="form-control">
                    <option value="">请选择</option>
                    {volist name="line_datas" id="vo"}
                       <option value="{$vo['id']}">{$vo['name']}</option>
                    {/volist}
                    
                   </select>
              </div>
            </div>
            <div class="form-group">
              <label class="col-lg-3 control-label"><span class="asterisk">*</span>话术：</label>
              <div class="col-lg-7 col-sm-7">
                   <select name="scenarios_id" id="scenarios_id" class="form-control">
                    <option value="">请选择</option>
                    {volist name="scenarioslist" id="vo"}
                       <option value="{$vo['id']}">{$vo['name']}</option>
                    {/volist}
                    
                   </select>
              </div>
            </div>
            <div class="form-group">
              <label class="col-lg-3 control-label"><span class="asterisk">*</span>ASR：</label>
              <div class="col-lg-7 col-sm-7">
                 <select name="asr_id" id="asr_id" class="form-control">
                    <option value="">请选择</option>
                    {volist name="asr_list" id="vo"}
                       <option value="{$vo['id']}">{$vo['name']}</option>
                    {/volist}
                 </select>
              </div>
            </div>
       </form>

      </div>
      <div class="modal-footer">
         <input type="hidden" id="Nowpagehidden" value="">
        <input type="hidden" id="Nowlimithidden" value="">
        <button type="button" class="btn btn-default" data-dismiss="modal">   关闭		</button>
        <button type="button" class="btn btn-primary" id="users_add" onclick="checkform()" >	确定    </button>
      </div>
    </div>
  </div>
</div>



<script type="text/javascript">
  function joinShout(phone){
     $('#joinPhone').val(phone);
     $('#joinShout').modal('show');
  }
   function checkform(){
    if(!confirm("是否确认添加拨打")){
        return false;
    }
    var joinPhone = $('#joinPhone').val();
    if(!joinPhone){
      alert('添加拨打的号码不能为空');
      return false;
    }
    var line_id = $('#line_id').val();
    if(!line_id){
      alert('必须选择拨打的线路');
      return false;
    }
    var scenarios_id =$('#scenarios_id').val();
    if(!scenarios_id){
      alert('必须选择话术');
      return false;
    }
    var asr_id = $('#asr_id').val();
    if(!asr_id){
      alert('必须选择ASR线路');
      return false;
    }
    var url ='{:url("Callrecord/joinPhone")}'
    //加入拨打
    $.ajax({
  		type:'POST',
  		data:{
  			'joinPhone' :joinPhone,'line_id' :line_id,'asr_id' :asr_id,'scenarios_id':scenarios_id,
  		},
  		dataType:'json',
  		url:url,
  		success:function(data){
  			console.log(data);
  			if(data.code==0){
  			   alert(data.msg);
  			   $('#joinShout').modal('hide');
  			}else{
  			  alert(data.msg);
  			  $('#joinShout').modal('hide');
  			}
  		},
  		error:function(){
  		   
  		}
  	});
    
  }


	//选中意向等级后 调整筛选项 原本选中的意向等级自动取消
	$('.statuscheck,#startNum,#endNum,#second_upper,#second_lower,#call_times,#effective_times,#hit_times,#affirm_times,#neutral_times,#negative_times,#invitations').change(function(){
		$('input[name="levelcheck"]:checked').prop('checked', false);
	});
	function c_selectshow(obj) {
		$('.c_filter').toggleClass('c_factorheight');
		var state = $(obj).attr('data-state');
		if (state == '1') {
			console.log('111');
			 $(obj).text('展开全部');
			 $(obj).attr('data-state', '0');
			 $(obj).addClass('c_selshidea');

		} else {
			$(obj).attr('data-state', '1');
			$(obj).text('收起全部');
			$(obj).removeClass('c_selshidea');
		}
	}

	// //选择任务、场景
	// function n_change() {
	// 	var seltype = $('#tasks_cenario').val();
	// 	console.log(seltype);
	// 	if(seltype == 'calltask') {
	// 		$('.c_calltask').removeClass('dis_no');
	// 		$('.c_scenarios').addClass('dis_no');
	// 		$('#sel_taskshow').addClass('dis_no');
	// 	} else if(seltype == 'scenarios') {
	// 		$('.c_calltask').addClass('dis_no');
	// 		$('.c_scenarios').removeClass('dis_no');
	// 		$('#sel_taskshow').addClass('dis_no');
	// 	} else {
	// 		$('.c_calltask').addClass('dis_no');
	// 		$('.c_scenarios').addClass('dis_no');
	// 		$('#sel_taskshow').removeClass('dis_no');
	// 	}
	// }

	function monitor_task(){
		var calltask_val = $('#calltask').val();
		var url = "{:url('monitor')}";
		$.ajax({
  		type:'POST',
  		data:{
  			'Choice' :calltask_val
  		},
  		dataType:'json',
  		url:url,
  		success:function(data){
  			console.log(data);
  			if(data){
  				$("#scenarios").find("option").not(":first").remove();
          $.each(data, function(key, val) {
          	 var option2 = $("<option>").val(val.id).text(val.name);
             $("#scenarios").append(option2);
        	});
        	$("#scenarios").get(0).selectedIndex=0;
  			}
  		},
  		error:function(){
  		}

  	})
	}
	function monitor_scen(){
		var scenarios_val = $('#scenarios').val();
		var url = "{:url('monitor_scen')}";
		$.ajax({
  		type:'POST',
  		data:{
  			'Choice' :scenarios_val
  		},
  		dataType:'json',
  		url:url,
  		success:function(data){
  			console.log(data)
  			var list1 = data.data.list1;
  			var list2 = data.data.list2;
  			var list3 = data.data.list3;
  			if(data){
  				// $("#flowLabels_list").find("label").not(":first").remove();
  				var htmls = '';
          $.each(list1, function(key, val) {
          		var html = '<label class="checkbox-wrapper">'
				          				+'<input type="checkbox" name="flow-label" class="flow-label" value="'+val.flow_label+'" />'
				          				+'<span class="word">'+val.flow_label+'</span>'
				          				+'</label>'
				       htmls += html;
        	});
        	$("#flowLabels_list").html(htmls);
        	// $("#knlgLabels_lsit").find("label").not(":first").remove();
  				var htmls = '';
          $.each(list2, function(key, val2) {
          		var html = '<label class="checkbox-wrapper">'
				          				+'<input type="checkbox" name="knowledge-label" class="knowledge-label" value="'+val2.label+'" />'
				          				+'<span class="word">'+val2.label+'</span>'
				          				+'</label>'
				      htmls += html;
        	});
        	$("#knlgLabels_lsit").html(htmls);
        	var htmls = '';
          $.each(list3, function(key, val3) {
          		var html = '<label class="checkbox-wrapper">'
				          				+'<input type="checkbox" name="semantic-label" class="semantic-label" value="'+val3.label+'" />'
				          				+'<span class="word">'+val3.label+'</span>'
				          				+'</label>';
				       htmls += html;
        	});
        	$('#semantic_label').html(htmls);
  			}
  		},
  		error:function(){
  		}
		})
	}
	// function monitor(){
	// 	var calltask_val = $('#calltask').val();
	// 	var scenarios_val = $('#scenarios').val();
	// 	var seltype = $('#tasks_cenario').val();
	// 	$('#tasks_cenario').on('change',function(){

	// 	})
	// 	if(seltype == 'calltask') {
	// 		Choice = calltask_val;
	// 		type =  1 ;
	// 	}else if(seltype == 'scenarios'){
	// 		Choice = scenarios_val;
	// 		type = 2 ;
	// 	}
	// 	var url = "{:url('monitor')}";
	// 	$.ajax({
 // 		type:'POST',
 // 		data:{
 // 			'seltype':type,
 // 			'Choice' :Choice
 // 		},
 // 		dataType:'json',
 // 		url:url,
 // 		success:function(data){
 // 			console.log(data);
 // 		},
 // 		error:function(){
 // 		}

 // 	})
	// }

	// 查看意向等级弹窗
	function levelfun() {
		$('#levelexplain').modal('show');
	}

	//刷新
	function refresh(){
		window.location.href = "";
	}

	//导出话单
	function outrecord() {
		$('#tips_model').modal('hide');
	}

	//重置表单填写内容
	function reset_click(){
		$("#calltask").val("");
		$("#scenarios").val("");
		//清空选中框
		$("input[type='checkbox']").prop("checked",false);
		$("input[type='radio']").removeAttr("checked");
		$("#startDate").val("");
		$("#endTime").val("");
		$("#startNum").val("");
		$("#endNum").val("");
		$("#call_times").val("");
		$("#affirm_times").val("");
		$("#negative_times").val("");
		$("#neutral_times").val("");
		$("#effective_times").val("");
		$("#hit_times").val("");
		$("#talk_time").val("");
		$("#invitations").val("");
		$("#h_phone").val('');
		$("#second_upper").val('');
		$("#second_lower").val('');
		show_datas(1);
	}

	//全选
	// function all_check()
	// {
	// 	if($('input[name="all_checked"]').prop('checked') === true){
	// 		var state = true;
	// 	}else{
	// 		var state = false;
	// 	}
	// 	$.each($('input[name="checkids"]'), function(index, object){
	// 		$(object).prop("checked", state);
	// 	});
	// }



 // //用户选择流程标签时触发
	// function checklabel(obj){
	// 	//if ($(obj).is(":checked")) {
	// 		searchdata(1,1);
	// 	//}
	// }

	window.onpageshow = function(event) {
		 var a=event||window.event;
	};

	var despage = 1;

	$(function(){



		//searchdata(despage,0);

		// $(".levelcheck").on("click",function(){
		// 	searchdata(1,1);
		// });
		// $(".statuscheck").on("click",function(){
		// 	searchdata(1,1);
		// });

		// $(".semantic-label").on("click",function(){
		// 	searchdata(1,1);
		// });

// 		$(".flow-label").on("click",function(){
//
// 		});

		// $(".cqwidth").change(function(){
		// 	searchdata(1,1);
		// });


     // 1.基本参数设置
     var options = {
         type: 'POST',     // 设置表单提交方式
         url: "{:url('user/member/importExcel')}",    // 设置表单提交URL,默认为表单Form上action的路径
         dataType: 'json',    // 返回数据类型
         beforeSubmit: function(formData, jqForm, option){    // 表单提交之前的回调函数，一般用户表单验证
					/* 表单提交前的操作 */
					return true;  // 只要不返回false,表单都会提交 
         },
         success: function(responseText, statusText, xhr, $form){    // 成功后的回调函数(返回数据由responseText获得),
					 if (responseText.code == 0) {
						 window.location.href=window.location.href;
					 }else{
						alert(responseText.msg);
						//$('#exampleModal').modal('show');
					 }

         },  
         error: function(xhr, status, err) {            
             alert("操作失败!");    // 访问地址失败，或发生异常没有正常返回
         },
         clearForm: true,    // 成功提交后，清除表单填写内容
         resetForm: true    // 成功提交后，重置表单填写内容
     };
    
     // 2.绑定ajaxSubmit()
     $("#fileform").submit(function(){     // 提交表单的id
         $(this).ajaxSubmit(options);
         return false;   //防止表单自动提交
     });


	})


	  //导出记录
	// function outexcel(){
	// 	$.post("{:url('exportmemberExcel')}",
	// 	{
	// 		'mobile':mobile,
	// 		'startNum':startNum,
	// 		'endNum':endNum,
	// 		// 'startDate':startDate,
	// 		// 'endTime':endTime,
	// 		'calltask':calltask,
	// 		'levelids':levelids,
	// 		'statusids':statusids
	// 	},
	// 	function(data){

	// 				window.location.href = data;

	// 	});
	// }


  //全选用户
   function allcheck(obj){
   	if ($(obj).is(":checked")) {
   		$('.usercheck').prop("checked","checked");
   		$('.check-all').prop("checked","checked");
   		$('.check-all-th').prop("checked","checked");
   	}else{
   		$('.usercheck').prop("checked",false);
   		$('.check-all').prop("checked",false);
   		$('.check-all-th').prop("checked",false);
   	}
   	var len = $(".usercheck:checkbox:checked").length;
   	$('#selectNum').text(len);
   }

   //全选意向等级，通话状态，流程标签，语义标签，问答标签
  // function search_check(typename,type){
  // 	if(!$(this).attr("checked")){
  // 		console.log(typename);
		// 	$('.typename').attr("checked","checked");

		// }else{
		// 	$('.typename').removeAttr("checked");
		// }

		// if($('.typename').is(':checked')) {
		// 	console.log(type);
		// 	$.each($('.type'), function(index, object){
		// 		$(object).prop("checked",true);
		// 	})

		// }else{
		// 	$.each($('.type'), function(index, object){
		// 		$(object).prop("checked",false);
		// 	})

		// }
  // }

	//单选意向等级
  $('.radio_levelcheck').on('click',function(){
		
		var $radio = $(this);
		if($radio.siblings("input").is(":checked")){
			$radio.siblings("input").prop('checked',false);
		}else{
			$radio.siblings("input").prop('checked',true); 
		}
		if($radio.siblings("input").is(":checked")){
			var leveid = $radio.siblings("input").val();
		}
		$.each($("input[type='checkbox'][name='conversation']"),function(index, object){
			$(object).prop("checked",false);
		});
		$("#startDate").val("");
		$("#endTime").val("");
		$("#startNum").val("");
		$("#endNum").val("");
		$("#call_times").val("");
		$("#affirm_times").val("");
		$("#negative_times").val("");
		$("#neutral_times").val("");
		$("#effective_times").val("");
		$("#hit_times").val("");
		$("#talk_time").val("");
		$("#invitations").val("");
		$('#second_upper').val('');
		$('#second_lower').val('');
		$('#hit_times').siblings('label').find('span').text('>=');
		$('#affirm_times').siblings('label').find('span').text('>=');
		$('#negative_times').siblings('label').find('span').text('>=');
		$('#call_times').siblings('label').find('span').text('>=');
			
     var scenarios_id = $('#scenarios').val();
     var url = "{:url('scenarios_rule')}"
     if(scenarios_id){
     		$.ajax({
		  		type:'POST',
		  		data:{
		  			'scenarios_id':scenarios_id
		  			,'leveid':leveid
		  		},
		  		dataType:'json',
		  		url:url,
		  		success:function(data){
		  			console.log(data);
		  				//清空选中框

		  			if(data.code == 0){
		  			}
		  			var data = data.data;
		  			$.each(data, function(key, val) {
	  					$.each(val.rule, function(key2, val2) {
	  						switch(val2.key){
									case 'invite_succ':
									    $('#invitations').val(val2.value);
									    break;
									case 'hit_problem_times':
									    $('#hit_times').val(val2.value);
									    $('#hit_times').siblings('label').find('span').text(val2.op);
											break;
									case 'affirm_times':
									    $('#affirm_times').val(val2.value);
									    $('#affirm_times').siblings('label').find('span').text(val2.op);
									    break;
									case 'reject_times':
									    $('#negative_times').val(val2.value);
									    $('#negative_times').siblings('label').find('span').text(val2.op);
									    break;
									case 'call_duration':
											if(val2.op == '<='){
												$('#second_lower').val(val2.value);
											}
									    $('#second_upper').val(val2.value);
									    break;
									case 'speak_count':
									    $('#call_times').val(val2.value);
									    $('#call_times').siblings('label').find('span').text(val2.op);
									    break;
									case 'call_status':
									  	$.each($(val2.value), function(index, object){
									  		$("input:checkbox[value="+object+"]").prop('checked',true);
											});
									    break;
									default:
									    break;
								}
	  					})
		  			})

		  		},
		  		error:function(){
		  		}
	  	})
     }
   });

 	//语气标签点击，清空意向等级单选
 	$('#call_times').click(function(){
 		$("input[type='radio']").removeAttr("checked");
 	});
 	$('#affirm_times').click(function(){
 		$("input[type='radio']").removeAttr("checked");
 	});
 	$('#negative_times').click(function(){
 		$("input[type='radio']").removeAttr("checked");
 	});
 	$('#invitations').click(function(){
 		$("input[type='radio']").removeAttr("checked");
 	});
 	$('#neutral_times').click(function(){
 		$("input[type='radio']").removeAttr("checked");
 	});
 	$('#effective_times').click(function(){
 		$("input[type='radio']").removeAttr("checked");
 	});
 	$('#hit_times').click(function(){
 		$("input[type='radio']").removeAttr("checked");
 	});
 	$('#talk_time').click(function(){
 		$("input[type='radio']").removeAttr("checked");
 	});



	//全选通话状态
	$(".conversation_state").unbind('click');
		$(".conversation_state").click(function(){
			if(!$(this).attr("checked")){
				$(this).attr("checked","checked");

			}else{
				$(this).removeAttr("checked");
			}

			if($('.conversation_state').is(':checked')) {
				$.each($('.conversation'), function(index, object){
					$(object).prop("checked",true);
				})

			}else{
				$.each($('.conversation'), function(index, object){
					$(object).prop("checked",false);
				})

			}
		});

	//全选流程标签
	$(".allflabellist").unbind('click');
	$(".allflabellist").click(function(){
		if(!$(this).attr("checked")){
			$(this).attr("checked","checked");

		}else{
			$(this).removeAttr("checked");
		}

		if($('.allflabellist').is(':checked')) {
			$.each($('.flow-label'), function(index, object){
				$(object).prop("checked",true);
			})

		}else{
			$.each($('.flow-label'), function(index, object){
				$(object).prop("checked",false);
			})

		}

	});

	//全选语义标签
	$(".allsemantic").unbind('click');
	$(".allsemantic").click(function(){
		if(!$(this).attr("checked")){
			$(this).attr("checked","checked");

		}else{
			$(this).removeAttr("checked");
		}

		if($('.allsemantic').is(':checked')) {
			$.each($('.semantic-label'), function(index, object){
				$(object).prop("checked",true);
			})

		}else{
			$.each($('.semantic-label'), function(index, object){
				$(object).prop("checked",false);
			})

		}

	});

	//全选问答标签
	$(".allknowledge").unbind('click');
	$(".allknowledge").click(function(){
		if(!$(this).attr("checked")){
			$(this).attr("checked","checked");

		}else{
			$(this).removeAttr("checked");
		}

		if($('.allknowledge').is(':checked')) {
			$.each($('.knowledge-label'), function(index, object){
				$(object).prop("checked",true);
			})

		}else{
			$.each($('.knowledge-label'), function(index, object){
				$(object).prop("checked",false);
			})

		}

	});

	//加入crm
	function insert_crm(mobile,id){
		var url = "insert_crm";
		$.ajax({
  		type:'POST',
  		data:{
  			id:id,
  			phone:mobile
  		},
  		dataType:'json',
  		url:url,
  		success:function(result){
  			console.log(result);
  			if(result.code === 0){
  			  alert('加入crm成功');
  				var page = $('#Nowpagehidden').val();
          var limit =$('#Nowlimithidden').val();
  				show_datas(page,limit);
  			}else{
  				alert('加入crm失败');
  			}
  		},
  		error:function(){
  			alert('加入失败');
  		}

  	})

	}
  function getzf(num){
      if(parseInt(num) < 10){
          num = '0'+num;
      }
      return num;
  }

	function getMyDate(str){

	    var oDate = new Date(str),
	    oYear = oDate.getFullYear(),
	    oMonth = oDate.getMonth()+1,
	    oDay = oDate.getDate(),
	    oHour = oDate.getHours(),
	    oMin = oDate.getMinutes(),
	    oSen = oDate.getSeconds(),
	    oTime = oYear +'-'+ getzf(oMonth) +'-'+ getzf(oDay) +' '+ getzf(oHour) +':'+ getzf(oMin) +':'+getzf(oSen);//最后拼接时间
	            return oTime;
	        }


</script>
<script type="text/javascript" src='/public/js/paging.js'></script>
<script type="text/javascript">
   	/**
	 * 配置分页
	 *
	 * @param int args.page 页码 页码参数统一"page"
	 * @param int args.limit 每页显示的数量 参数统一"limit"
	 * @param string args.paging_class 放置分页的class
	 * @param function args.callback 回调函数
	*/
	var Paging = new Paging01();
	Paging.init_args({
	  page: 1, //初始页码
	  limit: 10, //初始每页显示的数据量
	  paging_class: 'paging', //放置分页的class
	  callback: show_datas, //回调函数 比如show_datas(页码, 显示条数)
	  key:1,
	});
	
	$('input[name="startNum"]').change(function() {
    $('#second_upper').val('');
    $('#second_lower').val('');
	})
	$('input[name="endNum"]').change(function() {
    $('#second_upper').val('');
    $('#second_lower').val('');
	})


	$('input[name="second_upper"]').change(function() {
    $('#startNum').val('');
    $('#endNum').val('');
    $('#second_lower').val('');
	})
	$('input[name="second_lower"]').change(function() {
    $('#startNum').val('');
    $('#endNum').val('');
    $('#second_upper').val('');
	})


	$(function(){
    $("#startDate").val("");
		$("#endTime").val("");
		window.times = 0;
	})



	var mobile,startNum,endNum,startDate,endTime,calltask,scenarios,call_times,affirm_times,negative_times,neutral_times,effective_times,hit_times,invitations;
	var levelids=[],statusids=[],semanticLabels=[],flowLabels=[],knlgLabels=[];
	show_datas();

	var show_datas_status = true;
	function show_datas(page,limit){
		if(show_datas_status == false){
			return false;
		}
		show_datas_status = false;
		if(!page){
			var page=1;
		}
		if(!limit){
			var limit=10;
		}
    //把当前页码 和每页limit 数量存入 隐藏的input中方便 别的功能调用 
		$('#Nowpagehidden').val(page);
		$('#Nowlimithidden').val(limit);
    
    
		// $('input[name="all_checked"]').prop("checked", false);
		var c_selectstate_name = $('#c_selectstate').text();
		if(c_selectstate_name == '收起全部'){
			 	$('#c_selectstate').click();
		}
		window.times = 0;
		// $("#startDate").val("");
		// $("#endTime").val("");
	
		data= {};
		data.limit=limit;
		data.status = Array();
		data.semantic_label = Array();
		data.flow_labels = Array();
		data.knowledge_labels = Array();
		data.page = page;
		data.record_type = 1;
		data.task_id = $('#calltask').val();//呼叫任务
		data.scenarios_id = $('#scenarios').val();//场景话术
		data.start_call_time = $('#startDate').val();//开始拨打时间
		data.end_call_time = $('#endTime').val();//结束拨打时间
		data.phone = $('#h_phone').val();//查询电话
		data.level = $('input[name="levelcheck"]:checked').val();//意向等级
		$("input[name='conversation'][type='checkbox']:checked").each(function(i){
			data.status[i] = $(this).val();//通话状态
		});
		if($('#startNum').val() != '' || $('#endNum').val()){
			data.min_duration = $('#startNum').val();
			data.max_duration =$('#endNum').val();
		}else if($('#second_upper').val() !==''){
			data.min_duration = $('#second_upper').val();
		}else if($('#second_lower').val() !==''){
			data.max_duration = $('#second_lower').val();
		}
		data.call_times = $('#call_times').val();//客户说话次数
		data.effective_times = $('#effective_times').val();//有效对话次数
		data.hit_times = $('#hit_times').val();//触发问题次数
		data.affirm_times = $('#affirm_times').val();//肯定次数
		data.neutral_times = $('#neutral_times').val()//中性次数
		data.negative_times = $('#negative_times').val();//否定次数
		data.invitations = $('#invitations').val();//是否邀约成功
		$("input[name='semantic-label'][type='checkbox']:checked").each(function(i){
			data.semantic_label[i] = $(this).val();//通话状态
		});
		$("input[name='flow-label'][type='checkbox']:checked").each(function(i){
			data.flow_labels[i] = $(this).val();//通话状态
		});
		$("input[name='knowledge-label'][type='checkbox']:checked").each(function(i){
			data.knowledge_labels[i] = $(this).val();//通话状态
		});
    var OrderObject = $('.sort > i.active-selected');
    data.orderby = OrderObject.data('type');
    data.order = OrderObject.data('value');

		var url = "{:url('get_new_call_historical_record')}";

		//return false;
		times_interval = setInterval(function(){
			window.times++;
			if(window.times >= 1){
				$('.l_loadfixed').show();
			}
		},1000);
		$.ajax({
			url : url,
			dataType : "json",
			type : "post",
			data : data,
			success: function(data){
				//完成进度处理
				console.log(data);
				var calltask = $('#calltask').val();
				if(calltask !=''){
					$('.schedule_total').show();
					$.ajax({
						url:'schedule_total',
						type:'post',
						data:{'task_id':calltask},
						success:function(res){
							$('#total').text(res.data.count);
							$('#schedule').text(res.data.status);
						}
					})
				}else{
					$('.schedule_total').hide();
				}
				var total = data.data.total;   //总页数
				var Nowpage = data.data.Nowpage;  //当前页码
				var count  = data.data.count;  //总条数
				var Nowpage = parseInt(Nowpage);
				var limit = data.data.limit;

				var data = data.data.list;
			  if(data.length > 0){
					$('.h_page').show();
					$("#pegeempty").css("display","none");

					$("#tablepagelist").find("tr").remove();

					for(var i=0;i<data.length;i++){

						var id = data[i].id;
						var user_id = data[i].owner;
						var mobile = data[i].mobile;
						var customer_name = data[i].customer_name;
						if(customer_name == null || customer_name == ""){
							customer_name = "暂无数据";
							var compay_name = "";
						}
						var call_times = data[i].last_dial_time;
						var username = data[i].username;
						var status = data[i].status;
						var state_crm = data[i].state_crm;
						var duration = data[i].duration;
						var last_dial_time = data[i].last_dial_time;
						var level = data[i].level;
						var review = data[i].review;
						var task_id = data[i].task_id;
						var scenename = data[i].scenarios_name;
						var task_name = data[i].task_name;
						if(task_name == null || task_name == ""){
							task_name = "暂无数据";
						}
						if(scenename == null || scenename == ""){
							scenename = "话术不存在";
						}
						var reviewstr = '<a href="javascript:void(0);" class="show_record" data-id="'+id+'" onclick="gotoDetail('+mobile+','+task_id+','+id+', \'record\');">未查看</a>&nbsp;&nbsp;';
						if(review == 1){
							reviewstr = '<a href="javascript:void(0);" class="show_record" data-id="'+id+'" style="color: #5b5d5f;" onclick="gotoDetail('+mobile+','+task_id+','+id+', \'record\');">已查看</a>&nbsp;&nbsp;';
						}
						// reviewstr += '<a href="javascript:void(0);" class="show_record" data-title="删除通话记录" data-id="'+id+'"  onclick="popTipswin(this);">删除&nbsp;&nbsp;</a>';
						if(state_crm == 0){
							reviewstr += '<a href="javascript:void(0);" class="show_record" data-id="'+id+'" onclick="insert_crm('+mobile+','+id+');">加入CRM</a>&nbsp;&nbsp;';
						}else{
							reviewstr += '<a href="javascript:void(0);" class="show_record" data-id="'+id+'" style="color:gray;cursor: no-drop;">已加CRM</a>&nbsp;&nbsp;';
						}
            reviewstr+= '<a href="javascript:void(0);" class="show_record" data-id="'+id+'" onclick="joinShout('+mobile+')" >加入呼叫</a>';
						var originating_call = data[i].originating_call;
						if(originating_call == null){
							 originating_call = "";
						}

						var strstatus = "未拨打";

						switch (status) {
							case 2:
								strstatus = "已接通";
								break;
							case 3:
								strstatus = "无人接听";
								break;
							case 4:
								strstatus = "停机";
								break;
							case 5:
								strstatus = "空号";
								break;
							case 6:
								strstatus = "正在通话中";
								break;
							case 7:
								strstatus = "关机";
								break;
							case 8:
								strstatus = "用户拒接";
								break;
							case 9:
								strstatus = "网络忙";
								break;
							case 10:
								strstatus = "来电提醒";
								break;
							case 11:
								strstatus = "呼叫转移失败";
								break;
							default:
								strstatus = "--";
						}

						var strlevel = "";
						switch (level) {
							case 6:
								strlevel = "A级(意向客户)";
								break;
							case 5:
								strlevel = "B级(一般意向)";
								break;
							case 4:
								strlevel = "C级(简单对话)";
								break;
							case 3:
								strlevel = "D级(无效对话)";
								break;
							case 2:
								strlevel = "E级(有效未接通)";
								break;
							case 1:
								strlevel = "F级(无效号码)";
								break;
							default:
								strlevel = "--";
						}

						var string = '<tr class="itemId'+id+'" alt="'+id+'">'
						+'<td class="text-center"><input type="checkbox" class="member_check rolecheck" value="'+id+'" name="checkids" /></td>'
						+'<td class="text-center">'+((Nowpage-1)*limit+(i+1))+'</td>'   
						+'<td class="text-center">'+mobile+'</td>'
						+'<td class="text-center">'+duration+'</td>'
						+'<td class="text-center">'+strstatus+'</td>'
						+'<td class="text-center">'+strlevel+'</td>'
						// +'<td class="text-center">'+customer_name+'</td>'
						+'<td class="text-center">'+task_name+'</td>'
						+'<td class="text-center">'+scenename+'</td>'
						// +'<td class="text-center">'+username+'</td>'
						+'<td class="text-center">'+call_times+'</td>'

						// +'<td class="text-center">'+last_dial_time+'</td>'

						+'<td class="text-center">'+reviewstr+'</td>';
						string += '</tr>';
						$("#tablepagelist").append(string);

					}
			  }else{
					$("#pegeempty").css("display","block");
					$("#tablepagelist").find("tr").remove();
					$("#modalpagebody").find("div").remove();
					$('.h_page').hide();
					count = 0;
				}
				//Nowpage  当前页
				//count    数据总条数
				//limit    分页数量
				Paging.paging(Nowpage, count, limit);
				//全选
				if($('.all_checked_count').is(":checked")){
					$("input[name='checkids'][type='checkbox']").prop("checked",true);
					$("input[name='all_checked'][type='checkbox']").prop("checked", true);
					$('.check_count').text(count);
				}else{
					$('.check_count').text(0);
				}
				$("input[name='all_checked'][type='checkbox']").unbind('click');
				$("input[name='all_checked'][type='checkbox']").click(function(){
					 if ($("input[name='all_checked'][type='checkbox']").is(":checked")) {
				  		$("input[name='checkids'][type='checkbox']").prop("checked",true);
				  		$(".all_checked_count").prop("checked", false);
				  	} else {
				 		$("input[name='checkids'][type='checkbox']").prop("checked",false);
				 		$(".all_checked_count").prop("checked", false);
				 	}
				
				 	$('.check_count').text($("input[name='checkids'][type='checkbox']:checked").length);
				 });
				//子复选框的事件
				$('input[type="checkbox"][name="checkids"]').unbind('click');
				$('input[type="checkbox"][name="checkids"]').click(function(){
					//当没有选中某个子复选框时，check-all取消选中
					if (!$(".rolecheck").checked) {
						$("input[name='all_checked'][type='checkbox']").prop("checked", false);
						$(".all_checked_count").prop("checked", false);
					}
					var chsub = $("input[name='checkids'][type='checkbox']").length; //获取checkids的个数
					var checkedsub = $("input[name='checkids'][type='checkbox']:checked").length; //获取选中的checkids的个数
					if (checkedsub == chsub) {
						$("input[name='all_checked'][type='checkbox']").prop("checked", true);
						$(".all_checked_count").prop("checked", false);
					}
					$('.check_count').text(checkedsub);
				});
				$('.all_checked_count').unbind('click');
				$('.all_checked_count').click(function(){
						if($(this).prop('checked') === true){
							$.each($('.all_checked_count'),function(index,obj){
								$(obj).prop("checked",true);
							});
							$("input[name='checkids'][type='checkbox']").prop("checked",true);
							$("input[name='all_checked'][type='checkbox']").prop("checked", true);
							$('.check_count').text(count);
						}else{
							$.each($('.all_checked_count'),function(index,obj){
								$(obj).prop("checked",false);
							});
								$("input[name='checkids'][type='checkbox']").prop("checked",false);
				 			$("input[name='all_checked'][type='checkbox']").prop("checked", false);
				 			$('.check_count').text(0);
						}
					});
				clearInterval(times_interval);
		    $('.l_loadfixed').hide();
			  $('.c_selectstate').click();
			  show_datas_status = true;
			},
			error : function() {
				clearInterval(times_interval);
		    $('.l_loadfixed').hide();
				$('.c_selectstate').click();
				// alert('获取列表失败。');
				show_datas_status = true;
			}
		});

  }

	function searchdata(){

			// mobile = $("#contactNumber").val();

			calltask = $("#calltask").val(); //获取呼叫任务
			scenarios = $("#scenarios").val(); //获取场景话术
			startDate = $("#startDate").val(); //获取开始选择的日期
			endTime = $("#endTime").val(); //获取结束选择的日期
			startNum = $("#startNum").val(); //开始通话时长
			endNum = $("#endNum").val(); //结束通话时长
			//获取意向等级
			levelids = $('input:radio[name="levelcheck"]:checked').val();
		  // levelids = levelids.join(',');
		  console.log("意向等级"+levelids);
			//获取通话状态
			$.each($('.conversation'), function(index, object){
				if($(object).prop("checked") == true){
					statusids.push($(object).val());
				}
			})
		  // statusids = statusids.join(',');
			console.log("通话状态"+statusids);
			// call_times = $("#call_times").val(); //客户说话次数
			// affirm_times = $("#affirm_times").val(); //肯定次数
			// negative_times = $("#negative_times").val(); //否定次数
			// neutral_times = $("#neutral_times").val(); //中性次数
			// effective_times = $("#effective_times").val(); //有效次数
			// hit_times = $("#hit_times").val(); //触发问题次数

			// //语气标签中通话时长
			// talk_time = $("#talk_time").val();

			// //是否邀约
			// invitations = $("#invitations").val();

			// //获取流程标签
			// $.each($('.flow-label'), function(index, object){
			// 	if($(object).prop("checked") == true){
			// 		flowLabels.push($(object).val());
			// 	}
			// })
		 // flowLabels = flowLabels.join(',');
			// //获取语义标签
			// $.each($('.semantic-label'), function(index, object){
			// 	if($(object).prop("checked") == true){
			// 		semanticLabels.push($(object).val());
			// 	}
			// })
		 // semanticLabels = semanticLabels.join(',');
			// //获取问答标签
			// $.each($('.knowledge-label'), function(index, object){
			// 	if($(object).prop("checked") == true){
			// 		knlgLabels.push($(object).val());
			// 	}
			// })
		 // knlgLabels = knlgLabels.join(',');
	}

		//已经拨打的全选
	// function checkall(){
	//   	if ($('.check-all').is(":checked")) {
	//   		$('.Alreadycheck').prop("checked","checked");
	//   	}else{
	//   		$('.Alreadycheck').prop("checked",false);
	//   	}
	// }
	var excel_state = true;
  //导出号码
	// function outexcel(){
	// 	$('#tips_model').modal('hide');
	// 	if(excel_state === true){
	// 		excel_state = false;

	// 		//获取选中的手机号码
	// 		var usercheck = [];
	// 		$.each($('input[name="checkids"]:checked'), function(index, object){
	// 			usercheck.push($(object).val());
	// 		});
	// 		console.log(usercheck);
	// 		$.post("{:url('exportmemberExcel')}",
	// 		{
	// 			'usercheck':usercheck
	// 		},
	// 		function(data){
	// 			if(data.code === 0){
	// 				window.location.href = data.data;
	// 				// alert('导出成功');
	// 			}else{
	// 				alert('导出失败');
	// 			}
	// 			excel_state = true;

	// 		});
	// 	}

	// }
var excel_statelist = true;
	//导出话单
	function exportlistExcel(){
		var checkedsub = $("input[name='checkids'][type='checkbox']:checked").length; //获取选中的checkids的个数
    var arr = new Array();
    data= {};
    data.type = 0 ;
  	data.alt = 1 ;
		data.status = Array();
		data.semantic_label = Array();
		data.flow_labels = Array();
		data.knowledge_labels = Array();
		data.task_id = $('#calltask').val();//呼叫任务
		data.scenarios_id = $('#scenarios').val();//场景话术
		data.start_call_time = $('#startDate').val();//开始拨打时间
		data.end_call_time = $('#endTime').val();//结束拨打时间
		data.phone = $('#h_phone').val();//查询电话
		data.level = $('input[name="levelcheck"]:checked').val();//意向等级
		$("input[name='conversation'][type='checkbox']:checked").each(function(i){
					data.status[i] = $(this).val();//通话状态
		});
		if($('#startNum').val() != '' || $('#endNum').val()){
			data.min_duration = $('#startNum').val();
			data.max_duration =$('#endNum').val();
		}else if($('#second_upper').val() !==''){
			data.min_duration = $('#second_upper').val();
		}else if($('#second_lower').val() !==''){
			data.max_duration = $('#second_lower').val();
		}
		data.call_times = $('#call_times').val();//客户说话次数
		data.effective_times = $('#effective_times').val();//有效对话次数
		data.hit_times = $('#hit_times').val();//触发问题次数
		data.affirm_times = $('#affirm_times').val();//肯定次数
		data.neutral_times = $('#neutral_times').val()//中性次数
		data.negative_times = $('#negative_times').val();//否定次数
		data.invitations = $('#invitations').val();//是否邀约成功
		$("input[name='semantic-label'][type='checkbox']:checked").each(function(i){
					data.semantic_label[i] = $(this).val();//通话状态
		});
		$("input[name='flow-label'][type='checkbox']:checked").each(function(i){
					data.flow_labels[i] = $(this).val();//通话状态
		});
		$("input[name='knowledge-label'][type='checkbox']:checked").each(function(i){
					data.knowledge_labels[i] = $(this).val();//通话状态
		});

  	if(checkedsub>0){
  	$('#import-data').modal('show');
  	if($('.all_checked_count').is(":checked")){
  			data.type = 1;
  	}
  	if($("input[name='checkids'][type='checkbox']").is(':checked')){
    	$("input[name='checkids'][type='checkbox']").each(function(i){
				if($(this).context.checked == true){
						arr[i] = $(this).val();
				}
			});
			data.vals = arr.join();
    }
    // $('#sel_excel').unbind('click');
    	// $('#sel_excel').on('click',function(){
  	$.ajax({
			type: 'POST',
      url: '/user/callrecord/import_phone_histor',
      data: data,
      success:function(data){
      	// console.log(data);
				alert(data.msg);
				window.location.href = data.data;
			  $('#tips_model').modal('hide');
      }
		})
	    // })
    }else{
    	alert('请选择导出的数据');
    	return false;
    }
	}

	function outexcel(){
    var checkedsub = $("input[name='checkids'][type='checkbox']:checked").length; //获取选中的checkids的个数
    var arr = new Array();
    data.type = 0 ;
  	data= {};
		data.status = Array();
		data.semantic_label = Array();
		data.flow_labels = Array();
		data.knowledge_labels = Array();

		data.task_id = $('#calltask').val();//呼叫任务
		data.scenarios_id = $('#scenarios').val();//场景话术
		data.start_call_time = $('#startDate').val();//开始拨打时间
		data.end_call_time = $('#endTime').val();//结束拨打时间
		data.phone = $('#h_phone').val();//查询电话
		data.level = $('input[name="levelcheck"]:checked').val();//意向等级
		$("input[name='conversation'][type='checkbox']:checked").each(function(i){
					data.status[i] = $(this).val();//通话状态
		});
		if($('#startNum').val() != '' || $('#endNum').val()){
			data.min_duration = $('#startNum').val();
			data.max_duration =$('#endNum').val();
		}else if($('#second_upper').val() !==''){
			data.min_duration = $('#second_upper').val();
		}else if($('#second_lower').val() !==''){
			data.max_duration = $('#second_lower').val();
		}
		data.call_times = $('#call_times').val();//客户说话次数
		data.effective_times = $('#effective_times').val();//有效对话次数
		data.hit_times = $('#hit_times').val();//触发问题次数
		data.affirm_times = $('#affirm_times').val();//肯定次数
		data.neutral_times = $('#neutral_times').val()//中性次数
		data.negative_times = $('#negative_times').val();//否定次数
		data.invitations = $('#invitations').val();//是否邀约成功
		$("input[name='semantic-label'][type='checkbox']:checked").each(function(i){
					data.semantic_label[i] = $(this).val();//通话状态
		});
		$("input[name='flow-label'][type='checkbox']:checked").each(function(i){
					data.flow_labels[i] = $(this).val();//通话状态
		});
		$("input[name='knowledge-label'][type='checkbox']:checked").each(function(i){
					data.knowledge_labels[i] = $(this).val();//通话状态
		});

  	if(checkedsub>0){
  	$('#import-data').modal('show');
  	if($('.all_checked_count').is(":checked")){
  			data.type = 1;
  	}
  	if($("input[name='checkids'][type='checkbox']").is(':checked')){
    	$("input[name='checkids'][type='checkbox']").each(function(i){
				if($(this).context.checked == true){
						arr[i] = $(this).val();
				}
			});
			data.vals = arr.join();
    }
    // $('#sel_excel').unbind('click');
    	// $('#sel_excel').on('click',function(){
  	$.ajax({
			type: 'POST',
      url: '/user/callrecord/import_phone_histor',
      data: data,
      success:function(data){
      	// console.log(data);
				alert(data.msg);
				window.location.href = data.data;
			  $('#tips_model').modal('hide');
      }
		})
	    // })
    }else{
    	alert('请选择导出的数据');
    	return false;
    }
  }
	 //重拨
	 function redial(task,mobile){

		 $.post("{:url('redial')}",{'task':task,'mobile':mobile},function(res){
					if(res.code == 0){
						alert(res.msg);
					}else{
						alert(res.msg);
					}
	   });

	 }
	 
	//全体加入   crm
	function joincrm(){
		get_data();
		data.type = 0 ;
		var arr = new Array();
		var checkedsub = $("input[name='checkids'][type='checkbox']:checked").length; //获取选中的checkids的个数
		if($('.all_checked_count').is(':checked') || checkedsub > 0){
			if($('.all_checked_count').is(':checked')){
				data.type = 1 ;
			}
			if($("input[name='checkids'][type='checkbox']").is(':checked')){
	    	$("input[name='checkids'][type='checkbox']").each(function(i){
					if($(this).context.checked == true){
							arr[i] = $(this).val();
					}
				});
				data.vals = arr.join();
    	}
			$.ajax({
				type: 'POST',
	      url: '/user/callrecord/joincrmhistor',
	      data: data,
	      success:function(data){
	      	console.log(data);
	      	if(data.code == 0){
	      		alert(data.msg);
	      		$('#tips_model').modal('hide');
	      		var page = $('#Nowpagehidden').val();
            var limit =$('#Nowlimithidden').val();
  			  	show_datas(page,limit);
	      		// window.location.href = '';
	      	}else{
	      		alert(data.msg);
	      		$('#tips_model').modal('hide');
	      		//window.location.href = '';
	      	}
	      },
	      error:function(){
  			   $('#tips_model').modal('hide');
  		  }
			})
		}else{
			alert('请选择要加入的数据');
		}
	}

function get_data(){
    data.type = 0 ;
  	data= {};
		data.status = Array();
		data.semantic_label = Array();
		data.flow_labels = Array();
		data.knowledge_labels = Array();

		data.task_id = $('#calltask').val();//呼叫任务
		data.scenarios_id = $('#scenarios').val();//场景话术
		data.start_call_time = $('#startDate').val();//开始拨打时间
		data.end_call_time = $('#endTime').val();//结束拨打时间
		data.phone = $('#h_phone').val();//查询电话
		data.level = $('input[name="levelcheck"]:checked').val();//意向等级
		$("input[name='conversation'][type='checkbox']:checked").each(function(i){
					data.status[i] = $(this).val();//通话状态
		});
		if($('#startNum').val() != '' || $('#endNum').val()){
			data.min_duration = $('#startNum').val();
			data.max_duration =$('#endNum').val();
		}else if($('#second_upper').val() !==''){
			data.min_duration = $('#second_upper').val();
		}else if($('#second_lower').val() !==''){
			data.max_duration = $('#second_lower').val();
		}
		data.call_times = $('#call_times').val();//客户说话次数
		data.effective_times = $('#effective_times').val();//有效对话次数
		data.hit_times = $('#hit_times').val();//触发问题次数
		data.affirm_times = $('#affirm_times').val();//肯定次数
		data.neutral_times = $('#neutral_times').val()//中性次数
		data.negative_times = $('#negative_times').val();//否定次数
		data.invitations = $('#invitations').val();//是否邀约成功
		$("input[name='semantic-label'][type='checkbox']:checked").each(function(i){
					data.semantic_label[i] = $(this).val();//通话状态
		});
		$("input[name='flow-label'][type='checkbox']:checked").each(function(i){
					data.flow_labels[i] = $(this).val();//通话状态
		});
		$("input[name='knowledge-label'][type='checkbox']:checked").each(function(i){
					data.knowledge_labels[i] = $(this).val();//通话状态
		});
	}



	//新建任务
	function addtask(){
		if($('.all_checked_count').is(':checked')){
				showadd(this);
		}
		var checkedsub = $("input[name='checkids'][type='checkbox']:checked").length; //获取选中的checkids的个数
		if(checkedsub > 0){
			showadd(this);
		}else{
			alert('请选择呼叫电话');
		}
	}
	
	//当前时间第二天
	function addDay(dayNumber, date) {
    date = date ? date : new Date();
    var ms = dayNumber * (1000 * 60 * 60 * 24)
    var newDate = new Date(date.getTime() + ms);
    return newDate;
  }
	function showadd(obj){
	     $('#start_date').val(getFormatDate(10));
		  $('#end_date').val(FormatLocaDate(addDay(1)));
		  $('#NewPlan').modal('show');
	}
	
	
	//排序
	$('.sort > i').click(function(){
	  if($(this).hasClass('active-selected') === false){
	    var type = $(this).data('type');
	    var order = $(this).data('value');
	    if($(this).hasClass('second') === true){
	      $(this).removeClass('gray-color1').addClass('active-selected');
	    }else{
	      $(this).removeClass('gray-color').addClass('active-selected');
	    }
	    if(type == 'duration'){
	      $('.sort > i[data-type="call_time"].second').addClass('gray-color1').removeClass('active-selected');
	      $('.sort > i[data-type="call_time"].first').addClass('gray-color').removeClass('active-selected');
	    }else{
	      $('.sort > i[data-type="duration"].second').addClass('gray-color1').removeClass('active-selected');
	      $('.sort > i[data-type="duration"].first').addClass('gray-color').removeClass('active-selected');
	    }
	    $(this).siblings('.second').addClass('gray-color1').removeClass('active-selected');
      $(this).siblings('.first').addClass('gray-color').removeClass('active-selected');
      show_datas(1, 10);
	  }
	});
	
	
	

 </script>
{include file="callrecord/historical_calldetail" /}
{include file="public/call_historical_record_tageter" /}
<!--这是一个测试-->

<!--正在查询中弹窗-->
<div class="l_loadfixed">
	<div class="l_loaddata">
		<p><img src="__PUBLIC__/img_sj/reload.gif" alt="">正在查询中...</p>
		<p>您的数据量较大，为保证查询速度，建议您删除部分通话记录。</p>
	</div>
</div>
<!--/正在查询中弹窗-->
</div>

{/block}
