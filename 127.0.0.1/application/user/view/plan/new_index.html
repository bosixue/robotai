{extend name="public/base" /}
{block name="body"}

<link href="__PUBLIC__/plugs/bsdatepicker/css/bootstrap-datepicker.min.css" rel="stylesheet" type="text/css">
<script src="__PUBLIC__/plugs/bsdatepicker/js/bootstrap-datepicker.js"></script>

<link href="__PUBLIC__/plugs/timepicker/bootstrap-timepicker.css" rel="stylesheet" type="text/css">
<script src="__PUBLIC__/plugs/timepicker/bootstrap-timepicker.js"></script>


<link href="__PUBLIC__/plugs/datepicker/css/foundation-datepicker.min.css" rel="stylesheet" type="text/css">
<script src="__PUBLIC__/plugs/datepicker/js/foundation-datepicker.js"></script>
<script src="__PUBLIC__/plugs/datepicker/js/foundation-datepicker.zh-CN.js"></script>

<script type="text/javascript" src="__PUBLIC__/plugs/webuploader/webuploader.min.js"></script>
<script type="text/javascript" src="__PUBLIC__/plugs/webuploader/webuploader.custom.js"></script>
<link rel="stylesheet" type="text/css" href="__PUBLIC__/plugs/webuploader/webuploader.css">

<script type="text/javascript" src="__PUBLIC__/plugs/bootstrap-select/dist/js/bootstrap-select.min.js"></script>
<link rel="stylesheet" type="text/css" href="__PUBLIC__/plugs/bootstrap-select/dist/css/bootstrap-select.min.css"/>
<link rel="stylesheet" type="text/css" href="__PUBLIC__/css/new_index.css">

<script type="text/javascript" src='/public/js_validation/validation.js'></script>

<style type="text/css">
    .textwidth {
        width: 250px;
    }

    .l-sms {
        display: inline-block;
    }

    .nav-tabs {
        background: #ffffff;
    }

    .nav-tabs {
        border-bottom: 1px solid #ddd;
    }

    .nav-tabs > li.active > a,
    .nav-tabs > li.active > a:focus,
    .nav-tabs > li.active > a:hover {
        color: #555;
        cursor: default;
        background-color: #fff;
        border: 1px solid #ddd;
        border-bottom-color: transparent;
    }

    .panel-default > .panel-heading {
        background-color: #FFFFFF;
        border-color: #FFFFFF;
        color: #FFFFFF;
        border-radius: 0;
        background-clip: padding-box;
    }

    .statusSelect {
        line-height: 30px;
        float: left;
    }

    .ivu-form-item-content {
        position: relative;
        line-height: 32px;
        font-size: 12px;
    }

    .mr15 {
        margin-right: 15px;
    }

    .itemtime {
        position: relative;
        line-height: 32px;
        font-size: 12px;
    }

    .ivu-tag-checked {
        background: #f1f1f1;
    }

    .mt15 {
        margin-top: 15px;
    }

    .mb15 {
        margin-bottom: 15px;
    }

    .ivu-tag {
        display: inline-block;
        height: 22px;
        line-height: 22px;
        margin: 2px 4px 2px 0;
        padding: 0 8px;
        border: 1px solid #e9eaec;
        border-radius: 3px;
        background: #f7f7f7;
        font-size: 12px;
        vertical-align: middle;
        opacity: 1;
        overflow: hidden;
        cursor: pointer;
    }

    :root .ivu-tag .ivu-icon-ios-close-empty {
        font-size: 14px;
    }

    .ivu-tag .ivu-icon-ios-close-empty {
        display: inline-block;
        font-size: 14px;
        font-size: 20px \9;
        transform: scale(1.42857143) rotate(0deg);
        cursor: pointer;
        margin-left: 8px;
        color: #666;
        opacity: .66;
        position: relative;
        top: -1px;
        width: 7px;
        height: 14px;
    }

    .ivu-icon {
        display: inline-block;
        font-family: Ionicons;
        speak: none;
        font-style: normal;
        font-weight: 400;
        font-variant: normal;
        text-transform: none;
        text-rendering: auto;
        line-height: 1;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }

    .ivu-tag-text {
        color: #495060;
    }

    .dropdown-menu > li > a > span {
        color: #000;
    }

    .btn-group > .btn-default {
        background-color: #fff;
        border: 1px solid #ccc;
        color: #555;
    }


    .dropup > .btn-default {
        background-color: #fff;
        border: 1px solid #ccc;
        color: #555;
    }

    .dropup > .btn-default:hover,
    .btn-default:active,
    .btn-default.active,
    .open .dropdown-toggle.btn-default {
        background-color: #fff;
        border: 1px solid #ccc;
    }

    .bootstrap-select > .dropdown-toggle.bs-placeholder,
    .bootstrap-select > .dropdown-toggle.bs-placeholder:active,
    .bootstrap-select > .dropdown-toggle.bs-placeholder:focus,
    .bootstrap-select > .dropdown-toggle.bs-placeholder:hover {
        color: #555;
    }

    .dropup > .btn-default.active.focus,
    .btn-default.active:focus,
    .btn-default.active:hover,
    .btn-default:active.focus,
    .btn-default:active:focus,
    .btn-default:active:hover,
    .open > .dropdown-toggle.btn-default.focus,
    .open > .dropdown-toggle.btn-default:focus,
    .open > .dropdown-toggle.btn-default:hover {
        color: #555;
        background-color: #fff;
        border: 1px solid #ccc;
    }

    .bootstrap-select.btn-group .dropdown-toggle .filter-option {
        color: #555;
    }

    .checkbox-wrapper {
        margin-right: 20px;
    }

    .word {
        line-height: 40px;
        font-size: 14px;
    }

    .bootstrap-select.form-control:not([class*=col-]) {
        width: 250px;
    }

    .dropdown-menu {
        min-width: 0;
    }

    .fa-lg {
        margin-right: 6px;
    }

    .l-width {
        margin-left: 5px;
    }

    .pz_shenlue {
        overflow: hidden;
        white-space: nowrap;
        text-overflow: ellipsis;
        width: 114px;
        display: inline-block;
        vertical-align: top;
    }

     #firstShow .firstShow-body{
        position: absolute;
        display: inline-block;
        top: 185px;
        right: 150px;
        border: 1px solid #fff;
     }

    .firstShow-box{
     /*position: relative; */
    }

    #firstShow button{
      top: 179px;
      right: 568px;
      padding: 4px 9px;
      width: 95px;
      height: 40px;
      position: absolute;
    }


    #firstShow img:nth-of-type(1){
      top: 230px;
      right: 568px;
      position: absolute;
    }

    #firstShow p:nth-of-type(1){
      top: 420px;
      right: 190px;
      color: #ffffff;
      font-size: 32px;
      font-weight: bold;
      position: absolute;

    }

    #firstShow img:nth-of-type(2){
      top: 490px;
      right: 365px;
      cursor: pointer;
      position: absolute;
    }

    #firstShow p:nth-of-type(2){
      top: 500px;
      right: 410px;
      color: #ffffff;
      font-size: 22px;
     font-weight: bold;
     cursor: pointer;
     position: absolute;
    }

    .variable{
      width: 230px;
      padding: 35px 20px 30px 20px;
      background: #fff;
      box-shadow: 0px 2px 8px 0px rgba(12, 4, 8, 0.2);
      display: inline-block;
      position: relative;
      z-index: 2;
      top: 6px;
    }

    .variable::after{
       content: '';
      position: absolute;
      width: 15px;
      height: 15px;
      box-shadow: -1px -1px 8px 0px rgba(12, 4, 8, 0.2);
      background: #fff;
      top: -8px;
      left: 35px;
      transform: rotate(45deg);

    }

    .variable::before{
      content: '';
      position: absolute;
      width: 22px;
      height: 17px;
      background: #fff;
      top: 0px;
      left: 31px;
      z-index: 10;
    }



    .variable .variable-body{
      margin-bottom: 10px;
    }

    .variable-body{
      text-align: left;
    }


    .variable-body span:nth-of-type(1){
      font-size: 14px;
      color: #000000;
    }

    .variable-body span:nth-of-type(2){
      font-size: 14px;
      color: #0e90fd;
    }

    .variable-box{
      position: absolute;
      left: 2px;
      top: 40px;
    }

    .button-list{
      position: relative;
    }

    .synthesis-success{
     border: solid 1px #0e90fd;
     background-color: #ffffff;
     position: relative;
     color: #0e90fd;
     padding: 12px 14px;
     border-radius: 5px;
    }

    .synthesis-success:after{
      content: '';
      position: absolute;
      width: 13px;
      height: 13px;
      background: #fff;
      border: 1px solid #0e90fd;
      border-right: 0px;
      border-bottom: 0px;
      top: -7px;
      left: 31px;
      transform: rotate(45deg);
    }

    .variable-synthesis{
      position: fixed;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      display: block ;
      background: rgba(0, 0, 0, 0.5);
      z-index: 999;
      overflow:hidden;
    }

    .aidierus{
     background-color: #0e90fd;
     z-index: 99999;
    }

    .variable-synthesis-tip{
      position: relative;
      width: 100%;
      height: 100%;
    }

    .variable-synthesis-tips{
      position: absolute;
      top: 225px;
      right: 425px;
    }

    .variable-synthesis-tips p:nth-of-type(1){
      font-size: 32px;
      color: #ffffff;
      font-weight: bold;
    }

    /*正在合成按钮样式*/
    .in-synthesis{
      background-color: #fefefe;
    	border-radius: 5px;
    	border: solid 1px #0e90fd;
    	color:#0e90fd ;
    }


    @media(max-width: 1468px){
      #firstShow button {
        top: 209px;
      }

      #firstShow img:nth-of-type(1){
        top:260px;
      }

      #firstShow p:nth-of-type(1){
        top: 455px;
      }

      #firstShow img:nth-of-type(2){
        top:515px;
      }

      #firstShow p:nth-of-type(2){
        top: 525px;
      }
    }

    @media(max-width: 1213px){
      .marginr10 {
        margin-right: 5px;
      }

    .n_headrightbotton > div > button{
        padding: 0px 3px;
        font-size: 13px;

      }
    }


     #firstShow{
      min-width: 1200px;
      overflow-x: hidden;
    }



</style>
<div class="row variable-tips">
    <div class="col-lg-12">
        <div class="main-box clearfix fadeInRight animated pz_manping_height">
            <header class="main-box-header clearfix" style="padding:20px">
                <div class="pull-left" style="line-height:34px;">
                    <span class="n_panel_title"><img src="/public/img/renwuzhongxin.png"/>任务管理</span>
                </div>
                <div class="pull-right clearfix">
                    <div class="n_taskbotton dflex pull-right">
                        <button type="button" class="btn btn-primary" data-title="新建任务" onclick="addNewPlan(this);">
                            <span>新建任务</span></button>
                        <button type="button" class="btn btn-primary" onclick="refurbish();"><span>刷新列表</span></button>
                        <button type="button" class="btn btn-default ant-btn" data-title="暂停所有任务"
                                onclick="popTipswin(this);"><span>暂停所有任务</span></button>
                    </div>
                    <div class="n_listselect dflex pull-right">
                        <div class="form-group pr">
                            <select name="rotation" id="n_seltaskstate" class="form-control c_selectimg resetSel">
                                <option value=" " selected="">选择任务状态</option>
                                <option value="0">待启动</option>
                                <option value="1">进行中</option>
                                <option value="2">人工暂停</option>
                                <option value="5">定时暂停</option>
                                <option value="6">异常暂停</option>
                                <option value="4">欠费暂停</option>
                                <option value="3">已完成</option>
                                <option value="-1">已删除</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <input type="text" class="form-control" name="task_name" id="taskName" value=""
                                   placeholder="请输入任务名称">
                        </div>
                        <button class="btn btn-primary n_resetbotton" type="reset" onclick="show_task_list('html')">查询
                        </button>
                    </div>
                </div>
            </header>
            <div class="l_loadfixed" style="display: none;">
                <div class="l_loaddata">
                    <p><img src="/public/img_sj/reload.gif" alt="">正在加载中...</p>
                    <p>&nbsp;</p>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row n_content">
                    <!-- 我的任务模块 -->
                    <div class="col-xs-4 col-md-3 mytask">
                        <div class="ant-spin-container">
                            <div class="dm-task-list">
                                <!-- 任务头部 -->
                                <div class="n_taskhead">
                                    <span>我的任务</span>
                                </div>
                                <div class="c_taskleftdata pz_innerbox"></div>
                            </div>
                        </div>
                    </div>
                    <!-- 任务详情 -->
                    <div class="col-xs-14 col-md-9 dm-task-detail">
                        <!-- 当前任务的ID -->
                        <input type="hidden" name="nowTaskID" id="nowTaskID" value=""/>
                        <div class="ant-spin-nested-loading" id="nestedloading">
                            <div class="ant-spin-container" id="spinContainer">
                                <div class="header">
                                    <div class="header-top">
                                        <div class="header-info pull-left">
                                            <!-- <span class="fl htitle" id="righttitle"></span> -->
                                            <div class="n_tasktitle">
                                                <span id="task_name">暂无任务</span>
                                                <span>(任务详情)</span>
                                            </div>
                                        </div>
                                        <div class="button-list pull-right n_headrightbotton">
                                            <div class="btn-group" role="group" aria-label="...">
                                                <button type="button" class="btn btn-primary marginr10" id="luyinshengcheng" style="display:none;"
                                                        data-title="生成录音" onclick="create_luyin();"><span>合成录音</span>
                                                </button>
                                                <button type="button" class="btn btn-primary marginr10 aidieru aidierus " id="aidieru"
                                                        data-title="开始任务" onclick="popTipswin(this);"><span>开始任务</span>
                                                </button>
                                                <!--<button type="button" class="btn btn-primary marginr10" id="suspend" data-title="暂停任务" onclick="popTipswin(this);"><span>暂停任务</span></button>-->
                                                <button type="button" class="btn btn-primary marginr10"
                                                        id="dropdownMenu1" data-toggle="dropdown"
                                                        aria-haspopup="true" aria-expanded="true"
                                                        onclick="loadexcel();">导入号码
                                                </button>
                                                {php}if(config('export_phone_status') == true):{/php}
                                                <button type="button" class="btn btn-primary marginr10" id="daochuPhone"
                                                        data-toggle="modal" data-title="导出号码"
                                                        onclick="popTipswin(this);">导出全部号码
                                                </button>
                                                <button type="button" class="btn btn-primary marginr10" id="daoruPhone"
                                                        data-toggle="modal" data-title="导出未拨打号码"
                                                        onclick="popTipswin(this);">导出未拨打号码
                                                </button>
                                                {php}endif;{/php}
                                                <button type="button" class="btn btn-primary marginr10" id="edit-opt"
                                                        onclick="editNewPlan(this);"><span>编辑任务</span></button>
                                                <!-- <button type="button" class="btn btn-primary marginr10" id="end-opt" data-title="终止任务"  onclick="popTipswin(this);"><span>终止任务</span></button> -->
                                                <button type="button" class="btn btn-primary marginr10" id="del-opt"
                                                        data-title="删除任务" onclick="popTipswin(this);"><span>删除任务</span>
                                                </button>
                                            </div>
                                            <div class="variable-box">
                                              <div class="variable hide">
                                                <div class="variable-body">
                                                  <span>合成进度：</span>
                                                  <span id="hechengjindu">1/100</span>
                                                </div>
                                                <div class="variable-body">
                                                  <span>合成预计所需时间：</span>
                                                  <span id='yuji_time'>10分钟</span>
                                                </div>
                                              </div>
                                              <div class="synthesis-success hide">
                                                <p>变量合成成功，您可立即开启当前任务 </p>
                                              </div>
                                            </div>
                                        </div>
                                        <div style="clear: both;"></div>
                                    </div>
                                    <p><span class="body-tips" id="bodytips"></span></p>
                                    <div class="detail-info">
                                        <div class="section-item" id="scenariostext"></div>
                                        <div class="section">
                                            <!-- <div class="section-item">任务名称：<span id="task_name">  </span></div> -->
                                            <div class="section-item"><span>任务状态：</span><span id="task_status"> </span></div>
                                            <div class="section-item"><span>话术模板：</span><span id="scenarios_name"></span></div>
                                            <div class="section-item"><span>拨打线路：</span><span id="call_type"></span></div>

                                            <div class="section-item"><span>ASR：</span><span id="is_ASR"></span></div>

                                            <div class="section-item"><span>占用机器人个数：</span><span id="robot_cnt">个</span></div>
                                            <div class="section-item"><span>接通率：</span><span id="jietonglv"></span></div>

                                            <div class="section-item timing-section">
                                                <span>是否定时：</span>
                                                <span id="is_timing"></span>
                                                <div class="timings">
                                                    <div class="timing-show hide" id="timing">
                                                        <div class="pz_innerbox_lay timing-body">
                                                            <label>时间：</label>
                                                            <div class="timing-time">
                                                            </div>
                                                            <label>日期：</label>
                                                            <div class="timing-date">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="section-item"><span>是否加入CRM：</span><span id="add_crm_status">否</span></div>
                                            <div class="section-item"><span>是否公众号推送：</span><span id="wx_push_show_status"></span></div>
                                            <div class="section-item"><span>是否短信推送：</span><span id="sms_show_status"></span></div>
                                            <div class="section-item"><span>重复呼叫次数：</span><span id="show_again_call_count"></span></div>
                                            <!--<div class="section-item"><span>是否启动打断：</span><span id="scenarios_break"></span></div>-->
                                            <!--<div class="section-item"><span>创建时间：</span><span id="create_time"></span></div>-->
                                            <div class="section-item"><span>最后拨打时间：</span><span id="last_dial_time_a"></span></div>
                                        </div>
                                        <div class="section n_note">
                                            <div class="section-item"><span>备注：</span><span id="beizhu"></span></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="body" id="spinContainerbody">
                                <!--
                                <div class="status">
                                    <div class="task-status fl">
                                        <h5>任务状态</h5>
                                        <ul>
                                            <li>
                                                <div class="ant-progress ant-progress-circle ant-progress-status-normal ant-progress-show-info call"></div>
                                                <span class="status-label">外呼进度</span>
                                            </li>
                                            <li>
                                                <div class="ant-progress ant-progress-circle ant-progress-status-normal ant-progress-show-info call"></div>
                                                <span class="status-label">电话接通率</span>
                                            </li>
                                        </ul>
                                    </div>

                                    <div class="answer-status fr">
                                        <h5>接听状态<span>已拨打电话 0 通</span></h5>
                                        <div class="answer-state">

                                            <div class="row">
                                                <div class="row-item"><b>0</b><span>已接通</span></div>
                                                <div class="row-item"><b>0</b><span>拒接</span></div>
                                                <div class="row-item"><b>0</b><span>空号</span></div>
                                                <div class="row-item"><b>0</b><span>关机</span></div>
                                                <div class="row-item"><b>0</b><span>占线</span></div>
                                                <div class="row-item"><b>0</b><span>黑名单</span></div>
                                            </div>

                                            <div class="row">
                                                <div class="row-item"><b>0</b><span>停机</span></div>
                                                <div class="row-item"><b>0</b><span>未接</span></div>
                                                <div class="row-item"><b>0</b><span>主叫欠费</span></div>
                                                <div class="row-item"><b>0</b><span>无法接通</span></div>
                                                <div class="row-item"><b>0</b><span>外呼失败</span></div>
                                                <div class="row-item"><b>0</b><span>呼损</span></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                 -->
                                <div style="clear: both;"></div>
                                <div class="detail-statics">
                                    <div class="itempgl">
                                        <h5>客户意向等级<span class="glyphicon glyphicon-question-sign l-width"
                                                        aria-hidden="true"></span></h5>
                                        <div class="progress-box intention-box">
                                            <div class="gbibitem">
                                                <span class="progress-label" style="width:0%;"
                                                      id="grade_a">A级(<span></span>)</span>
                                                <div class="fr wth7">
                                                    <div class="progress margintop6 fl">
                                                        <div class="progress-bar progress-bar-success"
                                                             role="progressbar" id="typeA" aria-valuenow="0"
                                                             aria-valuemin="0" aria-valuemax="100" style="width: 0%">
                                                            <span class="sr-only">0% Complete (success)</span>
                                                        </div>
                                                    </div>
                                                    <span class="ant-progress-text fr" id="typeApc">0%</span>
                                                </div>
                                            </div>
                                            <div style="clear: both;"></div>
                                            <div class="gbibitem">
                                                <span class="progress-label" style="width:0%;"
                                                      id="grade_b">B级(<span></span>)</span>
                                                <div class="fr wth7">
                                                    <div class="progress margintop6 fl">
                                                        <div class="progress-bar progress-bar-success"
                                                             role="progressbar" id="typeB" aria-valuenow="0"
                                                             aria-valuemin="0" aria-valuemax="100" style="width: 0%">
                                                            <span class="sr-only">0% Complete (success)</span>
                                                        </div>
                                                    </div>
                                                    <span class="ant-progress-text fr" id="typeBpc">0%</span>
                                                </div>
                                            </div>
                                            <div style="clear: both;"></div>
                                            <div class="gbibitem">
                                                <span class="progress-label" style="width:30%;"
                                                      id="grade_c">C级(<span></span>)</span>
                                                <div class="fr wth7">
                                                    <div class="progress margintop6 fl">
                                                        <div class="progress-bar progress-bar-success"
                                                             role="progressbar" id="typeC" aria-valuenow="0"
                                                             aria-valuemin="0" aria-valuemax="100" style="width: 0%">
                                                            <span class="sr-only">0% Complete (success)</span>
                                                        </div>
                                                    </div>
                                                    <span class="ant-progress-text fr" id="typeCpc">0%</span>
                                                </div>
                                            </div>
                                            <div style="clear: both;"></div>
                                            <div class="gbibitem">
                                                <span class="progress-label" style="width:30%;"
                                                      id="grade_d">D级(<span></span>)</span>
                                                <div class="fr wth7">
                                                    <div class="progress margintop6 fl">
                                                        <div class="progress-bar progress-bar-success"
                                                             role="progressbar" id="typeD" aria-valuenow="0"
                                                             aria-valuemin="0" aria-valuemax="100" style="width: 0%">
                                                            <span class="sr-only">0% Complete (success)</span>
                                                        </div>
                                                    </div>
                                                    <span class="ant-progress-text fr" id="typeDpc">0%</span>
                                                </div>
                                            </div>
                                            <div style="clear: both;"></div>
                                            <div class="gbibitem">
                                                <span class="progress-label" style="width:30%;"
                                                      id="grade_e">E级(<span></span>)</span>
                                                <div class="fr wth7">
                                                    <div class="progress margintop6 fl">
                                                        <div class="progress-bar progress-bar-success"
                                                             role="progressbar" id="typeE" aria-valuenow="0"
                                                             aria-valuemin="0" aria-valuemax="100" style="width: 0%">
                                                            <span class="sr-only">0% Complete (success)</span>
                                                        </div>
                                                    </div>
                                                    <span class="ant-progress-text fr" id="typeEpc">0%</span>
                                                </div>
                                            </div>
                                            <div style="clear: both;"></div>
                                            <div class="gbibitem">
                                                <span class="progress-label" style="width:30%;"
                                                      id="grade_f">F级(<span></span>)</span>
                                                <div class="fr wth7">
                                                    <div class="progress margintop6 fl">
                                                        <div class="progress-bar progress-bar-success"
                                                             role="progressbar" id="typeF" aria-valuenow="0"
                                                             aria-valuemin="0" aria-valuemax="100" style="width: 0%">
                                                            <span class="sr-only">0% Complete (success)</span>
                                                        </div>
                                                    </div>
                                                    <span class="ant-progress-text fr" id="typeFpc">0%</span>
                                                </div>
                                            </div>

                                        </div>
                                    </div>

                                    <div class="vertical-line"></div>
                                    <div class="itempgl">
                                        <h5>通话时长</h5>
                                        <div class="progress-box intention-box">
                                            <div class="gbibitem">
                                                <span class="progress-label" style="width:30%;"> 1-9s </span>
                                                <div class="fr wth7">
                                                    <div class="progress margintop6 fl">
                                                        <div class="progress-bar progress-bar-success"
                                                             role="progressbar" id="longA" aria-valuenow="0"
                                                             aria-valuemin="0" aria-valuemax="100" style="width: 0%">
                                                            <span class="sr-only">0% Complete (success)</span>
                                                        </div>
                                                    </div>
                                                    <span class="ant-progress-text fr" id="longApc">0%</span>
                                                </div>
                                            </div>
                                            <div style="clear: both;"></div>
                                            <div class="gbibitem">
                                                <span class="progress-label" style="width:30%;">10-17s</span>
                                                <div class="fr wth7">
                                                    <div class="progress margintop6 fl">
                                                        <div class="progress-bar progress-bar-success"
                                                             role="progressbar" id="longB" aria-valuenow="0"
                                                             aria-valuemin="0" aria-valuemax="100" style="width: 0%">
                                                            <span class="sr-only">0% Complete (success)</span>
                                                        </div>
                                                    </div>
                                                    <span class="ant-progress-text fr" id="longBpc">0%</span>
                                                </div>
                                            </div>
                                            <div style="clear: both;"></div>
                                            <div class="gbibitem">
                                                <span class="progress-label" style="width:30%;">18-39s</span>
                                                <div class="fr wth7">
                                                    <div class="progress margintop6 fl">
                                                        <div class="progress-bar progress-bar-success"
                                                             role="progressbar" id="longC" aria-valuenow="0"
                                                             aria-valuemin="0" aria-valuemax="100" style="width: 0%">
                                                            <span class="sr-only">0% Complete (success)</span>
                                                        </div>
                                                    </div>
                                                    <span class="ant-progress-text fr" id="longCpc">0%</span>
                                                </div>
                                            </div>
                                            <div style="clear: both;"></div>
                                            <div class="gbibitem">
                                                <span class="progress-label" style="width:30%;">>40s以上</span>
                                                <div class="fr wth7">
                                                    <div class="progress margintop6 fl">
                                                        <div class="progress-bar progress-bar-success"
                                                             role="progressbar" id="longD" aria-valuenow="0"
                                                             aria-valuemin="0" aria-valuemax="100" style="width: 0%">
                                                            <span class="sr-only">0% Complete (success)</span>
                                                        </div>
                                                    </div>
                                                    <span class="ant-progress-text fr" id="longDpc">0%</span>
                                                </div>
                                            </div>
                                            <div style="clear: both;"></div>
                                        </div>
                                    </div>

                                    <div class="vertical-line"></div>
                                    <div class="itempgl">
                                        <h5>说话次数</h5>
                                        <div class="progress-box intention-box">
                                            <div class="gbibitem">
                                                <span class="progress-label" style="width:30%;">1-2次</span>
                                                <div class="fr wth7">
                                                    <div class="progress margintop6 fl">
                                                        <div class="progress-bar progress-bar-success" id="rotationA"
                                                             role="progressbar" aria-valuenow="0"
                                                             aria-valuemin="0" aria-valuemax="100" style="width: 0%">
                                                            <span class="sr-only">40% Complete (success)</span>
                                                        </div>
                                                    </div>
                                                    <span class="ant-progress-text fr" id="rotationApc">0%</span>
                                                </div>
                                            </div>
                                            <div style="clear: both;"></div>
                                            <div class="gbibitem">
                                                <span class="progress-label" style="width:30%;">3-4次</span>
                                                <div class="fr wth7">
                                                    <div class="progress margintop6 fl">
                                                        <div class="progress-bar progress-bar-success" id="rotationB"
                                                             role="progressbar" aria-valuenow="0"
                                                             aria-valuemin="0" aria-valuemax="100" style="width: 0%">
                                                            <span class="sr-only">40% Complete (success)</span>
                                                        </div>
                                                    </div>
                                                    <span class="ant-progress-text fr" id="rotationBpc">0%</span>
                                                </div>
                                            </div>
                                            <div style="clear: both;"></div>
                                            <div class="gbibitem">
                                                <span class="progress-label" style="width:30%;">5-6次</span>
                                                <div class="fr wth7">
                                                    <div class="progress margintop6 fl">
                                                        <div class="progress-bar progress-bar-success" id="rotationC"
                                                             role="progressbar" aria-valuenow="0"
                                                             aria-valuemin="0" aria-valuemax="100" style="width: 0%">
                                                            <span class="sr-only">40% Complete (success)</span>
                                                        </div>
                                                    </div>
                                                    <span class="ant-progress-text fr" id="rotationCpc">0%</span>
                                                </div>
                                            </div>
                                            <div style="clear: both;"></div>
                                            <div class="gbibitem">
                                                <span class="progress-label" style="width:30%;">7-10次</span>
                                                <div class="fr wth7">
                                                    <div class="progress margintop6 fl">
                                                        <div class="progress-bar progress-bar-success" id="rotationD"
                                                             role="progressbar" aria-valuenow="0"
                                                             aria-valuemin="0" aria-valuemax="100" style="width: 0%">
                                                            <span class="sr-only">40% Complete (success)</span>
                                                        </div>
                                                    </div>
                                                    <span class="ant-progress-text fr" id="rotationDpc">0%</span>
                                                </div>
                                            </div>
                                            <div style="clear: both;"></div>
                                            <div class="gbibitem">
                                                <span class="progress-label" style="width:30%;">10次以上</span>
                                                <div class="fr wth7">
                                                    <div class="progress margintop6 fl">
                                                        <div class="progress-bar progress-bar-success" id="rotationE"
                                                             role="progressbar" aria-valuenow="0"
                                                             aria-valuemin="0" aria-valuemax="100" style="width: 0%">
                                                            <span class="sr-only">40% Complete (success)</span>
                                                        </div>
                                                    </div>
                                                    <span class="ant-progress-text fr" id="rotationEpc">0%</span>
                                                </div>
                                            </div>
                                            <div style="clear: both;"></div>
                                        </div>
                                    </div>

                                </div>
                                <div class="clearfix percentage">
                                    <div style="width: 33%;">
                                        <div class="icn_f"
                                             style="width: 145px;height: 35px;line-height: 35px;padding:0px!important;"
                                             id="AaddB">意向率A+B：(0%)
                                        </div>
                                    </div>
                                    <div style="width: 33%;">
                                        <div class="icn_f"
                                             style="width: 139px;height: 35px;line-height: 35px;padding:0px!important;"
                                             id="averageTime">平均通话时长：0s
                                        </div>
                                    </div>
                                    <div style="width: 33%;">
                                        <div class="icn_f"
                                             style="width: 139px;height: 35px;line-height: 35px;padding:0px!important;"
                                             id="talk_count">平均说话次数：0次
                                        </div>
                                    </div>
                                </div>

                            </div>
                            <!--每次页码储存-->
                            <input type="hidden" id="page" value="">
                            <div class="records" id="spinContainerrecords">
                                <div class="component-base-button">
                                    <!--<button type="button" class="btn btn-default ant-btn marginr10"><span>添加到新任务拨打(0)</span></button>-->
                                </div>
                                <div class="ant-tabs ant-tabs-top ant-tabs-line">
                                    <!-- Nav tabs -->
                                    <!-- <ul class="nav nav-tabs" role="tablist" style="margin-bottom: 20px;">
											<li role="presentation" class="active"><a href="#home" aria-controls="home" role="tab" data-toggle="tab">进行中</a></li>
											<li role="presentation"><a href="#profile" aria-controls="profile" role="tab" data-toggle="tab">已完成</a></li>
										</ul> -->
                                    <div class="n_tabselect clearfix">
                                        <div class="pull-left" style="width:100%">
                                            <form class="form-inline" method="get" role="form">
                                                <div class="form-group">
                                                    <select name="n_liststate" id="n_liststate"
                                                            class="form-control c_selectimg">
                                                        <option value="2">全部</option>
                                                        <option value="0">已完成</option>
                                                        <option value="1">排队中</option>
                                                    </select>
                                                </div>

                                                <div class="form-group">
                                                    <select name="activeMode" id="activeMode"
                                                            class="form-control c_selectimg">
                                                        <option value=" " selected="">选择通话状态</option>
                                                        <option value="2">已接听</option>
                                                        <option value="3">无人接听</option>
                                                        <option value="4">停机</option>
                                                        <option value="5">空号</option>
                                                        <option value="6">正在通话中</option>
                                                        <option value="7">关机</option>
                                                        <option value="8">用户拒接</option>
                                                        <option value="9">网络忙</option>
                                                        <option value="10">来电提醒</option>
                                                        <option value="11">呼叫转移失败</option>
                                                    </select>
                                                </div>

                                                <div class="form-group">
                                                    <select name="Lengthoftime" id="Lengthoftime"
                                                            class="form-control c_selectimg">
                                                        <option value=" " selected="">选择通话时长</option>
                                                        <option value="1">1s-9s</option>
                                                        <option value="2">10s-17s</option>
                                                        <option value="3">18s-39s</option>
                                                        <option value="4">>40s</option>
                                                    </select>
                                                </div>

                                                <div class="form-group">
                                                    <select name="rotation" id="rotation"
                                                            class="form-control c_selectimg">
                                                        <option value=" " selected="">选择说话次数</option>
                                                        <option value="1">1-2次</option>
                                                        <option value="2">3-4次</option>
                                                        <option value="3">5-6次</option>
                                                        <option value="4">7-10次</option>
                                                        <option value="5">10次以上</option>
                                                    </select>
                                                </div>

                                                <div class="form-group">
                                                    <select name="Levelofintention" id="Levelofintention"
                                                            class="form-control c_selectimg">
                                                        <option value=" "> 选择意向等级</option>
                                                        <option value="6">A级(意向客户)</option>
                                                        <option value="5">B级(一般意向)</option>
                                                        <option value="4">C级(简单对话)</option>
                                                        <option value="3">D级(无有效对话)</option>
                                                        <option value="2">E级(有效未接通)</option>
                                                        <option value="1">F级(无效号码)</option>

                                                    </select>
                                                </div>

                                                <button type="button" onclick="getsearch2();" class="btn btn-primary">
                                                    查询
                                                </button>
                                                <button type="button" class="btn pz_kongxin_anniusty"
                                                        onclick="resetting();">重置
                                                </button>
                                                <a href="javascript:;" class="btn btn-primary pull-right"
                                                   id='see_details' style="padding:6px;margin-top:10px">查看任务详情</a>
                                            </form>
                                        </div>
                                    </div>

                                    <!-- Tab panes -->
                                    <div class="tab-content">
                                        <div role="tabpanel" class="tab-pane" id="home">
                                            <div class="table-responsive">

                                                <table class="table table-bordered table-hover">

                                                    <thead class="ant-table-thead">
                                                    <tr>
                                                        <th class="text-center"><span>客户</span></th>
                                                        <th class="text-center"><span>号码</span></th>
                                                        <th class="text-center"><span>通话状态</span></th>
                                                        <th class="text-center"><span>通话时间</span></th>

                                                        <th class="text-center"><span>主叫号码</span></th>
                                                    </tr>
                                                    </thead>

                                                    <tbody class="ant-table-tbody" id="tablelearninglist">


                                                    </tbody>
                                                </table>

                                                <div class="row">
                                                    <div class="col-sm-4 text-left">
                                                    </div>
                                                    <div class="col-sm-8 text-right"></div>
                                                </div>

                                                <div id="modalbody"></div>


                                                <div id="componentempty" class="component-page-empty">
                                                    <div class="empty-tip line">
                                                        暂无数据
                                                    </div>
                                                </div>


                                            </div>

                                        </div>
                                        <div role="tabpanel" class="tab-pane active" id="profile">
                                            <div class="table-responsive">
                                                <table class="table table-bordered table-hover">
                                                    <thead class="ant-table-thead">
                                                    <tr>
                                                        <th class="text-center"><span>序号</span></th>
                                                        <th class="text-center"><span>客户号码</span></th>
                                                        <th class="text-center"><span>姓名</span></th>
                                                        <th class="text-center"><span>通话状态</span></th>
                                                        <th class="text-center"><span>通话时长(S)</span></th>
                                                        <th class="text-center"><span>客户意向等级</span></th>
                                                        <th class="text-center"><span>说话次数</span></th>
                                                        <th class="text-center"><span>通话时间</span></th>

                                                        <!-- <th class="text-center"><span>操作</span></th> -->
                                                    </tr>
                                                    </thead>
                                                    <tbody class="ant-table-tbody" id="tablealreadylist">

                                                    </tbody>
                                                </table>

                                                <div class="row">
                                                    <div class="col-sm-4 text-left">
                                                    </div>
                                                    <div class="col-sm-8 text-right"></div>
                                                </div>

                                                <div class="n_listbotrihgt pull-left">
                                                    <!-- <div class="n_listselall"> -->
                                                    <!-- <input class="icheckbox_square-blue"  onclick="checkboxAll(this)" id="bottom_all_check" type="checkbox"> -->
                                                    <!-- <span id="ckeckboxCount">选中了0条数据</span> -->
                                                    <!-- <span id="ckeckboxCount">选中了0条数据</span> -->
                                                    <!-- </div> -->
                                                    <!-- <div class="n_listopear">
																<a href="javascript:;" data-title="导出号码" onclick="outexcelSelect();"><img src="__PUBLIC__/img/daochuwenjian.png" alt="">导出</a>
																<a href="javascript:;" data-title="批量删除" onclick="delMemAll();"><img src="__PUBLIC__/img/piliangshanchu.png" alt="">批量删除</a>
															</div> -->
                                                </div>
                                                <div id="modalpagebody"></div>
                                            </div>
                                            <div class="component-page-empty" id="pegeempty">
                                                <div class="empty-tip line">
                                                    <p><img src="__PUBLIC__/img/none.png"/></p>
                                                    <p>暂无数据</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>

                        </div>

                    </div>

                </div>

            </div>

        </div>
    </div>
</div>

<div class="modal fade effect" id="effectTmp" tabindex="1" role="dialog" aria-labelledby="myLargeModalLabel"
     data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog" style="width:365px;">
        <div class="modal-content effect-content import">
            <div class="modal-header effect-header">
                <!--<button type="button" class="close" data-dismiss="modal" aria-label="Close"> <span aria-hidden="true">×</span>-->
                <!--</button>-->
                <h4 class="modal-title effect-title" id="singleTel"><span>导入号码</span></h4>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <div class="effect-1">
                        <span>当前进度</span>
                        <span class="pull-right color90 Progress_value">0%</span>
                    </div>
                </div>
                <div class="form-group">
                    <div class="progress">
                        <div class="progress-bar progress-bar-data" role="progressbar" aria-valuenow="60"
                             aria-valuemin="0" aria-valuemax="100" style="width: 0%;">
                            <span class="sr-only">0%完成</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer effect-footer">
                <div>取 消</div>
            </div>
        </div>
        <div class="modal-content effect-content hidden finish">
            <div class="modal-header effect-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title effect-title">导入号码</h4>
            </div>
            <div class="modal-body">
                <div class="form-group effect-flex">
                    <i class="effect-success"></i>
                    <div class="effect-success-tip" id="effect-tips-content">

                    </div>
                </div>
            </div>
            <div class="modal-footer effect-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal" id="upload_ok">确定</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade effect" id="outexcel_degree" tabindex="1" role="dialog" aria-labelledby="myLargeModalLabel"
     data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog" style="width:365px;">
        <div class="modal-content effect-content import">
            <div class="modal-header effect-header">
                <!--<button type="button" class="close" data-dismiss="modal" aria-label="Close"> <span aria-hidden="true">×</span>-->
                <!--</button>-->
                <h4 class="modal-title" id="singleTel_out"><span>导出号码</span></h4>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <div class="effect-1">
                        <span>当前进度</span>
                        <span class="pull-right color90 Progress_value">0%</span>
                    </div>
                </div>
                <div class="form-group">
                    <div class="progress">
                        <div class="progress-bar progress-bar-data" role="progressbar" aria-valuenow="60"
                             aria-valuemin="0" aria-valuemax="100" style="width: 0%;">
                            <span class="sr-only">0%完成</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer effect-footer">
                <div>取 消</div>
            </div>
        </div>
        <div class="modal-content effect-content hidden finish">
            <div class="modal-header effect-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title effect-title" id="singleTel_out2">导出号码</h4>
            </div>
            <div class="modal-body">
                <div class="form-group effect-flex">
                    <i class="effect-success"></i>
                    <div class="effect-success-tip" id="effect-tips-content_outexcel">

                    </div>
                </div>
            </div>
            <div class="modal-footer effect-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal" id="upload_oks">确定</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="firstShow" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" data-backdrop="static" data-keyboard="false">
  <button class="btn btn-primary">合成录音</button>
  <img src="__PUBLIC__/img/jiantou1.png">
  <p>开启任务之前，您需要进行变量合成</p>
  <img src="__PUBLIC__/img/anniu_1.png" id="know">
  <p id="knows">我知道了</p>
</div>





<script type='text/template' id='task_option'>
    <div class="c_tasklshow" onclick="click_data_info(this);" data-typeid="1" data-id="{%id%}" title="{%title%}">
        <div class="task_user clearfix">
            <p class="pull-left" title="{%name%}">{%name%}</p>
        </div>
        <div class="task_progress clearfix">
            <div class="progress">
                <div class="progress-bar  progress-bar-success" aria-valuenow="40" aria-valuemax="100" aria-valuemin="0"
                     style="width:{%rate%}%"></div>
            </div>
            <span class="task_left_schedule_two">进度{%complete_count%}/{%count%}</span>
        </div>
        <div class="task_type">
            <p>任务状态：<span class="tag-text">{%state_name%}</span></p>
            <p>创建时间：<span>{%create_datetime%}</span></p>
        </div>
        <i></i>
    </div>
</script>

<script type="text/javascript">

    $(function(){

      var Width  = $(window).width();

        widthPosition(Width);

      $(window).resize(function(){

        Width = $(window).width();

        widthPosition(Width);

    })

      <?php if($var_first_create == 1): ?>
       $('#firstShow').modal('show');

      <?php endif; ?>
    })


    function widthPosition(Width){

      if(Width < 991){

        $('#firstShow button').css('right','650px');

        $('#firstShow button').css('width','87px');

        $('#firstShow img:nth-of-type(1)').css('right','645px');

        $('#firstShow p:nth-of-type(1)').css('right','265px');

      }else if(Width > 991  && Width <= 1170){

        $(".variable-tips").css('min-width','900px');

        $('#firstShow button').css('right','572px');

        $('#firstShow button').css('width','90px');

        $('#firstShow img:nth-of-type(1)').css('right','568px');

        $('#firstShow p:nth-of-type(1)').css('right','190px');

      }else if(Width >= 1171 && Width <= 1185){

        $('#firstShow button').css('right','563px');

      }else if(Width >=1186 && Width <=1210 ){

        $('#firstShow button').css('right','555px');

      }else if(Width >= 1213){
         $('#firstShow button').css('right','570px');
      }

    }

    $('#know,#knows').click(function(){
       $('#firstShow').modal('hide');
       $(".variable-tips").css('min-width','auto');
    })

    function resetting() {
        $("#n_liststate option:first").prop("selected", 'selected');
        $("#activeMode option:first").prop("selected", 'selected');
        $("#Lengthoftime option:first").prop("selected", 'selected');
        $("#rotation option:first").prop("selected", 'selected');
        $("#Levelofintention option:first").prop("selected", 'selected');
        getsearch2()
    }

    function effectTmp() {
        var task_id = $("#nowTaskID").val();
        var url = "{:url('member/effectTmp')}"
        $.ajax({
            type: 'POST',
            dataType: "json",
            data: {
                task_id: task_id,
            },
            url: url,
            success: function (result) {
                $(".progress-bar-data").width((result.data.baifenbi) + '%');
                $(".Progress_value").html((result.data.baifenbi.toFixed(2)) + '%');
            },
            error: function () {
            }
        });
    }


    var import_dingshi;

    $(function () {

        var numArr = new Array();
        $('.Idlist').each(function () {
            numArr.push($(this).val()); //添加至数组
        });

        // if(numArr.length > 0){

        $("#taskItem" + numArr[0]).addClass("task-item-active");
        $("#taskItem" + numArr[0]).siblings(".task-item-active").removeClass("task-item-active");


        $("#righttitle").text($("#taskItem" + numArr[0]).attr("title"));
        /////////////////////////////
        // 绑定当前任务的ID
        $("#taskID").val(numArr[0]);
        $("#taskexampletaskID").val(numArr[0]);
        $("#nowTaskID").val(numArr[0]);

        taskId = numArr[0];
        //获取等待列表
        searchdata(1, numArr[0]);

        //获取已经拨打列表
        // getsearch(1,numArr[0]);

        //获取当前计划的配置
        getConfig(numArr[0]);

        // 执行任务  获取任务的 客户意向等级 数据详情
        implement(numArr[0]);

        //通话时长
        getTalktime(numArr[0]);

        //通话轮次
        getTalkRotation(numArr[0]);


        // 1.基本参数设置
        var options = {
            type: 'POST', // 设置表单提交方式
            url: "{:url('user/member/importExcel')}", // 设置表单提交URL,默认为表单Form上action的路径
            dataType: 'json', // 返回数据类型
            beforeSubmit: function (formData, jqForm, option) { // 表单提交之前的回调函数，一般用户表单验证
                return true; // 只要不返回false,表单都会提交
            },
            uploadProgress: function (event, position, total, percentComplete) {
                // if(percentComplete == 100){

                // }
                // var percentVal = percentComplete + '%';
                // $(".progress-bar-data").width((percentComplete) + '%');
                // $(".progress-bar-data").html(percentVal);
                // $(".Progress_value").html((percentComplete) + '%');
            },
            success: function (responseText, statusText, xhr, $form) { // 成功后的回调函数(返回数据由responseText获得),
                if (responseText.code == 0) {
                    // 停止定时
                    window.clearInterval(window.import_dingshi);
                    $(".progress-bar-data").width(100.00 + '%');
                    $(".Progress_value").html('100.00' + '%');
                    if ($('.Progress_value').html() == '100.00%') {
                        //延迟1秒在执行 加强体验度
                        setTimeout(function () {
                            $('.import').addClass('hidden');
                            $('.finish').removeClass('hidden');
                            var tmp = responseText.msg.split(',');
                            temp = '';
                            $.each(tmp, function (i, value) {
                                temp += '<p>' + value + '</p>';
                            });

                            $('#effect-tips-content').html(temp);
                        }, 1000)
                    }
                    $('#upload_ok').click(function () {
                        //文件导入成功 则下面电话处 应该 显示正在排队的信息
                        getsearch3();
                        //文件导入成功 刷新右侧任务栏 相应的任务  不刷新全部  get_data_info也会刷新左侧任务栏内容
                        var task_id = $("#nowTaskID").val();
                        get_data_info(task_id);
                        //然后修改 id= n_liststate 的状态  它默认是完成  让变成排队  排队在第二个  所以eq(1)
                        $("#n_liststate option:eq(1)").prop("selected", 'selected');
                        //refurbish();
                    })
                } else {
                    $('.import').addClass('hidden');
                    $('.finish').removeClass('hidden');
                    $('#effect-tips-content').html(responseText.msg);
                }
            },
            error: function (xhr, status, err) {
                // 停止定时
                window.clearInterval(window.import_dingshi);
                $('.import').addClass('hidden');
                $('.finish').removeClass('hidden');
                $('#effect-tips-content').html('导入失败');
            },
            clearForm: true, // 成功提交后，清除表单填写内容
            resetForm: true // 成功提交后，重置表单填写内容
        };
        // 2.绑定ajaxSubmit()
        $("#fileform").submit(function () { // 提交表单的id
            $(this).ajaxSubmit(options);
            window.import_dingshi = window.setInterval(effectTmp, 1000);
            return false; //防止表单自动提交
        });
        var obj = ('.c_taskleftdata .c_tasklshow:nth-of-type(1)');
        var task_id = $(obj).attr('data-id');
        $("#nowTaskID").val(task_id);
    })

    //点击全部选中 并且得到选中几条数据 反馈给前端
    function checkboxAll(obj) {
        if ($(obj).is(":checked")) {
            $("input[name='uids[]']").prop("checked", true);
        } else {
            $("input[name='uids[]']").prop("checked", false);
        }
        var arr = [];
        $("input[name='uids[]']:checked").each(function (index, item) {
            arr[index] = $(this).val();
        });
        var count = arr.length;
        $("#ckeckboxCount").text('选中了' + count + '条数据');
    }

    //计算选中几条数据 并且反馈给前端
    function checkboxCount() {
        var arr = [];
        $("input[name='uids[]']:checked").each(function (index, item) {
            arr[index] = $(this).val();
        });
        var count = arr.length;
        $("#ckeckboxCount").text('选中了' + count + '条数据');
    }

    //任务列表 点击某任务 显示任务详情
    function click_data_info(obj) {
        var id = $(obj).attr('data-id');
        var typeid = $(obj).attr('data-typeid');
        window.task_object = obj;
        if(typeid == 0) {
            return false;
        }
        get_data_info(id);
        // $(obj).find('i').addClass('task-active').siblings().find('i').removeClass('task-active');
        return false;
        show_task_byTaskId(id);
        var url = '{:url("index/get_task_data_api")}';
        $.ajax({
            type: 'POST',
            dataType: "json",
            data: {
                task_id: id,
            },
            url: url,
            success: function (result) {
                console.log(result);
                console.log(999999);
                if (result.code === 0) {
                    //修改当前任务id  便于操作
                    $("#nowTaskID").val(id);
                    $("#taskexampletaskID").val(id);
                    var object = result.data;
                    $('#see_details').attr('href', result.data.url);
                    $("#task_name").html(object.task_name);
                    $("#task_status").html(object.task_status);
                    // $("#edit-opt").html('12');
                    $("#scenarios_name").html(object.scenarios_name);
                    $("#call_type").html(object.line_name);
                    $("#robot_cnt").html(object.robot_cnt + "个");

                    //是否打断
                    $("#scenarios_break").html(object.scenarios_break);
                    //是否转接 因为暂时没有 所以先用别的代替
                    //$("#n_tasktransfer").html(object.scenarios_break);
                    //是否发送短信
                    $("#sms_show_status").html(object.send_sms_status);
                    //是否加入CRM
                    $('#add_crm_status').text(object.is_add_crm);
                    //是否公众号推送
                    $('#wx_push_show_status').text(object.wx_push_status);

                    //备注
                    $("#beizhu").html(object.remarks);
                    //电话接通率
                    $("#jietonglv").html(object.connect_rate + "%");
                    $("#is_ASR").html(object.asr_name);
                    $("#is_timing").html(object.is_auto_txt);
                    //下面的 意向率(A+B)：(0%)
                    $("#AaddB").html("意向率A+B：(" + object.level_a_b_rate + "%)");
                    //下面的平均时长 0s
                    $("#averageTime").html("平均通话时长：" + object.average_duration + "s");
                    //平均说话次数   平均说话次数：0%
                    $("#talk_count").html(" 平均说话次数：" + object.average_speak + "次");


                    $("#create_time").html(object.create_time);
                    $("#last_dial_time_a").html(object.last_dial_time);
                    //重复呼叫次数
                    $('#show_again_call_count').html(object.again_call_count);
                    $("#grade_a > span").html(object.level_a_name);
                    $("#grade_b > span").html(object.level_b_name);
                    $("#grade_c > span").html(object.level_c_name);
                    $("#grade_d > span").html(object.level_d_name);
                    $("#grade_e > span").html(object.level_e_name);
                    $("#grade_f > span").html(object.level_f_name);



                    //判断状态 来选择是否显示上面按钮 开始任务等
                    if (object.status == 1) {
                        $("#aidieru").attr("onclick", "popTipswin(this);");
                        $("#aidieru").attr("data-title", "暂停任务");
                        $("#aidieru").find("span").text("暂停任务");
                        $("#aidieru").show();
                        $("#edit-opt").show();
                        $("#end-opt").show();
                        $('.synthesis-success').addClass('hide');

                    } else if (object.status == 3) {
                        $("#aidieru").hide();
                        $("#edit-opt").hide();
                        $("#end-opt").hide();
                        $('.synthesis-success').addClass('hide');
                    } else {
                        $("#aidieru").attr("onclick", "popTipswin(this);");
                        $("#aidieru").attr("data-title", "开始任务");
                        $("#aidieru").find("span").text("开始任务");
                        $("#aidieru").show();
                        $("#edit-opt").show();
                        $("#end-opt").show();
                        $('.synthesis-success').addClass('hide');
                    }
                   //is_redis=1 代表录音正在合成中
                    if(result.data.is_redis==1){
                      $('.synthesis-success').addClass('hide'); //synthesis-success是合成成功的提示 应该隐藏
                      $("#luyinshengcheng").show();
                      $("#luyinshengcheng span").text('合成中...');
                      $("#luyinshengcheng").attr('disabled',true);
                      $("#aidieru").hide();  //客气任务隐藏
                      $(".variable").removeClass('hide');  //合成时间显示出来
                      $("#hechengjindu").text(result.data.is_change_num+'/'+result.data.all_num);
                      $("#yuji_time").text(result.data.yuji_time);
                    }else{
                      if(result.data.is_change ==1 ){
                          //is_change =1 代表录音生成完毕 但是 总部号码  和生成号码不一致 也就是 有人又导入新的号码了！！！
                          $('.synthesis-success').addClass('hide');
                          $("#luyinshengcheng").show();
                          $("#luyinshengcheng span").text('生成录音');
                          $("#luyinshengcheng").attr('disabled',false);
                          $("#aidieru").hide();
                          $(".variable").addClass('hide');
                          $("#hechengjindu").text(result.data.is_change_num+'/'+result.data.all_num);
                          $("#yuji_time").text(result.data.yuji_time);
                    }else if(result.data.is_change ==0){
                      //如果is_change=0 代表此任务 号码 都合成完毕了
                       if(result.data.all_num_phone!=0 && result.data.all_num!=0){
                          //这里代表 变量任务合成完毕了
                          $("#aidieru").show();
                          $("#luyinshengcheng").hide();
                          $('.synthesis-success').removeClass('hide');
                          $('.variable').addClass('hide');
                          if (object.status == 3){
                             $("#aidieru").hide();
                             $("#luyinshengcheng").hide();
                             $('.variable').addClass('hide');
                             $('.synthesis-success').addClass('hide');
                          }
                          if(object.status == 1){
                            $('.synthesis-success').addClass('hide');
                          }
                          if(object.status == 2){
                            $('.synthesis-success').addClass('hide');
                          }
                          if(object.status == 7){
                            $('.synthesis-success').addClass('hide');
                          }
                       }else{
                         $('.synthesis-success').addClass('hide');
                         //这里代表普通任务
                         if (object.status == 3){
                            $("#aidieru").hide();
                            $("#luyinshengcheng").hide();
                            $('.variable').addClass('hide');
                         }else{
                           $("#aidieru").show();
                           $("#luyinshengcheng").hide();
                           $('.variable').addClass('hide');
                         }
                       }
                    }
                  }
                    //获取用户意向百分比
                    /*
                 level_a: a的概率
									level_a_b_rate: a+b的概率
									level_b: b的概率
									level_c: c的概率
									level_d: d的概率
									level_e: e的概率
									level_f: f的概率
                 connect_count   //接通数量
                 not_connect_count //拒接数量
                 wait_count    //等待数量
                  count        //总数量
            */
                    $("#typeA").css('width', result.data.level_a + '%');
                    $("#typeApc").text(result.data.level_a + '%');
                    $("#typeB").css('width', result.data.level_b + '%');
                    $("#typeBpc").text(result.data.level_b + '%');
                    $("#typeC").css('width', result.data.level_c + '%');
                    $("#typeCpc").text(result.data.level_c + '%');
                    $("#typeD").css('width', result.data.level_d + '%');
                    $("#typeDpc").text(result.data.level_d + '%');
                    $("#typeE").css('width', result.data.level_e + '%');
                    $("#typeEpc").text(result.data.level_e + '%');
                    $("#typeF").css('width', result.data.level_f + '%');
                    $("#typeFpc").text(result.data.level_f + '%');
                    //获取通话时长百分比
                    /*
					    duration_1 小于10秒
					    duration_2 10-60秒
					    duration_3 60-120秒
					    duration_4  大于120秒
					    average_duration  平均时长
					*/
                    $("#longA").css('width', result.data.duration_1 + '%');
                    $("#longApc").text(result.data.duration_1 + '%');
                    $("#longB").css('width', result.data.duration_2 + '%');
                    $("#longBpc").text(result.data.duration_2 + '%');
                    $("#longC").css('width', result.data.duration_3 + '%');
                    $("#longCpc").text(result.data.duration_3 + '%');
                    $("#longD").css('width', result.data.duration_4 + '%');
                    $("#longDpc").text(result.data.duration_4 + '%');
                    //通话轮次
                    /*
					   call_times_1  0-3
					   call_times_2  3-5次
					   call_times_3  5-7次
					   call_times_4  7-10次
					   call_times_5 10次以上
					*/
                    $("#rotationA").css('width', result.data.speak_count_1 + '%');
                    $("#rotationApc").text(result.data.speak_count_1 + '%');
                    $("#rotationB").css('width', result.data.speak_count_2 + '%');
                    $("#rotationBpc").text(result.data.speak_count_2 + '%');
                    $("#rotationC").css('width', result.data.speak_count_3 + '%');
                    $("#rotationCpc").text(result.data.speak_count_3 + '%');
                    $("#rotationD").css('width', result.data.speak_count_4 + '%');
                    $("#rotationDpc").text(result.data.speak_count_4 + '%');
                    $("#rotationE").css('width', result.data.speak_count_5 + '%');
                    $("#rotationEpc").text(result.data.speak_count_5 + '%');
                    // getsearch1(1,id);
                    resetting();
                }
            },
            error: function () {
                console.log('获取任务列表失败');
            }
        });

    }

    //使用task_id 刷新左侧任务状态
    function show_task_byTaskId(task_id) {
        var url = '{:url("index/get_task_list_api_one")}';
        $.ajax({
            type: 'POST',
            dataType: "json",
            data: {
                task_id: task_id,
            },
            url: url,
            success: function (result) {
                //is_redis=1 代表录音正在合成中
                    if(result.data.is_redis==1){
                      $('.synthesis-success').addClass('hide'); //synthesis-success是合成成功的提示 应该隐藏
                      $("#luyinshengcheng").show();
                      $("#luyinshengcheng span").text('合成中...');
                      $("#luyinshengcheng").attr('disabled',true);
                      $("#aidieru").hide();  //客气任务隐藏
                      $(".variable").removeClass('hide');  //合成时间显示出来
                      $("#hechengjindu").text(result.data.is_change_num+'/'+result.data.all_num);
                      $("#yuji_time").text(result.data.yuji_time);
                    }else{
                      if(result.data.is_change ==1 ){
                          //is_change =1 代表录音生成完毕 但是 总部号码  和生成号码不一致 也就是 有人又导入新的号码了！！！
                          $('.synthesis-success').addClass('hide');
                          $("#luyinshengcheng").show();
                          $("#luyinshengcheng span").text('生成录音');
                          $("#luyinshengcheng").attr('disabled',false);
                          $("#aidieru").hide();
                          $(".variable").addClass('hide');
                          $("#hechengjindu").text(result.data.is_change_num+'/'+result.data.all_num);
                          $("#yuji_time").text(result.data.yuji_time);
                    }else if(result.data.is_change ==0){
                      //如果is_change=0 代表此任务 号码 都合成完毕了
                       if(result.data.all_num_phone!=0 && result.data.all_num!=0){
                          //这里代表 变量任务合成完毕了
                          $("#aidieru").show();
                          $("#luyinshengcheng").hide();
                          $('.synthesis-success').removeClass('hide');
                          $('.variable').addClass('hide');
                          if (result.data.status == 3){
                             $("#aidieru").hide();
                             $("#luyinshengcheng").hide();
                             $('.variable').addClass('hide');
                             $('.synthesis-success').addClass('hide');
                          }
                          if(result.data.status == 1){
                            $('.synthesis-success').addClass('hide');
                          }
                          if(result.data.status == 2){
                            $('.synthesis-success').addClass('hide');
                          }
                          if(result.data.status == 7){
                            $('.synthesis-success').addClass('hide');
                          }
                       }else{
                         $('.synthesis-success').addClass('hide');
                         //这里代表普通任务
                         if (result.data.status == 3){
                            $("#aidieru").hide();
                            $("#luyinshengcheng").hide();
                            $('.variable').addClass('hide');
                         }else{
                           $("#aidieru").show();
                           $("#luyinshengcheng").hide();
                           $('.variable').addClass('hide');
                         }
                       }
                    }
                  }
                console.log(result.data.is_redis);
                console.log(77777777);
                if (result.code === 0) {
                    var object = result.data; //result.data一维数组
                    var htmls = '';
                    if (result.data.length == 0) {
                        var zanwushuju = '<div class="pz_zanwushuju"><p>暂无任务数据</p></div>';
                        $('.c_taskleftdata.pz_innerbox').html(zanwushuju);
                    } else {
                        $(".c_tasklshow").each(function (index, item) {
                            var taskId = $(this).attr("data-id");
                            if (taskId == task_id) {
                                var htmls = '<div class="task_user clearfix"><p class="pull-left">' + object.task_name + '</p></div>';
                                htmls += '<div class="task_progress clearfix">';
                                htmls += '<div class="progress">';
                                htmls +=
                                    '<div class="progress-bar  progress-bar-success" aria-valuenow="40" aria-valuemax="100" aria-valuemin="0" style="width:' +
                                    object.percent_complete + '%"></div>';
                                htmls += '</div><span class="task_left_schedule_two">进度' + object.Molecular + '/' + object.denominator +
                                    '</span></div><div class="task_type">';

                                htmls += '<p>任务状态：<span class="tag-text">' + object.status_name + '</span></p>';

                                htmls += '<p>创建时间：<span>' + object.create_datetime + '</span></p></div><i></i>';

                                if (object.arrears_user == 'ASR_ADMIN' && object.status == 4) {
                                    $(this).attr('title', '当前ASR已经欠费，影响到您这次的任务执行，请尽快充值。');
                                } else if (object.status_name.toString().indexOf('欠费') != -1) {
                                    $(this).attr('title', '账户名为：(' + object.arrears_user + ')已经欠费，影响到您这次的任务执行，请尽快充值。');
                                } else if (object.status_name.toString().indexOf('异常') != -1) {
                                    $(this).attr('title', ' 线路故障判断，进行异常暂停处理。');
                                } else {
                                    $(this).attr('title', object.tips_info);
                                }
                                $(this).html(htmls);
                                $(window.task_object).find('i').addClass('task-active');
                                $(window.task_object).siblings().find('i').removeClass('task-active');
                                $(window.task_object).addClass('active');
                                $(window.task_object).siblings().removeClass('active');
                            }
                        });
                        $('.tag-text').each(function () {
                            switch ($(this).text()) {
                                case '进行中':
                                    $(this).addClass('n_tasking');
                                    break;
                                case '暂停':
                                    $(this).addClass('n_tag_pause');
                                    break;
                                default:
                            }
                            var text = $(this).text();
                            var n = text.search(/重呼第[1-4]次/i);
                            if (n >= 0) {
                                $(this).addClass('n_tasking');
                            }
                        });
                    }
                    //设置pid
                    //$(this).attr('data-typeid',1);
                }else{
                    //防止再次点击
                    $('.c_tasklshow').each(function(){
                        if($(this).attr('data-id') == task_id){
                            $(this).attr('data-typeid',0);
                        }
                    })

                }
            },
            error: function () {
                console.log('获取任务列表失败');
            }
        });
    }
    //给任务生成录音
    function create_luyin(){
       //点击生成录音 生成录音按钮变成 合成中... 然后样式变暗
       $("#luyinshengcheng span").text('合成中...');
       $("#luyinshengcheng").attr('disabled',true);
       var task_id = $("#nowTaskID").val();
       var url = '{:url("scenarios/create_luyin")}';
        $.ajax({
            type: 'POST',
            dataType: "json",
            data: {
                task_id: task_id,
            },
            url: url,
            success: function (result) {
                show_task_byTaskId(task_id)
            },
            error: function () {
                console.log('录音生成失败');
            }
        });
    }
    //使用task_id得到右侧的任务详情
    var firstLoad = 0;

    function get_data_info(task_id) {
        show_task_byTaskId(task_id);
        var url = '{:url("index/get_task_data_api")}';
        $("#nestedloading").removeClass(" fadeInRight animated");
        $.ajax({
            type: 'POST',
            dataType: "json",
            data: {
                task_id: task_id,
            },
            url: url,
            success: function (result) {
                console.log(result);
                if (firstLoad >= 3) {
                    $("#nestedloading").removeClass(" fadeInRight animated");
                }
                console.log(result);
                if (result.code === 0) {
                    //修改当前任务id  便于操作
                    $("#nowTaskID").val(task_id);
                    $("#taskexampletaskID").val(task_id);
                    var object = result.data;
                    $("#task_name").html(object.task_name);
                    $('#task_name').attr('title',object.task_name);
                    $("#task_status").html(object.task_status);
                    $("#scenarios_name").html(object.scenarios_name);
                    $("#call_type").html("<span title='"+ object.line_name_ +"'>"+object.line_name+"</span>");
                    $("#robot_cnt").html(object.robot_cnt + "个");

                    //是否打断
                    $("#scenarios_break").html(object.scenarios_break);
                    //是否转接 因为暂时没有 所以先用别的代替
                    // $("#n_tasktransfer").html(object.scenarios_break);
                    //是否微信推送
                    $('#wx_push_show_status').html(object.wx_push_status);
                    //CRM推送状态
                    $('#add_crm_status').html(object.is_add_crm);
                    //是否短信推
                    $('#sms_show_status').html(object.send_sms_status);
                    //跳转链接
                    $('#see_details').attr('href', object.url);
                    //备注
                    $("#beizhu").html(object.remarks);
                    //电话接通率
                    $("#jietonglv").html(object.connect_rate + "%");
                    $("#is_ASR").html(object.asr_name);
                    $("#is_timing").html(object.is_auto_txt);
                    //下面的 意向率(A+B)：(0%)
                    $("#AaddB").html("意向率A+B：(" + object.level_a_b_rate + "%)");
                    //下面的平均时长 0s
                    $("#averageTime").html("平均通话时长：" + object.average_duration + "s");
                    //平均说话次数   平均说话次数：0%
                    $("#talk_count").html(" 平均说话次数：" + object.average_speak + "次");

                    $("#create_time").html(object.create_time);
                    $("#last_dial_time_a").html(object.last_dial_time);
                    //重复呼叫次数
                    $('#show_again_call_count').html(object.again_call_count);

                    //判断状态 来选择是否显示上面按钮 开始任务等
                    if (object.status == 1) {
                        $("#aidieru").attr("onclick", "popTipswin(this);");
                        $("#aidieru").attr("data-title", "暂停任务");
                        $("#aidieru").find("span").text("暂停任务");
                        $("#aidieru").show();
                        $("#dropdownMenu1").show();
                        $("#daochuPhone").show();
                        $("#daoruPhone").show();
                        $("#edit-opt").show();
                        $("#del-opt").show();
                        $("#end-opt").show();
                        $('.synthesis-success').addClass('hide');

                    } else if (object.status == 3) {
                        $("#aidieru").hide();
                        $("#edit-opt").hide();
                        $("#end-opt").hide();
                        $("#dropdownMenu1").hide();
                        $('.synthesis-success').addClass('hide');
                    } else if (object.status == 7) {
                        $("#aidieru").hide();
                        $("#dropdownMenu1").hide();
                        $("#daochuPhone").show();
                        $("#daoruPhone").show();
                        $("#edit-opt").hide();
                        $("#del-opt").hide();
                        $("#end-opt").hide();
                        $('.synthesis-success').addClass('hide');
                    } else {
                        $("#aidieru").attr("onclick", "popTipswin(this);");
                        $("#aidieru").attr("data-title", "开始任务");
                        $("#aidieru").find("span").text("开始任务");
                        $("#aidieru").show();
                        $("#dropdownMenu1").show();
                        $("#daochuPhone").show();
                        $("#daoruPhone").show();
                        $("#edit-opt").show();
                        $("#del-opt").show();
                        $("#end-opt").show();
                        $('.synthesis-success').addClass('hide');
                    }
                    //is_redis=1 代表录音正在合成中
                    if(result.data.is_redis==1){
                      $('.synthesis-success').addClass('hide'); //synthesis-success是合成成功的提示 应该隐藏
                      $("#luyinshengcheng").show();
                      $("#luyinshengcheng span").text('合成中...');
                      $("#luyinshengcheng").attr('disabled',true);
                      $("#aidieru").hide();  //客气任务隐藏
                      $(".variable").removeClass('hide');  //合成时间显示出来
                      $("#hechengjindu").text(result.data.is_change_num+'/'+result.data.all_num);
                      $("#yuji_time").text(result.data.yuji_time);
                    }else{
                      if(result.data.is_change ==1 ){
                          //is_change =1 代表录音生成完毕 但是 总部号码  和生成号码不一致 也就是 有人又导入新的号码了！！！
                          $('.synthesis-success').addClass('hide');
                          $("#luyinshengcheng").show();
                          $("#luyinshengcheng span").text('生成录音');
                          $("#luyinshengcheng").attr('disabled',false);
                          $("#aidieru").hide();
                          $(".variable").addClass('hide');
                          $("#hechengjindu").text(result.data.is_change_num+'/'+result.data.all_num);
                          $("#yuji_time").text(result.data.yuji_time);
                    }else if(result.data.is_change ==0){
                      //如果is_change=0 代表此任务 号码 都合成完毕了
                       if(result.data.all_num_phone!=0&& result.data.all_num!=0){
                          //这里代表 变量任务合成完毕了
                          $("#aidieru").show();
                          $("#luyinshengcheng").hide();
                          $('.synthesis-success').removeClass('hide');
                          $('.variable').addClass('hide');
                          if (object.status == 3){
                             $("#aidieru").hide();
                             $("#luyinshengcheng").hide();
                             $('.variable').addClass('hide');
                             $('.synthesis-success').addClass('hide');
                          }
                          if (object.status == 1){
                             $('.synthesis-success').addClass('hide');
                          }
                          if (object.status == 2){
                             $('.synthesis-success').addClass('hide');
                          }
                          if (object.status == 7){
                             $('.synthesis-success').addClass('hide');
                          }
                       }else{
                         $('.synthesis-success').addClass('hide');
                         //这里代表普通任务
                         if (object.status == 3){
                            $("#aidieru").hide();
                            $("#luyinshengcheng").hide();
                            $('.variable').addClass('hide');
                         }else{
                           $("#aidieru").show();
                           $("#luyinshengcheng").hide();
                           $('.variable').addClass('hide');
                         }
                       }
                    }
                  }
                    //获取用户意向百分比
                    /*
                 level_a: a的概率
									level_a_b_rate: a+b的概率
									level_b: b的概率
									level_c: c的概率
									level_d: d的概率
									level_e: e的概率
									level_f: f的概率
                 connect_count   //接通数量
                 not_connect_count //拒接数量
                 wait_count    //等待数量
                  count        //总数量
            */
                    $("#typeA").css('width', result.data.level_a + '%');
                    $("#typeApc").text(result.data.level_a + '%');
                    $("#typeB").css('width', result.data.level_b + '%');
                    $("#typeBpc").text(result.data.level_b + '%');
                    $("#typeC").css('width', result.data.level_c + '%');
                    $("#typeCpc").text(result.data.level_c + '%');
                    $("#typeD").css('width', result.data.level_d + '%');
                    $("#typeDpc").text(result.data.level_d + '%');
                    $("#typeE").css('width', result.data.level_e + '%');
                    $("#typeEpc").text(result.data.level_e + '%');
                    $("#typeF").css('width', result.data.level_f + '%');
                    $("#typeFpc").text(result.data.level_f + '%');
                    //获取通话时长百分比
                    /*
					    duration_1 小于10秒
					    duration_2 10-60秒
					    duration_3 60-120秒
					    duration_4  大于120秒
					    average_duration  平均时长
					*/
                    $("#longA").css('width', result.data.duration_1 + '%');
                    $("#longApc").text(result.data.duration_1 + '%');
                    $("#longB").css('width', result.data.duration_2 + '%');
                    $("#longBpc").text(result.data.duration_2 + '%');
                    $("#longC").css('width', result.data.duration_3 + '%');
                    $("#longCpc").text(result.data.duration_3 + '%');
                    $("#longD").css('width', result.data.duration_4 + '%');
                    $("#longDpc").text(result.data.duration_4 + '%');
                    //通话轮次
                    /*
					   call_times_1  0-3
					   call_times_2  3-5次
					   call_times_3  5-7次
					   call_times_4  7-10次
					   call_times_5 10次以上
					*/
                    $("#rotationA").css('width', result.data.speak_count_1 + '%');
                    $("#rotationApc").text(result.data.speak_count_1 + '%');
                    $("#rotationB").css('width', result.data.speak_count_2 + '%');
                    $("#rotationBpc").text(result.data.speak_count_2 + '%');
                    $("#rotationC").css('width', result.data.speak_count_3 + '%');
                    $("#rotationCpc").text(result.data.speak_count_3 + '%');
                    $("#rotationD").css('width', result.data.speak_count_4 + '%');
                    $("#rotationDpc").text(result.data.speak_count_4 + '%');
                    $("#rotationE").css('width', result.data.speak_count_5 + '%');
                    $("#rotationEpc").text(result.data.speak_count_5 + '%');

                    $("#grade_a > span").html(object.level_a_name);
                    $("#grade_b > span").html(object.level_b_name);
                    $("#grade_c > span").html(object.level_c_name);
                    $("#grade_d > span").html(object.level_d_name);
                    $("#grade_e > span").html(object.level_e_name);
                    $("#grade_f > span").html(object.level_f_name);
                    // getsearch1(1,task_id);
                    resetting();
                    is_timingshow();
                }
                if (firstLoad >= 3) {
                    $("#nestedloading").addClass(" fadeInRight animated");
                }
                firstLoad++;
                is_timingshow();
            },
            error: function () {
                console.log('获取任务列表失败');
            }
        });
    }

    //使用task_id得到右侧的任务详情  下面没有-----getsearch1(1,task_id); 和resetting(); 用于导入号码刷新
    // function get_data_info1(task_id){
    //   show_task_byTaskId(task_id);
    //   var url = '{:url("index/get_task_data_api")}';
    // 	$.ajax({
    // 		type:'POST',
    // 		dataType:"json",
    // 		data:{
    // 			task_id:task_id,
    // 		},
    // 		url:url,
    //   	success:function(result){
    // 			if(result.code === 0){
    //           //修改当前任务id  便于操作
    // 			 	$("#nowTaskID").val(task_id);
    // 			 	$("#taskexampletaskID").val(task_id);
    // 				var object = result.data;
    // 				$("#task_name").html(object.task_name);
    // 				$("#task_status").html(object.task_status);
    // 				$("#scenarios_name").html(object.scenarios_name);
    // 				$("#call_type").html(object.line_name);
    // 				$("#robot_cnt").html(object.robot_cnt+"个");

    // 				//是否打断
    // 				$("#scenarios_break").html(object.scenarios_break);
    // 				//是否转接 因为暂时没有 所以先用别的代替
    // 				//$("#n_tasktransfer").html(object.scenarios_break);
    // 				//是否发送短信
    // 				$("#sms_show_status").html(object.send_sms_status);
    // 				//微信公众号推送
    // 				$('#wx_push_show_status').html(object.wx_push_status);
    // 				//是否加入CRM
    //           $('#add_crm_status').text(object.is_add_crm);

    //           //备注
    //           $("#beizhu").html(object.remarks);
    //           //电话接通率
    //           $("#jietonglv").html(object.connect_rate+"%");

    //           //下面的 意向率(A+B)：(0%)
    //           $("#AaddB").html("意向率A+B：("+object.level_a_b_rate+"%)");
    //           //下面的平均时长 0s
    //           $("#averageTime").html("平均通话时长："+object.average_duration+"s");
    //           //平均说话次数   平均说话次数：0%
    //           $("#talk_count").html(" 平均说话次数："+object.average_speak+"次");

    // 				$("#create_time").html(object.create_time);
    // 				$("#last_dial_time_a").html(object.last_dial_time);


    //           //判断状态 来选择是否显示上面按钮 开始任务等
    //           if(object.status == 1){
    // 							$("#aidieru").attr("onclick","popTipswin(this);");
    // 							$("#aidieru").attr("data-title","暂停任务");
    // 							$("#aidieru").find("span").text("暂停任务");
    // 							$("#aidieru").show();

    // 							$("#edit-opt").show();
    // 							$("#end-opt").show();


    // 						}
    // 						else if(object.status == 3){
    // 							$("#aidieru").hide();
    // 							$("#edit-opt").hide();
    // 							$("#end-opt").hide();

    // 						}
    // 						else{
    // 							$("#aidieru").attr("onclick","popTipswin(this);");
    // 							$("#aidieru").attr("data-title","开始任务");
    // 							$("#aidieru").find("span").text("开始任务");
    // 							$("#aidieru").show();

    // 							$("#edit-opt").show();
    // 							$("#end-opt").show();

    // 						}
    //           //获取用户意向百分比
    //           /*
    //               level_a: a的概率
    // 							level_a_b_rate: a+b的概率
    // 							level_b: b的概率
    // 							level_c: c的概率
    // 							level_d: d的概率
    // 							level_e: e的概率
    // 							level_f: f的概率
    //               connect_count   //接通数量
    //               not_connect_count //拒接数量
    //               wait_count    //等待数量
    //                 count        //总数量
    //           */
    // 			  	$("#typeA").css('width',result.data.level_a+'%');
    // 					$("#typeApc").text(result.data.level_a+'%');
    // 					$("#typeB").css('width',result.data.level_b+'%');
    // 					$("#typeBpc").text(result.data.level_b+'%');
    // 					$("#typeC").css('width',result.data.level_c+'%');
    // 					$("#typeCpc").text(result.data.level_c+'%');
    // 					$("#typeD").css('width',result.data.level_d+'%');
    // 					$("#typeDpc").text(result.data.level_d+'%');
    // 					$("#typeE").css('width',result.data.level_e+'%');
    // 					$("#typeEpc").text(result.data.level_e+'%');
    // 					$("#typeF").css('width',result.data.level_f+'%');
    // 					$("#typeFpc").text(result.data.level_f+'%');
    // 		    //获取通话时长百分比
    // 		    /*
    // 		        duration_1 小于10秒
    // 		        duration_2 10-60秒
    // 		        duration_3 60-120秒
    // 		        duration_4  大于120秒
    // 		        average_duration  平均时长
    // 		    */
    // 		    	$("#longA").css('width',result.data.duration_1+'%');
    // 					$("#longApc").text(result.data.duration_1+'%');
    // 					$("#longB").css('width',result.data.duration_2+'%');
    // 					$("#longBpc").text(result.data.duration_2+'%');
    // 					$("#longC").css('width',result.data.duration_3+'%');
    // 					$("#longCpc").text(result.data.duration_3+'%');
    // 					$("#longD").css('width',result.data.duration_4+'%');
    // 					$("#longDpc").text(result.data.duration_4+'%');
    // 		    //通话轮次
    // 		    /*
    // 		       call_times_1  0-3
    // 		       call_times_2  3-5次
    // 		       call_times_3  5-7次
    // 		       call_times_4  7-10次
    // 		       call_times_5 10次以上
    // 		    */
    // 		   // 	$("#rotationA").css('width',result.data.call_times_1+'%');
    // 					// $("#rotationApc").text(result.data.call_times_1+'%');
    // 					// $("#rotationB").css('width',result.data.call_times_2+'%');
    // 					// $("#rotationBpc").text(result.data.call_times_2+'%');
    // 					// $("#rotationC").css('width',result.data.call_times_3+'%');
    // 					// $("#rotationCpc").text(result.data.call_times_3+'%');
    // 					// $("#rotationD").css('width',result.data.call_times_4+'%');
    // 					// $("#rotationDpc").text(result.data.call_times_4+'%');
    // 					// $("#rotationE").css('width',result.data.call_times_5+'%');
    // 					// $("#rotationEpc").text(result.data.call_times_5+'%');
    // 			}
    // 		},
    // 		error:function(){
    // 			console.log('获取任务列表失败');
    // 		}
    // 	});
    // }

    function refurbish() {
        var taskID = $("#nowTaskID").val();
        window.currentPage = 1;
        window.listcunt = 0;
        show_task_list('html');
        // if (taskID) {
        // 	getsearch1(1, taskID);
        // }
        //获取等待列表
        //searchdata(1,taskID);

        //获取已经拨打列表
        //getsearch(1,taskID);

        //获取当前计划的配置
        //getConfig(taskID);

        // 执行任务  获取任务的 客户意向等级 数据详情
        //implement(taskID);

    }

    //获取任务的 客户意向等级 数据详情
    function gettask(obj, id, name) {

        $(obj).addClass("task-item-active");
        $(obj).siblings(".task-item-active").removeClass("task-item-active");

        $("#righttitle").text(name);
        /////////////////////////////
        // 绑定当前任务的ID
        $("#taskID").val(id); //单个新建的
        $("#taskexampletaskID").val(id); //导入用到的
        $("#nowTaskID").val(id);

        ////////////////////////////////////

        searchdata(page, id);

        //获取已经拨打列表
        taskId = id;
        // getsearch(callpage,taskId);

        //获取当前计划的配置
        getConfig(id);

        // 执行任务  获取任务的 客户意向等级 数据详情
        implement(id);

        //通话时长
        getTalktime(id);

        //通话轮次
        getTalkRotation(id)

    }

    //开始任务
    function startTask(status){
      var taskID = $("#nowTaskID").val();
      var url = "{:url('is_task_demand')}";
      $('#tips_model').modal('hide');
      $.ajax({
        url: url,
        dataType: "json",
        type: "post",
        data: {
            'task_id': taskID,
            'status': status
        },
        success: function (data) {
          console.log(data);
          if(data.code == 1){
            $('#fs_verification').modal('show');
            $('#available').html(data.data.available);
            $('#overflow').html(data.data.overflow);
          }else if(data.code == 2){
            alert(data.msg);
          }else if(data.code == 0){
            execute_startTask(status);
          }
        },
        error: function () {
          console.log('失败。');
        }
      });
    }
    function execute_startTask(status) {
        var taskID = $("#nowTaskID").val();
        var url = "{:url('update_status')}";
        $('#tips_model').modal('hide');
        $('#fs_verification').modal('hide');
        $.ajax({
            url: url,
            dataType: "json",
            type: "post",
            data: {
                'task_id': taskID,
                'status': status
            },
            success: function (data) {
                if (data.code) {
                    show_task_list();
                    alert(data.msg);
                } else {
                    if (taskID <= 0 || status == -1) {
                        //删除无需重新加载
                        //location.reload();
                        window.currentPage = 1;
                        window.listcunt = 0;
                        show_task_list();
                    } else {
                        if (status == 1) {
                            $("#aidieru").attr("onclick", "popTipswin(this);");
                            $("#aidieru").attr("data-title", "暂停任务");
                            $("#aidieru").find("span").text("暂停任务");
                            $("#aidieru").show();
                        } else if (status == 2) {
                            $("#aidieru").attr("onclick", "popTipswin(this);");
                            $("#aidieru").attr("data-title", "开始任务");
                            $("#aidieru").find("span").text("开始任务");
                            $("#aidieru").show();
                        }
                        //开始时候 刷新右侧任务栏相应的任务 更新状态
                        get_data_info(taskID);
                    }
                }

            },
            error: function () {
                console.log('失败。');
            }
        });

    }


    show_task_list();
    window.count = 0;
    window.currentPage = 1;
    window.listcunt = 0;

    function show_task_list(state, task_state, task_name) {
        state = state || 'html';
        isLoad = true;
        task_state = $('#n_seltaskstate').val() || 0;
        task_name = $('#taskName').val() || '';
        var url = '{:url("index/get_task_list_api")}';
        window.currentPage = state == 'html' ? 1 : window.currentPage;
        $(".l_loadfixed").show();
        $.ajax({
            type: 'POST',
            dataType: "json",
            data: {
                // date:date,
                task_state: task_state,
                task_name: task_name,
                page: window.page,
                currentPage: window.currentPage
            },
            url: url,
            success: function (result) {
               console.log(result);
               console.log(111111111111111111111111111111);
                $(".l_loadfixed").hide();
                if (result.code === 0) {
                    //result.data为数组 所以要写[0]这样写
                    var htmls = '';
                    if (result.data == []) {
                        var zanwushuju = '<div class="pz_zanwushuju"><p>暂无任务数据</p></div>';
                        $('.c_taskleftdata.pz_innerbox').html(zanwushuju);

                    } else {

                        var pageCount = result.data.pageCount; //分页总数
                        var pageNo = result.data.pageNo; //分页个数

                        $.each(result.data.list, function (index, object) {
                            var html = $('#task_option').html();
                            html = html.replace('{%id%}', object.task_id);
                            html = html.replace('{%name%}', object.task_name);
                            html = html.replace('{%name%}', object.task_name);
                            html = html.replace('{%count%}', object.denominator);
                            html = html.replace('{%complete_count%}', object.Molecular);
                            html = html.replace('{%call_type_name%}', object.call_type_name);
                            html = html.replace('{%create_datetime%}', object.create_datetime);
                            html = html.replace('{%rate%}', object.percent_complete);
                            html = html.replace('{%state_name%}', object.status_name);

                            if (object.arrears_user == 'ASR_ADMIN' && object.status == 4) {

                                html = html.replace('{%title%}', '当前ASR已经欠费，影响到您这次的任务执行，请尽快充值。');
                            } else if (object.status_name.toString().indexOf('欠费') != -1) {

                                html = html.replace('{%title%}', '账户名为：(' + object.arrears_user + ')已经欠费，影响到您这次的任务执行，请尽快充值。');
                            } else if (object.status_name.toString().indexOf('异常') != -1) {

                                html = html.replace('{%title%}', ' 线路故障判断，进行异常暂停处理。');
                            } else {

                                html = html.replace('{%title%}', object.tips_info);
                            }


                            htmls += html;
                            window.listcunt = window.listcunt + 1;
                        });
                        //按照原写法，state=html应该为判断是否是进行查询的依据
                        if (state === 'html') {
                            $('.c_taskleftdata').html(htmls);
                            $('.c_taskleftdata ').scrollTop(0); //等於空 停在原地不動
                        } else {
                            if (htmls != '') {
                                if (window.currentPage == 1) {
                                    $('.c_taskleftdata').html(htmls);
                                } else {
                                    $('.c_taskleftdata').append(htmls);
                                }
                            }
                        }
                        if (window.currentPage < pageCount || window.listcunt < result.count) {
                            isLoad = true;
                        } else if (window.currentPage >= pageCount || window.listcunt == result.count) {
                            isLoad = false;
                        }

                        $('.tag-text').each(function () {
                            switch ($(this).text()) {
                                case '进行中':
                                    $(this).addClass('n_tasking');
                                    break;
                                case '暂停':
                                    $(this).addClass('n_tag_pause');
                                    break;
                                default:
                            }
                        });
                    }
                    $('.c_tasklshow').unbind('click');
                    $('.c_tasklshow').click(function () {
                        if ($(this).hasClass('active') === false) {
                            $('#taskID').val($(this).data('id'));
                            $(this).addClass('active').siblings().removeClass('active');
                        }
                    });
                    $(".c_taskleftdata .c_tasklshow").hover(function () {
                        $(this).addClass('active_pz').siblings().removeClass('active_pz');
                    }, function () {
                        $(".c_taskleftdata .c_tasklshow").removeClass('active_pz');
                    });
                    if (state == 'html') {
                        //if (window.count == 0) {
                        $('.c_taskleftdata > .c_tasklshow').eq(0).trigger('click');
                        //    window.count++;
                        //}
                        //$('.c_tasklshow').eq(0).click();
                        // 显示第一个数据
                        //var obj = ('.c_taskleftdata .c_tasklshow:nth-of-type(1)');
                        //click_data_info(obj);
                    }
                } //end data.code
                window.currentPage++;
            },
            error: function () {
                console.log('获取任务列表失败');
            }
        });
    }

    /*
	判断是否要加载接口
	*/
    function isScrollLoad(obj) {
        var divHeight = $(obj).height();
        var nScrollHeight = $(obj)[0].scrollHeight;
        var nScrollTop = $(obj)[0].scrollTop;
        // console.log(nScrollTop+'+'+divHeight+'>='+nScrollHeight+'=>'+ (nScrollTop+divHeight))
        if (nScrollTop + divHeight + 20 >= nScrollHeight) {
            return true;
        } else {
            return false;
        }
    }

    $(document).ready(function () {
        $('.c_taskleftdata').scroll(function () {
            //是否滚动到底部
            var _needload = isScrollLoad(this);
            //
            if (_needload == true && isLoad == true) {
                show_task_list('append');
            }
        });
    })

    //获取当前计划的配置
    function getConfig(id) {
        var taskID = $("#nowTaskID").val();
        var url = "{:url('taskgetConfig')}";
        $.ajax({
            url: url,
            dataType: "json",
            type: "post",
            data: {
                'taskId': id
            },
            success: function (data) {
                // console.log(data);
                if (data.code) {
                    // console.log(data.msg);
                } else {
                    if (data.data.length < 1) {
                        // console.log("165458");
                    } else {
                        var backdata = data.data.list;
                        $("#scenariostext").text(backdata.scenarios);
                        $("#numbertext").text(backdata.phone);
                        $("#statusstr").text(backdata.statusstr);
                        $("#levelstr").text(data.data.level);
                        $("#itemstr").text(backdata.bridgestr);
                        $('#robotnumber').text(backdata.robot_cnt);
                        $('#linedetails').text(backdata.line_name);
                        $("#taskItem" + id).find(".ant-tag-text").text(backdata.statusstr);
                        $("#taskItem" + id).find(".taskName").text(backdata.task_name);
                        $("#taskItem" + id).find(".tipgr").text("进度" + data.data.Molecular + "/" + data.data.count);
                        $("#taskItem" + id).find(".progress-bar-danger").attr("style", 'width: ' + data.data.percent + '%');
                        $("#taskItem" + id).find(".progress-bar-danger").attr("aria-valuenow", data.data.percent);

                        if (backdata.status == 1) {
                            $("#aidieru").attr("onclick", "popTipswin(this);");
                            $("#aidieru").attr("data-title", "暂停任务");
                            $("#aidieru").find("span").text("暂停任务");
                            $("#aidieru").show();
                            $("#edit-opt").show();
                            $("#end-opt").show();
                        } else if (backdata.status == 3) {
                            $("#aidieru").hide();
                            $("#edit-opt").hide();
                            $("#end-opt").hide();
                        } else {
                            $("#aidieru").attr("onclick", "popTipswin(this);");
                            $("#aidieru").attr("data-title", "开始任务");
                            $("#aidieru").find("span").text("开始任务");
                            $("#aidieru").show();

                            $("#edit-opt").show();
                            $("#end-opt").show();

                        }
                        $("#nestedloading").css("height", "auto");
                        //$("#spinContainer").css("display","block");
                        $("#spinContainerbody").css("display", "block");
                        $("#spinContainerrecords").css("display", "block");
                        //}
                        //console.log(data.data.result);
                    }
                }

            },
            error: function () {
                console.log('获取配置失败。');
            }
        });

    }

    //执行任务获取任务的 客户意向等级 数据详情
    function implement(id) {
        if (!id) {
            return false;
        }
        var url = "{:url('taskDetail')}";
        $.ajax({
            url: url,
            dataType: "json",
            type: "post",
            data: {
                'taskId': id
            },
            success: function (data) {

                $("#typeA").css('width', '0%');
                $("#typeApc").text('0%');
                $("#typeB").css('width', '0%');
                $("#typeBpc").text('0%');
                $("#typeC").css('width', '0%');
                $("#typeCpc").text('0%');
                $("#typeD").css('width', '0%');
                $("#typeDpc").text('0%');
                $("#typeE").css('width', '0%');
                $("#typeEpc").text('0%');
                $("#typeF").css('width', '0%');
                $("#typeFpc").text('0%');

                if (data.code == "1") {
                    // console.log(data.msg);
                } else {
                    var backdata = data.data;
                    //backdata.length
                    for (var i = 0; i < backdata.length; i++) {

                        switch (backdata[i].level) {
                            case 6:
                                $("#typeA").css('width', backdata[i].percent + '%');
                                $("#typeApc").text(backdata[i].percent + '%');
                                break;
                            case 5:
                                $("#typeB").css('width', backdata[i].percent + '%');
                                $("#typeBpc").text(backdata[i].percent + '%');
                                break;
                            case 4:
                                $("#typeC").css('width', backdata[i].percent + '%');
                                $("#typeCpc").text(backdata[i].percent + '%');
                                break;
                            case 3:
                                $("#typeD").css('width', backdata[i].percent + '%');
                                $("#typeDpc").text(backdata[i].percent + '%');
                                break;
                            case 2:
                                $("#typeE").css('width', backdata[i].percent + '%');
                                $("#typeEpc").text(backdata[i].percent + '%');
                                break;
                            default:
                                $("#typeF").css('width', backdata[i].percent + '%');
                                $("#typeFpc").text(backdata[i].percent + '%');
                        }


                    }

                }

            },
            error: function () {
                console.log('获取客户意向等级失败。');
            }
        });

    }

    //通话时长
    function getTalktime(id) {
        if (!id) {
            return false;
        }
        var url = "{:url('talkTime')}";
        $.ajax({
            url: url,
            dataType: "json",
            type: "post",
            data: {
                'taskId': id
            },
            success: function (data) {

                $("#longA").css('width', '0%');
                $("#longApc").text('0%');
                $("#longB").css('width', '0%');
                $("#longBpc").text('0%');
                $("#longC").css('width', '0%');
                $("#longCpc").text('0%');
                $("#longD").css('width', '0%');
                $("#longDpc").text('0%');


                if (data.code == '0') {

                    var backdata = data.data;
                    for (var i = 0; i < backdata.length; i++) {
                        switch (backdata[i].timegroup) {
                            case 0:
                                $("#longA").css('width', backdata[i].percent + '%');
                                $("#longApc").text(backdata[i].percent + '%');
                                break;
                            case 1:
                                $("#longB").css('width', backdata[i].percent + '%');
                                $("#longBpc").text(backdata[i].percent + '%');
                                break;
                            case 2:
                                $("#longC").css('width', backdata[i].percent + '%');
                                $("#longCpc").text(backdata[i].percent + '%');
                                break;
                            default:
                                $("#longD").css('width', backdata[i].percent + '%');
                                $("#longDpc").text(backdata[i].percent + '%');
                        }
                    }

                } else {

                    console.log('获取通话时长数据失败。');

                }


            },
            error: function () {
                //	alert('获取数据失败。');
            }
        });
    }

    //通话轮次
    function getTalkRotation(id) {
        if (!id) {
            return false;
        }
        var url = "{:url('talkRotation')}";
        $.ajax({
            url: url,
            dataType: "json",
            type: "post",
            data: {
                'taskId': id
            },
            success: function (data) {

                $("#rotationA").css('width', '0%');
                $("#rotationApc").text('0%');
                $("#rotationB").css('width', '0%');
                $("#rotationBpc").text('0%');
                $("#rotationC").css('width', '0%');
                $("#rotationCpc").text('0%');
                $("#rotationD").css('width', '0%');
                $("#rotationDpc").text('0%');
                $("#rotationE").css('width', '0%');
                $("#rotationEpc").text('0%');

                if (data.code == '0') {

                    var backdata = data.data;
                    for (var i = 0; i < backdata.length; i++) {
                        switch (backdata[i].rotationgroup) {
                            case 0:
                                $("#rotationA").css('width', backdata[i].percent + '%');
                                $("#rotationApc").text(backdata[i].percent + '%');
                                break;
                            case 1:
                                $("#rotationB").css('width', backdata[i].percent + '%');
                                $("#rotationBpc").text(backdata[i].percent + '%');
                                break;
                            case 2:
                                $("#rotationC").css('width', backdata[i].percent + '%');
                                $("#rotationCpc").text(backdata[i].percent + '%');
                                break;
                            case 3:
                                $("#rotationD").css('width', backdata[i].percent + '%');
                                $("#rotationDpc").text(backdata[i].percent + '%');
                                break;
                            default:
                                $("#rotationE").css('width', backdata[i].percent + '%');
                                $("#rotationEpc").text(backdata[i].percent + '%');
                        }

                    }

                } else {

                    console.log(data.msg);

                }


            },
            error: function () {
                //	alert('获取数据失败。');
            }
        });
    }

    //多选导出
    function outexcelSelect() {
        var taskID = $("#nowTaskID").val();
        var r = confirm('确认要导出么?');
        if (!r) {
            return false;
        }
        var arr = [];
        $("input[name='uids[]']:checked").each(function (index, item) {
            arr.push($(this).val())
        });
        if (!arr || arr.length == 0) {
            alert('请最少选择一项,再导出');
            return false;
        }
        // console.log(arr);
        $.post("{:url('exportExcel')}", {
            'data': arr,
            'taskId': taskID
        }, function (data) {
            if (data.code == 1) {
                alert(data.msg);
            } else {
                // console.log(data);
                window.location.href = data.data;
            }
        });
    }

    function outexcel_degree() {
        $.post("{:url('outexcel_degree')}", {
            'chaos_num': window.chaos_num_oute
        }, function (data) {
            if (data.code == 1) {
                $(".progress-bar-data").width((data.data.percentage) + '%');
                $(".Progress_value").html((data.data.percentage) + '%');
            }
        });
    }

    //导出全部记录
    function outexcel() {
        $('#tips_model').modal('hide');
        $(".progress-bar-data").width(0 + '%');
        $(".Progress_value").html('0.00' + '%');
        $('.finish').addClass('hidden');
        $('.import').removeClass('hidden');
        $('#outexcel_degree').modal('show');
        var taskID = $("#nowTaskID").val();
        //得到 前端是 xlsx 还是txt导出
        var daochu_type = $("input[name='daochu_type']:checked").val();
        window.chaos_num_oute = (new Date()).valueOf();
        window.import_dingshiz = window.setInterval(outexcel_degree, 1000);
        $.post("{:url('exportExcel')}", {
            'taskId': taskID,
            'chaos_num': window.chaos_num_oute,
            'daochu_type': daochu_type
        }, function (data) {
            window.clearInterval(window.import_dingshiz);
            console.log(data);
            if (data.code == 0) {
                $(".progress-bar-data").width(100.00 + '%');
                $(".Progress_value").html('100.00' + '%');
                if ($('.Progress_value').html() == '100.00%') {
                    //延迟1秒在执行 加强体验度
                    setTimeout(function () {
                        $('.import').addClass('hidden');
                        $('.finish').removeClass('hidden');
                        $('#effect-tips-content_outexcel').html('导出成功');
                    },1000);
                    $('#upload_oks').unbind('click');
                    $('#upload_oks').click(function () {
                        window.location.href = data.data;
                    })
                }
            } else {
                $('#upload_oks').unbind('click');
                $('.import').addClass('hidden');
                $('.finish').removeClass('hidden');
                $('#effect-tips-content_outexcel').html('导出失败');
            }
        });
    }

    //导出一个的记录
    function outexcelOne(id) {
        $('#tips_model').modal('hide');
        var taskID = $("#nowTaskID").val();
        $.post("{:url('exportExcel')}", {
            'taskId': taskID,
            'id': id
        }, function (data) {
            // console.log(data);
            if (data.code == '1') {
                alert(data.msg);
            } else {
                window.location.href = data.data;
            }
        });
    }


    function outoutexcelNotCall_degree() {
        $.post("{:url('outexcel_degree')}", {
            'chaos_num': window.chaos_num_outeno
        }, function (data) {
            if (data.code == 1) {
                $(".progress-bar-data").width((data.data.percentage) + '%');
                $(".Progress_value").html((data.data.percentage) + '%');
            }
        });
    }

    //导出未拨打的号码
    function outoutexcelNotCall() {
        $('#tips_model').modal('hide');
        $(".progress-bar-data").width(0 + '%');
        $(".Progress_value").html('0.00' + '%');
        $('.finish').addClass('hidden');
        $('.import').removeClass('hidden');
        $('#outexcel_degree').modal('show');
        var taskID = $("#nowTaskID").val();
        //得到 前端是 xlsx 还是txt导出
        var daochu_type = $("input[name='daochu_type']:checked").val();
        window.chaos_num_outeno = (new Date()).valueOf();
        // window.import_dingshiz = window.setInterval(outoutexcelNotCall_degree, 1000);
        $.post("{:url('exportExcelNotCall')}", {
            'taskId': taskID,
            'chaos_num': window.chaos_num_outeno,
            'daochu_type': daochu_type
        }, function (data) {
            window.clearInterval(window.import_dingshiz);
            console.log(data);
            if (data.code == 0) {
                $(".progress-bar-data").width(100.00 + '%');
                $(".Progress_value").html('100.00' + '%');
                if ($('.Progress_value').html() == '100.00%') {
                    //延迟1秒在执行 加强体验度
                    setTimeout(function () {
                        $('.import').addClass('hidden');
                        $('.finish').removeClass('hidden');
                        $('#effect-tips-content_outexcel').html('导出成功');
                    }, 1000)
                    $('#upload_oks').unbind('click');
                    $('#upload_oks').click(function () {
                        if (data.data != '失败') {
                            window.location.href = data.data;
                        }
                    })
                }
            } else {
                $('#upload_oks').unbind('click');
                $('.import').addClass('hidden');
                $('.finish').removeClass('hidden');
                $('#effect-tips-content_outexcel').html(data.msg);
            }
        });
    }

    //获取等待列表
    var page = 1;

    function searchdata(page, taskId) {
        var url = "{:url('lineup')}";
        $.ajax({
            url: url,
            dataType: "json",
            type: "post",
            data: {
                'page': page,
                'taskId': taskId
            },

            success: function (data) {

                var total = data.data.total;
                var Nowpage = data.data.Nowpage;
                var page = data.data.page;
                var Nowpage = parseInt(Nowpage);

                var data = data.data.list;
                if (data.length > 0) {

                    $("#componentempty").css("display", "none");

                    $("#tablelearninglist").find("tr").remove();

                    for (var i = 0; i < data.length; i++) {


                        var uid = data[i].uid;
                        var mobile = data[i].mobile;
                        var nickname = data[i].nickname;
                        var status = data[i].status;
                        var duration = data[i].duration;
                        var last_dial_time = data[i].last_dial_time;
                        var originating_call = data[i].originating_call;
                        if (originating_call == null) {
                            originating_call = "";
                        }


                        var strstatus = "排队中";
                        var string = '<tr class="itemId' + uid + '" alt="' + uid + '">' +
                            '<td class="text-center">' + nickname + '</td>' +
                            '<td class="text-center">' + mobile + '</td>'
                            // +'<td class="text-center">'+content+'</td>'
                            +
                            '<td class="text-center">' + strstatus + '</td>' +
                            '<td class="text-center">' + duration + '</td>' +
                            '<td class="text-center">' + duration + '</td>' +
                            '<td class="text-center">' + originating_call + '</td>';
                        string += '</tr>';
                        $("#tablelearninglist").append(string);

                    }

                    var prepage = Nowpage - 1;
                    var nextpage = Nowpage + 1;

                    var str = '<div class="row">' +
                        '<div class="col-sm-3 text-left">'

                        +
                        '<table class="table table-bordered table-hover" style="margin-bottom: 0px; ">' +
                        '<tbody><tr>' +
                        '<td class="text-center">全部数据：' +
                        '</td>' +
                        '<td class="text-center">' + total + '&nbsp;' +
                        '</td>'

                        +
                        '</tr> ' +
                        '</tbody></table>'

                        +
                        '</div>' +
                        '<div class="col-sm-9 text-right">' +
                        '<ul class="pagination">';

                    if (Nowpage == 1) {
                        str += '<li id="prevbtn" class="disabled"><span>«</span></li> ';
                    } else {
                        str += '<li><a href="javascript:void(0);" onclick="searchdata(' + prepage + ',' + taskId +
                            ');"><span>«</span></a></li> ';
                    }

                    if (page > 10) {

                        if (Nowpage < 7) {
                            for (var i = 0; i < page; i++) {
                                var nownum = i + 1;
                                if (nownum < 9) {
                                    if (nownum == Nowpage) {
                                        str += '<li class="active"><a href="javascript:void(0);" onclick="searchdata(' + nownum + ',' + taskId +
                                            ');">' + nownum + ' </a></li> ';
                                    } else {
                                        str += '<li><a href="javascript:void(0);" onclick="searchdata(' + nownum + ',' + taskId + ');">' + nownum +
                                            ' </a></li> ';
                                    }
                                }
                                if (nownum == 9 && nownum != Nowpage) {
                                    str += '<li class="disabled"><span>...</span></li>';
                                } else if (nownum == 9) {
                                    str += '<li class="active"><a href="javascript:void(0);" onclick="searchdata(' + nownum + ',' + taskId +
                                        ');">' + nownum + '</a></li> ';
                                }

                                if (nownum > (page - 2)) {
                                    if (nownum == Nowpage) {
                                        str += '<li class="active"><a href="javascript:void(0);" onclick="searchdata(' + nownum + ',' + taskId +
                                            ');">' + nownum + ' </a></li> ';
                                    } else {
                                        str += '<li><a href="javascript:void(0);" onclick="searchdata(' + nownum + ',' + taskId + ');">' + nownum +
                                            ' </a></li> ';
                                    }
                                }

                            }
                        } else if (Nowpage > 6 && Nowpage < (page - 6)) {
                            for (var i = 0; i < page; i++) {
                                var nownum = i + 1;
                                var Nowpage = parseInt(Nowpage);
                                if (nownum < 3) {
                                    str += '<li><a href="javascript:void(0);" onclick="searchdata(' + nownum + ',' + taskId + ');">' + nownum +
                                        ' </a></li> ';
                                }

                                if ((nownum > Nowpage - 5) && (nownum < Nowpage + 5)) {

                                    if (nownum == (Nowpage - 4)) {
                                        str += '<li class="disabled"><span>...</span></li>';
                                    }

                                    if (nownum > (Nowpage - 4) && nownum < Nowpage) {
                                        str += '<li><a href="javascript:void(0);" onclick="searchdata(' + nownum + ',' + taskId + ');">' + nownum +
                                            '</a></li>';
                                    }

                                    if (nownum == Nowpage) {
                                        str += '<li class="active"><a href="javascript:void(0);" onclick="searchdata(' + nownum + ',' + taskId +
                                            ');">' + nownum + '</a></li>';
                                    }

                                    if (nownum < (Nowpage + 4) && nownum > Nowpage) {
                                        str += '<li><a href="javascript:void(0);" onclick="searchdata(' + nownum + ',' + taskId + ');">' + nownum +
                                            '</a></li>';
                                    }

                                    if (nownum == (Nowpage + 4)) {

                                        str += '<li class="disabled"><span>...</span></li>';
                                    }
                                }

                                if (nownum > (page - 2)) {
                                    var Nowpage = parseInt(Nowpage);
                                    if (nownum == Nowpage) {
                                        str += '<li class="active"><a href="javascript:void(0);" onclick="searchdata(' + nownum + ',' + taskId +
                                            ');">' + nownum + '</a></li>';
                                    } else {
                                        str += '<li><a href="javascript:void(0);" onclick="searchdata(' + nownum + ',' + taskId + ');">' + nownum +
                                            '</a></li> ';
                                    }

                                }
                            }
                        } else {

                            for (var i = 0; i < page; i++) {
                                var nownum = i + 1;
                                if (nownum < 3) {
                                    str += '<li><a href="javascript:void(0);" onclick="searchdata(' + nownum + ',' + taskId + ');">' + nownum +
                                        ' </a></li>';
                                }

                                if (nownum == (page - 10) && nownum != Nowpage) {
                                    str += '<li class="disabled"><span>...</span></li>';
                                } else if (nownum == (page - 10) && nownum == Nowpage) {
                                    str += '<li class="active"><a href="javascript:void(0);" onclick="searchdata(' + nownum + ',' + taskId +
                                        ');">' + nownum + '</a></li>';
                                }

                                if (nownum > (page - 10)) {
                                    if (nownum == Nowpage) {
                                        str += '<li class="active"><a href="javascript:void(0);" onclick="searchdata(' + nownum + ',' + taskId +
                                            ');">' + nownum + '</a></li> ';
                                    } else {
                                        str += '<li ><a href="javascript:void(0);" onclick="searchdata(' + nownum + ',' + taskId + ');">' + nownum +
                                            '</a></li>';
                                    }
                                }


                            }


                        }
                    } else {
                        for (var i = 0; i < page; i++) {
                            var nownum = i + 1;
                            if (nownum == Nowpage) {
                                str += '<li class="active"><a href="javascript:void(0);" onclick="searchdata(' + nownum + ',' + taskId +
                                    ');">' + nownum + ' </a></li> ';
                            } else {
                                str += '<li><a href="javascript:void(0);" onclick="searchdata(' + nownum + ',' + taskId + ');">' + nownum +
                                    ' </a></li> ';
                            }
                        }
                    }


                    if (Nowpage == page) {
                        str += '<li id="prevbtn" class="disabled"><span>»</span></li> ';
                    } else {
                        str += '<li><a href="javascript:void(0);" onclick="searchdata(' + nextpage + ',' + taskId +
                            ');"><span>»</span></a></li>';
                    }

                    str += '</ul>' +
                        '</div>' +
                        '</div>'

                    $("#modalbody").find("div").remove();
                    $("#modalbody").append(str);

                } else {

                    $("#componentempty").css("display", "block");

                    $("#tablelearninglist").find("tr").remove();
                    $("#modalbody").find("div").remove();

                }

            },
            error: function () {
                // alert('获取列表失败。');
            }
        });

    }

    //读取taskId下的全部排队的电话信息 status=1为排队
    function getsearch3(callpage, taskId) {
        if (!callpage) {
            var callpage = 1;
        }
        if (!taskId) {
            var taskId = $("#nowTaskID").val();
        }
        //将页码存入 id="page" 中
        $('#page').val(callpage);
        var url = "{:url('index/alreadyDialed3')}";
        $.ajax({
            url: url,
            dataType: "json",
            type: "post",
            data: {
                'page': callpage,
                'taskId': taskId,
            },

            success: function (data) {
                var total = data.data.total;
                var Nowpage = data.data.Nowpage;
                var page = data.data.page;
                var Nowpage = parseInt(Nowpage);
                // console.log(data.data.list);
                var data = data.data.list; //返回的数据
                if (data.length > 0) {

                    $("#pegeempty").css("display", "none");

                    $("#tablealreadylist").find("tr").remove();

                    for (var i = 0; i < data.length; i++) {

                        var uid = data[i].uid;
                        var mobile = data[i].mobile;
                        var nickname = data[i].nickname;
                        var status = data[i].status;
                        var duration = data[i].duration;
                        var last_dial_time = data[i].last_dial_time;
                        var level = data[i].level;
                        var call_times = data[i].call_times;

                        var originating_call = data[i].originating_call;
                        if (originating_call == null) {
                            originating_call = "";
                        }

                        var strstatus = "未拨打";

                        switch (status) {
                            case 2:
                                strstatus = "已接通";
                                break;
                            case 3:
                                strstatus = "无人接听";
                                break;
                            case 4:
                                strstatus = "停机";
                                break;
                            case 5:
                                strstatus = "空号";
                                break;
                            case 6:
                                strstatus = "正在通话中";
                                break;
                            case 7:
                                strstatus = "关机";
                                break;
                            case 8:
                                strstatus = "用户拒接";
                                break;
                            case 9:
                                strstatus = "网络忙";
                                break;
                            case 10:
                                strstatus = "来电提醒";
                                break;
                            case 11:
                                strstatus = "呼叫转移失败";
                                break;
                        }

                        var strlevel = "";
                        switch (level) {
                            case 6:
                                strlevel = "A级(意向客户)";
                                break;
                            case 5:
                                strlevel = "B级(一般意向)";
                                break;
                            case 4:
                                strlevel = "C级(简单对话)";
                                break;
                            case 3:
                                strlevel = "D级(无有效对话)";
                                break;
                            case 2:
                                strlevel = "E级(有效未接通)";
                                break;
                            case 1:
                                strlevel = "F级(无效号码)";
                                break;
                            default:
                                strlevel = "--";
                        }
                        num = i + 1;
                        var string = '<tr class="itemId' + uid + '" alt="' + uid + '">' +
                            '<td class="text-center">' + num + '</td>' +
                            '<td class="text-center">' + mobile + '</td>'
                            // +'<td class="text-center">'+nickname+'</td>'
                            +
                            '<td class="text-center">' + strstatus + '</td>' +
                            '<td class="text-center">' + duration + '</td>' +
                            '<td class="text-center">' + strlevel + '</td>' +
                            '<td class="text-center">' + call_times + '</td>' +
                            '<td class="text-center">' + last_dial_time + '</td>';


                        // string += '<td class="text-center">'+'<a href="javascript:void(0);" onclick="gotoDetail('+mobile+','+taskId+','+uid+', \'record\');">查看&nbsp;</a>'
                        // 													 +'<a href="javascript:void(0);" onclick="outexcelOne('+uid+')">导出&nbsp;</a>'
                        // 													 +'<a href="javascript:void(0);" onclick="delMem('+uid+')">删除&nbsp;</a>'+'</td>';
                        string += '</tr>';
                        $("#tablealreadylist").append(string);

                    }

                    var prepage = Nowpage - 1;
                    var nextpage = Nowpage + 1;

                    var str = '<div class="row">' +
                        '<div class="col-sm-3 text-left">' +
                        '<span>全部数据：' + total + '&nbsp;</span>' +
                        '</div>' +
                        '<div class="col-sm-9 text-right">' +
                        '<ul class="pagination">';

                    if (Nowpage == 1) {
                        str += '<li id="prevbtn" class="disabled"><span>«</span></li> ';
                    } else {
                        str += '<li><a href="javascript:void(0);" onclick="getsearch3(' + prepage + ',' + taskId +
                            ');"><span>«</span></a></li> ';
                    }

                    if (page > 10) {

                        if (Nowpage < 7) {
                            for (var i = 0; i < page; i++) {
                                var nownum = i + 1;
                                if (nownum < 9) {
                                    if (nownum == Nowpage) {
                                        str += '<li class="active"><a href="javascript:void(0);" onclick="getsearch3(' + nownum + ',' + taskId +
                                            ');">' + nownum + ' </a></li> ';
                                    } else {
                                        str += '<li><a href="javascript:void(0);" onclick="getsearch3(' + nownum + ',' + taskId + ');">' + nownum +
                                            ' </a></li> ';
                                    }
                                }

                                if (nownum == 9 && nownum != Nowpage) {
                                    str += '<li class="disabled"><span>...</span></li>';
                                } else if (nownum == 9) {
                                    str += '<li class="active"><a href="javascript:void(0);" onclick="getsearch3(' + nownum + ',' + taskId +
                                        ');">' + nownum + '</a></li> ';
                                }

                                if (nownum > (page - 2)) {
                                    if (nownum == Nowpage) {
                                        str += '<li class="active"><a href="javascript:void(0);" onclick="getsearch3(' + nownum + ',' + taskId +
                                            ');">' + nownum + ' </a></li> ';
                                    } else {
                                        str += '<li><a href="javascript:void(0);" onclick="getsearch3(' + nownum + ',' + taskId + ');">' + nownum +
                                            ' </a></li> ';
                                    }
                                }

                            }
                        } else if (Nowpage > 6 && Nowpage < (page - 6)) {
                            for (var i = 0; i < page; i++) {
                                var nownum = i + 1;
                                var Nowpage = parseInt(Nowpage);
                                if (nownum < 3) {
                                    str += '<li><a href="javascript:void(0);" onclick="getsearch3(' + nownum + ',' + taskId + ');">' + nownum +
                                        ' </a></li> ';
                                }

                                if ((nownum > Nowpage - 5) && (nownum < Nowpage + 5)) {

                                    if (nownum == (Nowpage - 4)) {
                                        str += '<li class="disabled"><span>...</span></li>';
                                    }

                                    if (nownum > (Nowpage - 4) && nownum < Nowpage) {
                                        str += '<li><a href="javascript:void(0);" onclick="getsearch3(' + nownum + ',' + taskId + ');">' + nownum +
                                            '</a></li>';
                                    }

                                    if (nownum == Nowpage) {
                                        str += '<li class="active"><a href="javascript:void(0);" onclick="getsearch3(' + nownum + ',' + taskId +
                                            ');">' + nownum + '</a></li>';
                                    }

                                    if (nownum < (Nowpage + 4) && nownum > Nowpage) {
                                        str += '<li><a href="javascript:void(0);" onclick="getsearch3(' + nownum + ',' + taskId + ');">' + nownum +
                                            '</a></li>';
                                    }

                                    if (nownum == (Nowpage + 4)) {

                                        str += '<li class="disabled"><span>...</span></li>';
                                    }
                                }

                                if (nownum > (page - 2)) {
                                    var Nowpage = parseInt(Nowpage);
                                    if (nownum == Nowpage) {
                                        str += '<li class="active"><a href="javascript:void(0);" onclick="getsearch3(' + nownum + ',' + taskId +
                                            ');">' + nownum + '</a></li>';
                                    } else {
                                        str += '<li><a href="javascript:void(0);" onclick="getsearch3(' + nownum + ',' + taskId + ');">' + nownum +
                                            '</a></li> ';
                                    }

                                }

                            }
                        } else {

                            for (var i = 0; i < page; i++) {
                                var nownum = i + 1;
                                if (nownum < 3) {
                                    str += '<li><a href="javascript:void(0);" onclick="getsearch3(' + nownum + ',' + taskId + ');">' + nownum +
                                        ' </a></li>';
                                }

                                if (nownum == (page - 10) && nownum != Nowpage) {
                                    str += '<li class="disabled"><span>...</span></li>';
                                } else if (nownum == (page - 10) && nownum == Nowpage) {
                                    str += '<li class="active"><a href="javascript:void(0);" onclick="getsearch3(' + nownum + ',' + taskId +
                                        ');">' + nownum + '</a></li>';
                                }

                                if (nownum > (page - 10)) {
                                    if (nownum == Nowpage) {
                                        str += '<li class="active"><a href="javascript:void(0);" onclick="getsearch3(' + nownum + ',' + taskId +
                                            ');">' + nownum + '</a></li> ';
                                    } else {
                                        str += '<li ><a href="javascript:void(0);" onclick="getsearch3(' + nownum + ',' + taskId + ');">' + nownum +
                                            '</a></li>';
                                    }
                                }
                            }
                        }
                    } else {
                        for (var i = 0; i < page; i++) {
                            var nownum = i + 1;
                            if (nownum == Nowpage) {
                                str += '<li class="active"><a href="javascript:void(0);" onclick="getsearch3(' + nownum + ',' + taskId +
                                    ');">' + nownum + ' </a></li> ';
                            } else {
                                str += '<li><a href="javascript:void(0);" onclick="getsearch3(' + nownum + ',' + taskId + ');">' + nownum +
                                    ' </a></li> ';
                            }
                        }
                    }


                    if (Nowpage == page) {
                        str += '<li id="prevbtn" class="disabled"><span>»</span></li> ';
                    } else {
                        str += '<li><a href="javascript:void(0);" onclick="getsearch3(' + nextpage + ',' + taskId +
                            ');"><span>»</span></a></li>';
                    }

                    str += '</ul>' +
                        '</div>' +
                        '</div>'

                    $("#modalpagebody").find("div").remove();
                    $("#modalpagebody").append(str);

                } else {

                    $("#pegeempty").css("display", "block");
                    $("#tablealreadylist").find("tr").remove();
                    $("#modalpagebody").find("div").remove();
                }
            },
            error: function () {
                // alert('获取列表失败。');
            }
        });

    }

    //读取taskId下的全部已完成的电话信息 status>=2
    // 	function getsearch1(callpage,taskId){
    // 			if(!callpage){
    // 				var callpage = 1;
    // 			}
    // 			if(!taskId){
    // 				 var taskId=$("#nowTaskID").val();
    // 			}
    // 			//将页码存入 id="page" 中
    // 			$('#page').val(callpage);
    // 			var url = "{:url('index/alreadyDialed')}";
    // 			$.ajax({
    // 					url : url,
    // 					dataType : "json",
    // 					type : "post",
    // 					data : {
    // 						'page':callpage,
    // 						'taskId':taskId,
    // 					},

    // 					success: function(data){
    // 							var total = data.data.total;
    // 							var Nowpage = data.data.Nowpage;
    // 							var page = data.data.page;
    // 							var Nowpage = parseInt(Nowpage);
    // 						  // console.log(data.data.list);
    // 							var data = data.data.list; //返回的数据
    // 							 if(data.length > 0){

    // 										$("#pegeempty").css("display","none");

    // 										$("#tablealreadylist").find("tr").remove();

    // 										for(var i=0;i<data.length;i++){

    // 											var uid = data[i].uid;
    // 											var mobile = data[i].mobile;
    // 											var nickname = data[i].nickname;
    // 											var status = data[i].status;
    // 											var duration = data[i].duration;
    // 											var last_dial_time = data[i].last_dial_time;
    // 											var level = data[i].level;

    // 											var originating_call = data[i].originating_call;
    // 											if(originating_call == null){
    // 												 originating_call = "";
    // 											}

    // 											var strstatus = "未拨打";

    // 											switch (status) {
    // 												case 2:
    // 													strstatus = "已接通";
    // 													break;
    // 												case 3:
    // 													strstatus = "无人接听";
    // 													break;
    // 												case 4:
    // 													strstatus = "停机";
    // 													break;
    // 												case 5:
    // 													strstatus = "空号";
    // 													break;
    // 												case 6:
    // 													strstatus = "正在通话中";
    // 													break;
    // 												case 7:
    // 													strstatus = "关机";
    // 													break;
    // 												case 8:
    // 													strstatus = "用户拒接";
    // 													break;
    // 												case 9:
    // 													strstatus = "网络忙";
    // 													break;
    // 												case 10:
    // 													strstatus = "来电提醒";
    // 													break;
    // 												case 11:
    // 													strstatus = "呼叫转移失败";
    // 													break;
    // 											}

    // 											var strlevel = "";
    // 											switch (level) {
    // 												case 6:
    // 													strlevel = "A级(意向客户)";
    // 													break;
    // 												case 5:
    // 													strlevel = "B级(一般意向)";
    // 													break;
    // 												case 4:
    // 													strlevel = "C级(简单对话)";
    // 													break;
    // 												case 3:
    // 													strlevel = "D级(无有效对话)";
    // 													break;
    // 												case 2:
    // 													strlevel = "E级(有效未接通)";
    // 													break;
    // 												case 1:
    // 													strlevel = "F级(无效号码)";
    // 													break;
    // 												default:
    // 													strlevel = "--";
    // 											}
    // 											num = i+1;
    // 											var string = '<tr class="itemId'+uid+'" alt="'+uid+'">'
    // 											// +'<td class="text-center">'+'<input class="icheckbox_square-blue" onclick="checkboxCount()" name="uids[]" type="checkbox" value="'+uid+'">'+'</td>'
    // 											+'<td class="text-center">'+num+'</td>'
    // 											+'<td class="text-center">'+mobile+'</td>'
    // 											// +'<td class="text-center">'+nickname+'</td>'
    // 											+'<td class="text-center">'+strstatus+'</td>'
    // 											+'<td class="text-center">'+duration+'</td>'
    // 											+'<td class="text-center">'+strlevel+'</td>'
    // 											+'<td class="text-center">'+last_dial_time+'</td>';


    // 											// string += '<td class="text-center">'+'<a href="javascript:void(0);" onclick="gotoDetail('+mobile+','+taskId+','+uid+', \'record\');">查看&nbsp;</a>'
    // 											// 													 +'<a href="javascript:void(0);" onclick="outexcelOne('+uid+')">导出&nbsp;</a>'
    // 											// 													 +'<a href="javascript:void(0);" onclick="delMem('+uid+')">删除&nbsp;</a>'+'</td>';
    // 											string += '</tr>';
    // 											$("#tablealreadylist").append(string);

    // 										}

    // 										var prepage = Nowpage-1;
    // 										var nextpage = Nowpage+1;

    // 										var str = '<div class="row">'
    // 										+'<div class="col-sm-3 text-left">'
    // 										+'<span>全部数据：'+total+'&nbsp;</span>'
    // 										+'</div>'
    // 										+'<div class="col-sm-9 text-right">'
    // 										+'<ul class="pagination">';

    // 										if(Nowpage == 1){
    // 											str += '<li id="prevbtn" class="disabled"><span>«</span></li> ';
    // 										}else{
    // 											str += '<li><a href="javascript:void(0);" onclick="getsearch1('+prepage+','+taskId+');"><span>«</span></a></li> ';
    // 										}

    // 										if(page > 10){

    // 											if(Nowpage < 7){
    // 												for(var i=0;i<page;i++){
    // 													var nownum = i+1;
    // 													if(nownum < 9){
    // 														 if(nownum == Nowpage){
    // 															 str += '<li class="active"><a href="javascript:void(0);" onclick="getsearch1('+nownum+','+taskId+');">'+nownum+' </a></li> ';
    // 														 }else{
    // 															 str += '<li><a href="javascript:void(0);" onclick="getsearch1('+nownum+','+taskId+');">'+nownum+' </a></li> ';
    // 														 }
    // 													}

    // 													if(nownum == 9 && nownum != Nowpage){
    // 														 str += '<li class="disabled"><span>...</span></li>';
    // 													}else if(nownum == 9){
    // 														str += '<li class="active"><a href="javascript:void(0);" onclick="getsearch1('+nownum+','+taskId+');">'+nownum+'</a></li> ';
    // 													}

    // 														if(nownum > (page-2)){
    // 															 if(nownum == Nowpage){
    // 																 str += '<li class="active"><a href="javascript:void(0);" onclick="getsearch1('+nownum+','+taskId+');">'+nownum+' </a></li> ';
    // 															 }else{
    // 																 str += '<li><a href="javascript:void(0);" onclick="getsearch1('+nownum+','+taskId+');">'+nownum+' </a></li> ';
    // 															 }
    // 														}

    // 												 }
    // 											}else if(Nowpage > 6 && Nowpage < (page-6)){
    // 												for(var i=0;i<page;i++){
    // 													var nownum = i+1;
    // 													var Nowpage = parseInt(Nowpage);
    // 													if(nownum < 3){
    // 														str += '<li><a href="javascript:void(0);" onclick="getsearch1('+nownum+','+taskId+');">'+nownum+' </a></li> ';
    // 													}

    // 													if((nownum > Nowpage-5) && (nownum < Nowpage+5)){

    // 																	 if(nownum == (Nowpage-4)){
    // 																			str += '<li class="disabled"><span>...</span></li>';
    // 																	 }

    // 																		 if(nownum > (Nowpage-4) && nownum < Nowpage){
    // 																			 str += '<li><a href="javascript:void(0);" onclick="getsearch1('+nownum+','+taskId+');">'+nownum+'</a></li>';
    // 																		 }

    // 																		 if(nownum == Nowpage){
    // 																		 str += '<li class="active"><a href="javascript:void(0);" onclick="getsearch1('+nownum+','+taskId+');">'+nownum+'</a></li>';
    // 																		 }

    // 																		 if(nownum < (Nowpage + 4) && nownum > Nowpage){
    // 																			str += '<li><a href="javascript:void(0);" onclick="getsearch1('+nownum+','+taskId+');">'+nownum+'</a></li>';
    // 																		 }

    // 																		 if(nownum == (Nowpage + 4)){

    // 																		 str += '<li class="disabled"><span>...</span></li>';
    // 																		 }
    // 													 }

    // 												 if(nownum > (page-2)){
    // 													 var Nowpage = parseInt(Nowpage);
    // 													 if(nownum == Nowpage){
    // 																 str += '<li class="active"><a href="javascript:void(0);" onclick="getsearch1('+nownum+','+taskId+');">'+nownum+'</a></li>';
    // 														 }else{
    // 																str += '<li><a href="javascript:void(0);" onclick="getsearch1('+nownum+','+taskId+');">'+nownum+'</a></li> ';
    // 														 }

    // 													 }

    // 												 }
    // 											}else{

    // 												for(var i=0;i<page;i++){
    // 													var nownum = i+1;
    // 													if(nownum<3){
    // 														str += '<li><a href="javascript:void(0);" onclick="getsearch1('+nownum+','+taskId+');">'+nownum+' </a></li>';
    // 													}

    // 													if(nownum == (page-10) && nownum != Nowpage){
    // 														str += '<li class="disabled"><span>...</span></li>';
    // 													}else if(nownum == (page-10) && nownum == Nowpage){
    // 														str += '<li class="active"><a href="javascript:void(0);" onclick="getsearch1('+nownum+','+taskId+');">'+nownum+'</a></li>';
    // 													}

    // 													if(nownum > (page-10)){
    // 														if(nownum == Nowpage){
    // 															str += '<li class="active"><a href="javascript:void(0);" onclick="getsearch1('+nownum+','+taskId+');">'+nownum+'</a></li> ';
    // 														}else{
    // 															str += '<li ><a href="javascript:void(0);" onclick="getsearch1('+nownum+','+taskId+');">'+nownum+'</a></li>';
    // 														}
    // 													}


    // 												}


    // 											}
    // 										}else{
    // 											 for(var i=0;i<page;i++){
    // 												 var nownum = i+1;
    // 												 if(nownum == Nowpage){
    // 													 str += '<li class="active"><a href="javascript:void(0);" onclick="getsearch1('+nownum+','+taskId+');">'+nownum+' </a></li> ';
    // 												 }else{
    // 													 str += '<li><a href="javascript:void(0);" onclick="getsearch1('+nownum+','+taskId+');">'+nownum+' </a></li> ';
    // 												 }
    // 											 }
    // 										}


    // 										if(Nowpage == page){
    // 											str += '<li id="prevbtn" class="disabled"><span>»</span></li> ';
    // 										}else{
    // 											str += '<li><a href="javascript:void(0);" onclick="getsearch1('+nextpage+','+taskId+');"><span>»</span></a></li>';
    // 										}

    // 										str += '</ul>'
    // 										+'</div>'
    // 										+'</div>'

    // 										$("#modalpagebody").find("div").remove();
    // 										$("#modalpagebody").append(str);

    // 									 }
    // 							 else{

    // 										$("#pegeempty").css("display","block");

    // 										$("#tablealreadylist").find("tr").remove();
    // 										$("#modalpagebody").find("div").remove();

    // 							 }


    // 						},
    // 						error : function() {
    // 							// alert('获取列表失败。');
    // 						}
    // 			});

    //   }
    //条件搜索 电话信息
    function getsearch2(callpage, taskId) {
        if (!callpage) {
            var callpage = 1;
        }
        //将页码存入 id="page" 中
        $('#page').val(callpage);
        if (!taskId) {
            var taskId = $("#nowTaskID").val();
        }

        var n_liststate = $("#n_liststate").val(); //全部 还是 完成 还是 排队中
        var activeMode = $("#activeMode").val(); //通话状态 无人接听等等
        var Lengthoftime = $("#Lengthoftime").val(); //选择通话时长
        var rotation = $("#rotation").val(); // 对话轮次的值
        var Levelofintention = $("#Levelofintention").val(); //选择意向等级
        var url = "{:url('index/alreadyDialed2')}";
        $(".l_loadfixed").show();
        $.ajax({
            url: url,
            dataType: "json",
            type: "post",
            data: {
                'page': callpage,
                'taskId': taskId,
                'n_liststate': n_liststate,
                'activeMode': activeMode,
                'Lengthoftime': Lengthoftime,
                'rotation': rotation,
                'Levelofintention': Levelofintention,
            },

            success: function (data) {
                $(".l_loadfixed").hide();
                var total = data.data.total;
                var Nowpage = data.data.Nowpage;
                var page = data.data.page;
                var Nowpage = parseInt(Nowpage);
                // console.log(data.data.list);
                var data = data.data.list; //返回的数据
                if (data.length > 0) {

                    $("#pegeempty").css("display", "none");

                    $("#tablealreadylist").find("tr").remove();

                    for (var i = 0; i < data.length; i++) {

                        var uid = data[i].uid;
                        var mobile = data[i].mobile;
                        var nickname = data[i].nickname;
                        var status = data[i].status;
                        var duration = data[i].duration;
                        var last_dial_time = data[i].last_dial_time;
                        var level = data[i].level;
                        var call_times = data[i].call_times;

                        var originating_call = data[i].originating_call;
                        if (originating_call == null) {
                            originating_call = "";
                        }

                        var strstatus = "未拨打";

                        switch (status) {
                            case 2:
                                strstatus = "已接通";
                                break;
                            case 3:
                                strstatus = "无人接听";
                                break;
                            case 4:
                                strstatus = "停机";
                                break;
                            case 5:
                                strstatus = "空号";
                                break;
                            case 6:
                                strstatus = "正在通话中";
                                break;
                            case 7:
                                strstatus = "关机";
                                break;
                            case 8:
                                strstatus = "用户拒接";
                                break;
                            case 9:
                                strstatus = "网络忙";
                                break;
                            case 10:
                                strstatus = "来电提醒";
                                break;
                            case 11:
                                strstatus = "呼叫转移失败";
                                break;
                        }

                        var strlevel = "";
                        switch (level) {
                            case 6:
                                strlevel = "A级(意向客户)";
                                break;
                            case 5:
                                strlevel = "B级(一般意向)";
                                break;
                            case 4:
                                strlevel = "C级(简单对话)";
                                break;
                            case 3:
                                strlevel = "D级(无有效对话)";
                                break;
                            case 2:
                                strlevel = "E级(有效未接通)";
                                break;
                            case 1:
                                strlevel = "F级(无效号码)";
                                break;
                            default:
                                strlevel = "--";
                        }
                        if(nickname == '' || nickname== null){
                          nickname ='暂无名称';
                        }
                        num = i + 1;
                        var string = '<tr class="itemId' + uid + '" alt="' + uid + '">'
                            // +'<td class="text-center">'+'<input class="icheckbox_square-blue" onclick="checkboxCount()" name="uids[]" type="checkbox"  value="'+uid+'">'+'</td>'
                            +
                            '<td class="text-center">' + num + '</td>' +
                            '<td class="text-center">' + mobile + '</td>'
                             +'<td class="text-center">'+nickname+'</td>'
                            +
                            '<td class="text-center">' + strstatus + '</td>' +
                            '<td class="text-center">' + duration + '</td>' +
                            '<td class="text-center">' + strlevel + '</td>' +
                            '<td class="text-center">' + call_times + '</td>' +
                            '<td class="text-center">' + last_dial_time + '</td>';


                        // string += '<td class="text-center">'+'<a href="javascript:void(0);" onclick="gotoDetail('+mobile+','+taskId+','+uid+', \'record\');">查看&nbsp;</a>'
                        // 													 +'<a href="javascript:void(0);" onclick="outexcelOne('+uid+')">导出&nbsp;</a>'
                        // 													 +'<a href="javascript:void(0);" onclick="delMem('+uid+')">删除&nbsp;</a>'+'</td>';
                        string += '</tr>';
                        $("#tablealreadylist").append(string);

                    }

                    var prepage = Nowpage - 1;
                    var nextpage = Nowpage + 1;

                    var str = '<div class="row">' +
                        '<div class="col-sm-3 text-left">' +
                        '<span>全部数据：' + total + '&nbsp;</span>' +
                        '</div>' +
                        '<div class="col-sm-9 text-right">' +
                        '<ul class="pagination">';

                    if (Nowpage == 1) {
                        str += '<li id="prevbtn" class="disabled"><span>«</span></li> ';
                    } else {
                        str += '<li><a href="javascript:void(0);" onclick="getsearch2(' + prepage + ',' + taskId +
                            ');"><span>«</span></a></li> ';
                    }

                    if (page > 10) {

                        if (Nowpage < 7) {
                            for (var i = 0; i < page; i++) {
                                var nownum = i + 1;
                                if (nownum < 9) {
                                    if (nownum == Nowpage) {
                                        str += '<li class="active"><a href="javascript:void(0);" onclick="getsearch2(' + nownum + ',' + taskId +
                                            ');">' + nownum + ' </a></li> ';
                                    } else {
                                        str += '<li><a href="javascript:void(0);" onclick="getsearch2(' + nownum + ',' + taskId + ');">' + nownum +
                                            ' </a></li> ';
                                    }
                                }

                                if (nownum == 9 && nownum != Nowpage) {
                                    str += '<li class="disabled"><span>...</span></li>';
                                } else if (nownum == 9) {
                                    str += '<li class="active"><a href="javascript:void(0);" onclick="getsearch2(' + nownum + ',' + taskId +
                                        ');">' + nownum + '</a></li> ';
                                }

                                if (nownum > (page - 2)) {
                                    if (nownum == Nowpage) {
                                        str += '<li class="active"><a href="javascript:void(0);" onclick="getsearch2(' + nownum + ',' + taskId +
                                            ');">' + nownum + ' </a></li> ';
                                    } else {
                                        str += '<li><a href="javascript:void(0);" onclick="getsearch2(' + nownum + ',' + taskId + ');">' + nownum +
                                            ' </a></li> ';
                                    }
                                }

                            }
                        } else if (Nowpage > 6 && Nowpage < (page - 6)) {
                            for (var i = 0; i < page; i++) {
                                var nownum = i + 1;
                                var Nowpage = parseInt(Nowpage);
                                if (nownum < 3) {
                                    str += '<li><a href="javascript:void(0);" onclick="getsearch2(' + nownum + ',' + taskId + ');">' + nownum +
                                        ' </a></li> ';
                                }

                                if ((nownum > Nowpage - 5) && (nownum < Nowpage + 5)) {

                                    if (nownum == (Nowpage - 4)) {
                                        str += '<li class="disabled"><span>...</span></li>';
                                    }

                                    if (nownum > (Nowpage - 4) && nownum < Nowpage) {
                                        str += '<li><a href="javascript:void(0);" onclick="getsearch2(' + nownum + ',' + taskId + ');">' + nownum +
                                            '</a></li>';
                                    }

                                    if (nownum == Nowpage) {
                                        str += '<li class="active"><a href="javascript:void(0);" onclick="getsearch2(' + nownum + ',' + taskId +
                                            ');">' + nownum + '</a></li>';
                                    }

                                    if (nownum < (Nowpage + 4) && nownum > Nowpage) {
                                        str += '<li><a href="javascript:void(0);" onclick="getsearch2(' + nownum + ',' + taskId + ');">' + nownum +
                                            '</a></li>';
                                    }

                                    if (nownum == (Nowpage + 4)) {

                                        str += '<li class="disabled"><span>...</span></li>';
                                    }
                                }

                                if (nownum > (page - 2)) {
                                    var Nowpage = parseInt(Nowpage);
                                    if (nownum == Nowpage) {
                                        str += '<li class="active"><a href="javascript:void(0);" onclick="getsearch2(' + nownum + ',' + taskId +
                                            ');">' + nownum + '</a></li>';
                                    } else {
                                        str += '<li><a href="javascript:void(0);" onclick="getsearch2(' + nownum + ',' + taskId + ');">' + nownum +
                                            '</a></li> ';
                                    }

                                }

                            }
                        } else {

                            for (var i = 0; i < page; i++) {
                                var nownum = i + 1;
                                if (nownum < 3) {
                                    str += '<li><a href="javascript:void(0);" onclick="getsearch2(' + nownum + ',' + taskId + ');">' + nownum +
                                        ' </a></li>';
                                }

                                if (nownum == (page - 10) && nownum != Nowpage) {
                                    str += '<li class="disabled"><span>...</span></li>';
                                } else if (nownum == (page - 10) && nownum == Nowpage) {
                                    str += '<li class="active"><a href="javascript:void(0);" onclick="getsearch2(' + nownum + ',' + taskId +
                                        ');">' + nownum + '</a></li>';
                                }

                                if (nownum > (page - 10)) {
                                    if (nownum == Nowpage) {
                                        str += '<li class="active"><a href="javascript:void(0);" onclick="getsearch2(' + nownum + ',' + taskId +
                                            ');">' + nownum + '</a></li> ';
                                    } else {
                                        str += '<li ><a href="javascript:void(0);" onclick="getsearch2(' + nownum + ',' + taskId + ');">' + nownum +
                                            '</a></li>';
                                    }
                                }


                            }


                        }
                    } else {
                        for (var i = 0; i < page; i++) {
                            var nownum = i + 1;
                            if (nownum == Nowpage) {
                                str += '<li class="active"><a href="javascript:void(0);" onclick="getsearch2(' + nownum + ',' + taskId +
                                    ');">' + nownum + ' </a></li> ';
                            } else {
                                str += '<li><a href="javascript:void(0);" onclick="getsearch2(' + nownum + ',' + taskId + ');">' + nownum +
                                    ' </a></li> ';
                            }
                        }
                    }


                    if (Nowpage == page) {
                        str += '<li id="prevbtn" class="disabled"><span>»</span></li> ';
                    } else {
                        str += '<li><a href="javascript:void(0);" onclick="getsearch2(' + nextpage + ',' + taskId +
                            ');"><span>»</span></a></li>';
                    }

                    str += '</ul>' +
                        '</div>' +
                        '</div>'

                    $("#modalpagebody").find("div").remove();
                    $("#modalpagebody").append(str);

                } else {

                    $("#pegeempty").css("display", "block");

                    $("#tablealreadylist").find("tr").remove();
                    $("#modalpagebody").find("div").remove();

                }


            },
            error: function () {
                // alert('获取列表失败。');
            }
        });

    }

    //获取已经拨打列表
    var callpage = 1;
    var taskId = 1;
    // 	function getsearch(callpage,taskId){
    // 			if(!taskId){
    // 			  var taskId = $("#nowTaskID").val();
    // 			}
    // 			if(!callpage){
    // 				var callpage = 1;
    // 			}
    // 			//将页码存入 id="page" 中
    // 			$('#page').val(callpage);
    //       var n_liststate = $("#n_liststate").val();      //完成还是排队中
    //       var activeMode = $("#activeMode").val();      //通话状态 无人接听 ===
    // 			var Lengthoftime = $("#Lengthoftime").val();  //选择通话时长
    // 			var rotation = $("#rotation").val();          // 对话轮次的值
    // 			var Levelofintention = $("#Levelofintention").val();   //选择意向等级
    // 			var url = "{:url('alreadyDialed')}";

    // 			$.ajax({
    // 					url : url,
    // 					dataType : "json",
    // 					type : "post",
    // 					data : {
    // 						'page':callpage,
    // 						'taskId':taskId,
    // 						'n_liststate':n_liststate,
    // 						'activeMode':activeMode,
    // 						'Lengthoftime':Lengthoftime,
    // 						'rotation':rotation,
    // 						'Levelofintention':Levelofintention,
    // 					},

    // 					success: function(data){
    // 							var total = data.data.total;
    // 							var Nowpage = data.data.Nowpage;
    // 							var page = data.data.page;
    // 							var Nowpage = parseInt(Nowpage);
    // 							// console.log('1'+data);
    // 							var data = data.data.list;
    // 							 if(data.length > 0){

    // 										$("#pegeempty").css("display","none");

    // 										$("#tablealreadylist").find("tr").remove();

    // 										for(var i=0;i<data.length;i++){

    // 											var uid = data[i].uid;
    // 											var mobile = data[i].mobile;
    // 											var nickname = data[i].nickname;
    // 											var status = data[i].status;
    // 											var duration = data[i].duration;
    // 											var last_dial_time = data[i].last_dial_time;
    // 											var level = data[i].level;

    // 											var originating_call = data[i].originating_call;
    // 											if(originating_call == null){
    // 												 originating_call = "";
    // 											}

    // 											var strstatus = "未拨打";

    // 											switch (status) {
    // 												case 2:
    // 													strstatus = "已接通";
    // 													break;
    // 												case 3:
    // 													strstatus = "无人接听";
    // 													break;
    // 												case 4:
    // 													strstatus = "停机";
    // 													break;
    // 												case 5:
    // 													strstatus = "空号";
    // 													break;
    // 												case 6:
    // 													strstatus = "正在通话中";
    // 													break;
    // 												case 7:
    // 													strstatus = "关机";
    // 													break;
    // 												case 8:
    // 													strstatus = "用户拒接";
    // 													break;
    // 												case 9:
    // 													strstatus = "网络忙";
    // 													break;
    // 												case 10:
    // 													strstatus = "来电提醒";
    // 													break;
    // 												case 11:
    // 													strstatus = "呼叫转移失败";
    // 													break;
    // 												default:
    // 													strstatus = "--";
    // 											}

    // 											var strlevel = "";
    // 											switch (level) {
    // 												case 6:
    // 													strlevel = "A级(有明确意向)";
    // 													break;
    // 												case 5:
    // 													strlevel = "B级(可能有意向)";
    // 													break;
    // 												case 4:
    // 													strlevel = "C级(明确拒绝)";
    // 													break;
    // 												case 3:
    // 													strlevel = "D级(用户忙)";
    // 													break;
    // 												case 2:
    // 													strlevel = "E级(拨打失败)";
    // 													break;
    // 												case 1:
    // 													strlevel = "F级(无效客户)";
    // 													break;
    // 												default:
    // 													strlevel = "--";
    // 											}
    // 											num = i+1;
    // 											var string = '<tr class="itemId'+uid+'" alt="'+uid+'">'
    // 											// +'<tr class="text-center">'+'<input class="icheckbox_square-blue" onclick="checkboxCount()" name="uids[]" type="checkbox"  value="'+uid+'">'+'</td>'
    // 											+'<td class="text-center">'+num+'</td>'
    // 											+'<td class="text-center">'+mobile+'</td>'
    // 											// +'<td class="text-center">'+nickname+'</td>'
    // 											+'<td class="text-center">'+strstatus+'</td>'
    // 											+'<td class="text-center">'+duration+'</td>'
    // 											+'<td class="text-center">'+strlevel+'</td>'
    // 											+'<td class="text-center">'+last_dial_time+'</td>';

    // 											// string += '<td class="text-center">'+'<a href="javascript:void(0);" onclick="gotoDetail('+mobile+','+taskId+','+uid+', \'record\');">查看&nbsp;</a>'
    // 											// 													 +'<a href="javascript:void(0);" onclick="outexcelOne('+uid+')">导出&nbsp;</a>'
    // 											// 													 +'<a href="javascript:void(0);" onclick="delMem('+uid+')">删除&nbsp;</a>'+'</td>';
    // 											string += '</tr>';
    // 											$("#tablealreadylist").append(string);

    // 										}

    // 										var prepage = Nowpage-1;
    // 										var nextpage = Nowpage+1;

    // 										var str = '<div class="row">'
    // 										+'<div class="col-sm-3 text-left">'
    // 											+'<span>全部数据：'+total+'&nbsp;</span>'
    // 										+'</div>'
    // 										+'<div class="col-sm-9 text-right">'
    // 										+'<ul class="pagination">';

    // 										if(Nowpage == 1){
    // 											str += '<li id="prevbtn" class="disabled"><span>«</span></li> ';
    // 										}else{
    // 											str += '<li><a href="javascript:void(0);" onclick="getsearch('+prepage+','+taskId+');"><span>«</span></a></li> ';
    // 										}

    // 										if(page > 10){

    // 											if(Nowpage < 7){
    // 												for(var i=0;i<page;i++){
    // 													var nownum = i+1;
    // 													if(nownum < 9){
    // 														 if(nownum == Nowpage){
    // 															 str += '<li class="active"><a href="javascript:void(0);" onclick="getsearch('+nownum+','+taskId+');">'+nownum+' </a></li> ';
    // 														 }else{
    // 															 str += '<li><a href="javascript:void(0);" onclick="getsearch('+nownum+','+taskId+');">'+nownum+' </a></li> ';
    // 														 }
    // 													}

    // 													if(nownum == 9 && nownum != Nowpage){
    // 														 str += '<li class="disabled"><span>...</span></li>';
    // 													}else if(nownum == 9){
    // 														str += '<li class="active"><a href="javascript:void(0);" onclick="getsearch('+nownum+','+taskId+');">'+nownum+'</a></li> ';
    // 													}

    // 														if(nownum > (page-2)){
    // 															 if(nownum == Nowpage){
    // 																 str += '<li class="active"><a href="javascript:void(0);" onclick="getsearch('+nownum+','+taskId+');">'+nownum+' </a></li> ';
    // 															 }else{
    // 																 str += '<li><a href="javascript:void(0);" onclick="getsearch('+nownum+','+taskId+');">'+nownum+' </a></li> ';
    // 															 }
    // 														}

    // 												 }
    // 											}else if(Nowpage > 6 && Nowpage < (page-6)){
    // 												for(var i=0;i<page;i++){
    // 													var nownum = i+1;
    // 													var Nowpage = parseInt(Nowpage);
    // 													if(nownum < 3){
    // 														str += '<li><a href="javascript:void(0);" onclick="getsearch('+nownum+','+taskId+');">'+nownum+' </a></li> ';
    // 													}

    // 													if((nownum > Nowpage-5) && (nownum < Nowpage+5)){

    // 																	 if(nownum == (Nowpage-4)){
    // 																			str += '<li class="disabled"><span>...</span></li>';
    // 																	 }

    // 																		 if(nownum > (Nowpage-4) && nownum < Nowpage){
    // 																			 str += '<li><a href="javascript:void(0);" onclick="getsearch('+nownum+','+taskId+');">'+nownum+'</a></li>';
    // 																		 }

    // 																		 if(nownum == Nowpage){
    // 																		 str += '<li class="active"><a href="javascript:void(0);" onclick="getsearch('+nownum+','+taskId+');">'+nownum+'</a></li>';
    // 																		 }

    // 																		 if(nownum < (Nowpage + 4) && nownum > Nowpage){
    // 																			str += '<li><a href="javascript:void(0);" onclick="getsearch('+nownum+','+taskId+');">'+nownum+'</a></li>';
    // 																		 }

    // 																		 if(nownum == (Nowpage + 4)){

    // 																		 str += '<li class="disabled"><span>...</span></li>';
    // 																		 }
    // 													 }

    // 												 if(nownum > (page-2)){
    // 													 var Nowpage = parseInt(Nowpage);
    // 													 if(nownum == Nowpage){
    // 																 str += '<li class="active"><a href="javascript:void(0);" onclick="getsearch('+nownum+','+taskId+');">'+nownum+'</a></li>';
    // 														 }else{
    // 																str += '<li><a href="javascript:void(0);" onclick="getsearch('+nownum+','+taskId+');">'+nownum+'</a></li> ';
    // 														 }

    // 													 }

    // 												 }
    // 											}else{

    // 												for(var i=0;i<page;i++){
    // 													var nownum = i+1;
    // 													if(nownum<3){
    // 														str += '<li><a href="javascript:void(0);" onclick="getsearch('+nownum+','+taskId+');">'+nownum+' </a></li>';
    // 													}

    // 													if(nownum == (page-10) && nownum != Nowpage){
    // 														str += '<li class="disabled"><span>...</span></li>';
    // 													}else if(nownum == (page-10) && nownum == Nowpage){
    // 														str += '<li class="active"><a href="javascript:void(0);" onclick="getsearch('+nownum+','+taskId+');">'+nownum+'</a></li>';
    // 													}

    // 													if(nownum > (page-10)){
    // 														if(nownum == Nowpage){
    // 															str += '<li class="active"><a href="javascript:void(0);" onclick="getsearch('+nownum+','+taskId+');">'+nownum+'</a></li> ';
    // 														}else{
    // 															str += '<li ><a href="javascript:void(0);" onclick="getsearch('+nownum+','+taskId+');">'+nownum+'</a></li>';
    // 														}
    // 													}


    // 												}


    // 											}
    // 										}else{
    // 											 for(var i=0;i<page;i++){
    // 												 var nownum = i+1;
    // 												 if(nownum == Nowpage){
    // 													 str += '<li class="active"><a href="javascript:void(0);" onclick="getsearch('+nownum+','+taskId+');">'+nownum+' </a></li> ';
    // 												 }else{
    // 													 str += '<li><a href="javascript:void(0);" onclick="getsearch('+nownum+','+taskId+');">'+nownum+' </a></li> ';
    // 												 }
    // 											 }
    // 										}


    // 										if(Nowpage == page){
    // 											str += '<li id="prevbtn" class="disabled"><span>»</span></li> ';
    // 										}else{
    // 											str += '<li><a href="javascript:void(0);" onclick="getsearch('+nextpage+','+taskId+');"><span>»</span></a></li>';
    // 										}

    // 										str += '</ul>'
    // 										+'</div>'
    // 										+'</div>'

    // 										$("#modalpagebody").find("div").remove();
    // 										$("#modalpagebody").append(str);

    // 									 }
    // 							 else{

    // 										$("#pegeempty").css("display","block");

    // 										$("#tablealreadylist").find("tr").remove(); //此处会把默认网页带的张三那条信息删掉
    // 										$("#modalpagebody").find("div").remove();

    // 							 }


    // 						},
    // 						error : function() {
    // 							// alert('获取列表失败。');
    // 						}
    // 			});

    //   }


    //原来的暂停所有任务
    function stopAllold() {

        var numArr = new Array();
        $('.Idlist').each(function () {
            numArr.push($(this).val()); //添加至数组
        });
        $('#tips_model').modal('hide');
        var url = "{:url('stopAll')}";
        $.ajax({
            url: url,
            dataType: "json",
            type: "post",
            data: {
                'idList': numArr
            },
            success: function (data) {
                // console.log(data);
                if (data.code) {
                    alert(data.msg);
                } else {
                    var taskID = $("#nowTaskID").val();
                    if (taskID > 0) {
                        refurbish();
                    } else {
                        location.reload();
                    }

                }

            },
            error: function () {
                alert('暂停所有任务失败。');
            }
        });

    }

    //自己新写的暂停所有任务
    function stopAll() {
        var numArr = new Array();
        $('.c_tasklshow').each(function () {
            numArr.push($(this).attr('data-id')); //将要暂停的 task_id添加至数组
        });
        $('#tips_model').modal('hide');
        var url = "{:url('stopAll')}";
        $.ajax({
            url: url,
            dataType: "json",
            type: "post",
            data: {
                'idList': numArr
            },
            success: function (data) {
                // console.log(data);
                if (data.code) {
                    alert(data.msg);
                } else {
                    var taskID = $("#nowTaskID").val();
                    if (taskID > 0) {
                        refurbish();
                    } else {
                        location.reload();
                    }

                }

            },
            error: function () {
                alert('暂停所有任务失败。');
            }
        });
    }

    //设置状态
    function setstatus(id, status) {
        var url = "{:url('setstatus')}";
        $.ajax({
            url: url,
            dataType: "json",
            type: "post",
            data: {
                'pId': id,
                'status': status
            },
            success: function (data) {
                if (data.code) {
                    alert(data.msg);
                } else {
                    var taskID = $("#nowTaskID").val();
                    if (taskID > 0) {
                        refurbish();
                    } else {
                        location.reload();
                    }
                    //location.reload();
                }
            },
            error: function () {
                alert('设置状态');
            }
        });
    }

    //删除任务计划  多删
    function delPlan(id) {

        var r = confirm('确认删除?');
        if (!r)
            return;

        var ids = [];
        if (id) {
            ids.push(id);
        } else {

            var roleids = document.getElementsByName("customerIds");
            for (var j = 0; j < roleids.length; j++) {
                if (roleids.item(j).checked == true) {
                    ids.push(roleids.item(j).value);
                }
            }
        }

        if (!ids.length) {
            alert("至少选择一条。");
            return false;
        }
        $.post("{:url('delPlan')}", {
            'id': ids
        }, function (data) {
            if (data) {
                alert(data);
            } else {
                window.location.href = window.location.href;
            }
        });
    }

    //删除任务会员member  单删
    function delMem(id) {
        var r = confirm('确认删除?');
        if (!r) {
            return false;
        }
        $.post("{:url('delMember')}", {
            'id': id
        }, function (data) {
            if (data.code == 0) {
                //开始时候刷新右侧任务栏 更新状态
                var task_state = $('#n_seltaskstate').val();
                var task_name = $('#taskName').val();
                window.currentPage = 1;
                window.listcunt = 0;
                show_task_list('', task_state, task_name);
                getsearch2();
                alert(data.msg);


            } else {
                alert(data.msg);
            }
        });
    }

    //批量删除会员 member
    function delMemAll() {
        var r = confirm('确认全部删除?');
        if (!r) {
            return false;
        }
        //将要删除的id放在数组中
        var arr = [];
        $("input[name='uids[]']:checked").each(function (index, item) {
            arr[index] = $(this).val();
        });
        if (!arr || arr.length == 0) {
            alert('请最少选择一项,再删除');
            return false;
        }
        // console.log(arr);
        $.post("{:url('delMember')}", {
            'data': arr
        }, function (data) {
            if (data.code == 0) {
                //开始时候刷新右侧任务栏 更新状态
                var task_state = $('#n_seltaskstate').val();
                var task_name = $('#taskName').val();
                window.currentPage = 1;
                window.listcunt = 0;
                show_task_list('', task_state, task_name);
                getsearch2();
                alert(data.msg);
            } else {
                alert(data.msg);
            }
        });
    }
</script>



<script type="text/javascript" src="__PUBLIC__/plugs/jquery/jquery.form.min.js"></script>
<!-- 导入用户Large modal -->
<div class="l_loadfixed hidden" id="Mask_box">
    <div class="l_loaddata">
        <div class="import"><img src="__PUBLIC__/img_sj/reload.gif" alt="">号码正在导入...</div>
        <!--<div class="success"> <i class="successImport"></i>号码导入成功</div>-->
    </div>
</div>

<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
    <div class="modal-dialog" style="width:490px;">
        <div class="modal-content n_modalcontent">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="myModalLabel">导入号码</h4>
            </div>
            <div class="modal-body">
                <form id="fileform" action="{:url('user/member/importExcel')}" method="post"
                      class="form-horizontal margintop"
                      enctype="multipart/form-data">
                    <div class="form-group ">
                        <label class="col-lg-4 col-md-4 control-label paddingr0">导入号码：</label>
                        <div class="col-lg-8 col-md-8 import-method">
                            <input type="radio" name="importMethod" data-type="uploadFiles"
                                   checked="checked"><span>上传文件</span>
                            <input type="radio" name="importMethod" data-type="localNumber"><span id="xxxxxx">本地号码</span>
                        </div>
                    </div>

                    <div class="form-group localNumber hidden">
                        <label class="col-lg-4 col-md-4 control-label paddingr0">选择号码组：</label>
                        <div class="col-lg-8 col-md-8">
                            <select class="form-control" style="width:200px;" id="phone_box_select">

                            </select>
                        </div>
                    </div>

                    <div class="form-group  uploadFiles ">
                        <label class="col-lg-4 col-md-4 control-label paddingr0">上传号码文件导入：</label>
                        <div class="col-lg-8 col-md-8 import-method">
                            <input type="file" class="" id="excelId" name="excel" accept=".xlsx,.txt"/>
                        </div>
                    </div>

                    <div class="form-group  uploadFiles " >
                        <label class="col-lg-4 col-md-4 control-label"></label>
                        <div class="col-lg-8 col-md-8 " id="muban_download">
                            <a href="__STATIC__/template.xlsx">xlsx模板下载</a> / <a
                                href="{:config('res_url')}api/file/download?file_path=template.txt">txt模板下载</a>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-lg-4 col-md-4 control-label"></label>
                        <div class="col-lg-8 col-md-8 ">
                            <div class="importNum-tips">当前最优支持5万号码导入</div>
                        </div>
                    </div>

                    <!-- 当前任务的ID -->
                    <input type="hidden" name="taskID" id="taskexampletaskID" value=""/>
                </form>
                <br/>
            </div>
            <div style="clear:both;"></div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                <button type="button" onclick="Savechange();" class="btn btn-primary">确定</button>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        //本地号码和上传文件切换
        $("input[name='importMethod'][type='radio']").click(function () {
            var tmp = $(this).attr('data-type');
            if (tmp == 'localNumber') {
                $(".localNumber").removeClass('hidden');
                $(".uploadFiles").addClass('hidden');
            } else {
                $(".localNumber").addClass('hidden');
                $(".uploadFiles").removeClass('hidden');
            }
        })


        //保存页面
        function loadexcel() {

            var task_id = $("#nowTaskID").val(); //获取当前任务id
            $("input[name='importMethod']").get(0).checked = true;
            $("input[name=angel]:eq(0)").attr("checked", 'checked');
            $('#exampleModal').modal('show');
            var href = "{:url('list_phone_box')}"
            $.ajax({
                type: "POST",
                dataType: 'json',
                url: href,
                data: {
                        task_id: task_id
                },
                success: function (result) {
                    console.log(99669966);
                    console.log(result.data.list);
                    var obj = result.data.list;
                    if (result.code == 0) {
                        var option = '';
                        option += "<option value='0'> 请选择</option>";
                        $.each(obj, function (i, val) {
                            option += "<option value='" + i + "'>" + val + "</option>";
                        })
                        $('#phone_box_select').html(option);
                        $("input[data-type='localNumber']").show();
                        $("#xxxxxx").show();
                        var string='<a href="__STATIC__/template.xlsx">xlsx模板下载</a> / <a href="{:config("res_url")}api/file/download?file_path=template.txt">txt模板下载</a>'
                        $('#muban_download').html(string);
                    }
					//如果是变量话术
                        if(result.data.is_variable==1){
                          var url =result.data.url;
                          $('#muban_download').html('<a href="'+url+'">变量模板下载</a>');
                          $("input[data-type='localNumber']").hide();
                          $("#xxxxxx").hide();
                        }
                },
                error: function (data) {
                    alert("提交失败");
                }
            })


        }

        //保存页面
        function Savechange() {
            var type = $('input:radio[name="importMethod"]:checked').data('type');
            if (type == 'localNumber') { //号码组
                var phone_box_select = $('#phone_box_select').val();
                if (phone_box_select == 0 || phone_box_select == '') {
                    alert('请选择号码组');
                    return false;
                }
                var task_id = $("#nowTaskID").val();
                if (!task_id) {
                    alert('请选择要导入到哪个任务中');
                    return false;
                }
                var href = "{:url('member/phone_book')}"
                $.ajax({
                    type: "POST",
                    dataType: 'json',
                    url: href,
                    data: {
                        id: phone_box_select,
                        task_id: task_id
                    },
                    success: function (result) {
                        $('#Mask_box').addClass('hidden');
                        alert(result.msg);
                        if (result.code == 0) {
                            getsearch3();
                            var task_id = $("#nowTaskID").val();
                            get_data_info(task_id);
                            $("#n_liststate option:eq(1)").prop("selected", 'selected');
                        }
                    },
                    error: function (data) {
                        alert("提交失败");
                    }
                });
            } else if (type == 'uploadFiles') { //批量导入
                var excel = document.getElementById('excelId');
                if (excel.files[0] == undefined) {
                    alert('未上传文件！');
                    return false;
                }
                var filevalue = excel.value;
                var index = filevalue.lastIndexOf('.');
                var ename = filevalue.substring(index);
                if (ename != ".xlsx") {
                    if (ename != ".xls") {
                        if (ename != ".txt") {
                            alert('文件格式错误。"xlsx"或者"xls或者txt"，请用下载的模板改。');
                            return false;
                        }
                    }
                }
                $("#fileform").submit();
                $(".progress-bar-data").width(0 + '%');
                $(".Progress_value").html('0.00' + '%');
                $('.finish').addClass('hidden');
                $('.import').removeClass('hidden');
                $('#effectTmp').modal('show');
            }
            $('#exampleModal').modal('hide');
        }
    </script>
</div>

<div class="modal fade" id="newModal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
    <div class="modal-dialog" style="width: 300px;">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="myModalLabel">新建用户</h4>
            </div>
            <div class="modal-body">
                <form id="addNewform" method="post" class="form-horizontal" enctype="multipart/form-data">

                    <div class="form-group">
                        <label class="col-lg-4 control-label">姓名：</label>
                        <div class="col-lg-7 col-sm-10">
                            <input type="text" name="nickname" class="form-control" id="nickname_a" value=""/>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-lg-4 control-label">性别：</label>
                        <div class="col-lg-7 col-sm-6">
                            &nbsp;<input type="radio" name="sex" value="0" id="sexman" checked/> 男
                            &nbsp;&nbsp;&nbsp;&nbsp;<input type="radio" id="sexwoman" name="sex" value="1"/> 女
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-lg-4 control-label">手机号：</label>
                        <div class="col-lg-7 col-sm-10">
                            <input type="text" class="form-control" placeholder="请输入手机号" name="phonenumber"
                                   id="phonenumber" value=""/>
                        </div>
                    </div>

                    <div class="form-group" style="margin-top:10px;">
                        <label class="col-lg-4 control-label">客户分组：</label>
                        <div class="col-lg-7 col-sm-10">
                            <select id="groupId" name="groupId" class="form-control">
                                <option value="">请选择角色</option>
                                {notempty name="groupList"}
                                {volist name="groupList" id="vo"}
                                <option {eq name="$dvlist.group_id|default='0'" value="$vo.id" } selected {
                                /eq} value="{$vo.id}">{$vo.name}</option>
                                {/volist}
                                {/notempty}
                            </select>

                        </div>
                    </div>


                    <input type="hidden" name="mumid" id="mumid" value=""/>
                    <!-- 当前任务的ID -->
                    <input type="hidden" name="taskID" id="taskID" value=""/>
                </form>

            </div>
            <div style="clear:both;"></div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                <button type="button" onclick="saveMember();" class="btn btn-primary">保存</button>
            </div>
        </div>

    </div>

    <script type="text/javascript">
        //保存页面
        function addNew(uid) {
            $("#mumid").val(uid);
            if (uid > 0) {
                $.ajax({
                    type: "POST",
                    dataType: 'json',
                    url: "{:url('User/member/getwhite')}",
                    cache: false,
                    data: {
                        id: uid
                    },
                    success: function (data) {
                        if (data.code == 0) {

                            var data = data.data;
                            $("#nickname").val(data.nickname);
                            $("#realname").val(data.real_name);

                            $("#phonenumber").val(data.mobile);

                            if (data.sex > 0) {
                                $("#sexwoman").prop("checked", true)
                            } else {
                                $("#sexman").prop("checked", true)
                            }

                            $("#groupId").val(data.group_id);
                            alert("导入成功！！！");
                            $('#newModal').modal('show');

                        }
                    },
                    error: function (data) {
                        alert("提交失败");
                    }
                })
            } else {

                $("#nickname").val("");
                $("#realname").val("");
                $("#phonenumber").val("");
                $("#groupId").val("");
                $("#sexman").prop("checked", true);

                $('#newModal').modal('show');
            }
        }


        function saveMember() {

            var nickname = $("#nickname_a").val();
            var realname = $("#realname").val();
            var phonenumber = $("#phonenumber").val();
            var taskId = $("#taskID").val();

            if (phonenumber == '') {
                alert("号码不可为空");
                return false;
            }

            var mobileREa = /^1[3|4|5|6|7|8|9]\d{9}$/;
            var phoneruler = /^0\d{2,3}-?\d{7,8}$/;

            if (!mobileREa.test(phonenumber)) {
                if (!phoneruler.test(phonenumber)) {

                    alert("号码格式不正确");
                    return false;
                }
            }

            var href = "{:url('User/member/addMember')}";
            var mumid = $("#mumid").val();
            if (mumid > 0) {
                href = "{:url('User/member/editMember')}";
            }

            $.ajax({
                type: "POST",
                dataType: 'json',
                url: href,
                cache: false,
                data: $("#addNewform").serialize(),
                success: function (data) {
                    if (data.code == 0) {
                        searchdata(1, taskId);
                        $('#newModal').modal('hide');
                    } else {
                        alert(data.msg);
                    }
                },
                error: function (data) {
                    // alert("提交失败");
                }
            })
        }
    </script>

    <!--短信推送-->
    <script>
        $(function () {
            var i = 1;
            $('#smspush').on('click', function () {
                var html = "<div class = \"form-group smspushs\" id=\"pushdetails" + i++
                    + "\" style=\"margin-left:10px;\">"
                    + " <label class=\"statusSelect\"> 推送详情：</label> "
                    + "<div class=\"col-lg-10 col-sm-10\">"
                    + "<select class=\"form-control textwidth\">"
                    + "<option>短信1</option>"
                    + "<option>短信2</option>"
                    + "<option>短信3</option>"
                    + "</select>"
                    + "</div>"
                    + "</div>";
                $("#l-push").append(html);
            });
        });

    </script>

</div>


<style type="text/css">
    .textwidth {
        width: 250px;
    }

    .add_yuyin {
        height: .85rem;
        border-top: 1px solid #e5e5e5;
        margin-left: .28rem;
        line-height: .85rem;
        width: 100%;;
        float: left;
    }

    .luzhiyy {
        position: relative;
        font-size: .3rem;
        color: #666
    }

    .luzhiyy::after {
        position: absolute;
        right: .25rem;
        top: .28rem;
        width: .3rem;
        height: .3rem;
        content: "";
        background: url("../images/icon.png") no-repeat -5.78rem -3.59rem;
        background-size: 14.57rem 4.86rem;
    }

    .luzhiyy s {
        display: inline-block;
        width: .48rem;
        height: .48rem;
        background: url("../images/icon.png") no-repeat -5.59rem -2.86rem;
        background-size: 14.57rem 4.86rem;
        vertical-align: middle;
        margin-right: .24rem;
    }

    .tijaobtn {
        width: 90%;
        height: .8rem;
        background-color: #f16461;
        text-align: center;
        line-height: .8rem;
        color: #fff;
        margin: 0rem auto;
        display: block;
        border-radius: 6px;
        font-size: .3rem;
    }

    .tijaobtn[disabled] {
        background-color: #f4cac9;
    }

    .r_yuyin {
        color: #999999;
        height: .4rem;
        line-height: .4rem;
        padding: 0 .1rem;
        background-color: #95ce73;
        border: 1px solid #368e42;
        border-radius: 6px;
        max-width: 75%;
        min-width: 18%;
        position: relative;
        float: right;
    }

    .r_yuyin s {
        width: .4rem;
        height: .4rem;
        position: absolute;
        right: .2rem;
        top: .09rem;
        background: url("../images/icon.png") no-repeat -7.11rem -3.62rem;
        background-size: 14.57rem 4.86rem;
    }

    .deleteicon {
        width: .55rem;
        height: .5rem;
        background: url("../images/icon.png") no-repeat -6.17rem -3.41rem;
        background-size: 14.57rem 4.86rem;
        margin-top: .12rem;
        margin-left: .1rem;
        float: left;
    }

    .luyin_dialog {
        position: absolute;
        z-index: 500;
        top: 0;
        left: 0;
        bottom: 0;
        right: 0;
        background: url("../images/luyinbg.jpg") no-repeat center center;
        background-size: cover;
        display: none;
    }

    .r_yuyin i {
        float: right;
        color: #ffffff;
        font-size: 21px;
        font-weight: 600;
    }

    .header_img {
        font-size: 30px;
    }

    .audio-c {
        width: 100%;
        background-color: #6b9cb6;
        text-align: center;
        padding-top: 5px;

    }

    .info_s {
        display: block;
        float: left;
        /* width: 27%; */
        width: 240px;
        background-color: #fff;
        margin-right: 20px;

    }

    .info_s h4 {
        font-weight: bold;
        background-color: #6b9cb6;
        color: #fff;
        padding: 11px 5px;
        margin-top: 10px;
        width: 100%;
        text-align: center;
    }

    .info_s h4:nth-of-type(1) {
        margin-top: 0px;
    }

    .item {
        border-radius: 3px;
        border: solid 1px #dcdcdc;
        padding: 5px;
        display: inline-block;
        width: 47%;
        margin-top: 10px;
        text-align: center;
        font-size: 12px;
    }

    .greenactive {
        border: solid 1px #69baff;
        background-color: #e3eff7;
        color: #0e90fe;;
    }

    .tip {
        font-size: 12px;
    }

    .popover-content {
        color: #008cee;
        text-align: right;
        margin-right: 50px;
    }
</style>


<link href="__STATIC__/css/chat.css" rel="stylesheet" type="text/css">
<script src="__STATIC__/js/audio.js"></script>


<!--  通话详情  -->
<div class="modal fade bs-example-modal-lg " id="call-detail" tabindex="-1" role="dialog"
     aria-labelledby="myModalLabel">

    <div class="modal-dialog modal-lg" role="document">

        <div class="modal-content">

            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title"><strong>查看 (由于录音数据量大，因此录音默认在通话结束后3-5分钟后显示）</strong></h4>
            </div>
            <div class="modal-body">
                <input type="hidden" id="thisId" value="">
                <div class="row">
                    <div class="containerss">

                        <div class="info_s">
                            <h4>基本信息</h4>
                            <div style="margin-top: 10px;font-size: 13px;">
                                姓名：<span class="record" style="font-size: 13px;" id="nickname"></span>
                            </div>

                            <div style="margin-top: 5px;font-size: 13px;">
                                性别：<span class="iparea" style="font-size: 13px;" id="sex"></span>
                            </div>

                            <div style="margin-top: 5px;font-size: 13px;">
                                号码：<span style="font-size: 10px;" id="mobile"></span>
                            </div>

                            <h4>通话结果</h4>
                            <div style="margin-top: 10px;font-size: 13px;">
                                拨打时间：<span class="record" style="font-size: 13px;" id="last_dial_time"></span>
                            </div>

                            <div style="margin-top: 5px;font-size: 13px;">
                                通话时长：<span class="iparea" style="font-size: 13px;" id="duration"></span>
                            </div>

                            <div style="margin-top: 5px;font-size: 13px;">
                                通话轮次：<span class="iparea" style="font-size: 13px;" id="call_time"></span>
                            </div>
                            <div style="margin-top: 5px;font-size: 13px;">
                                主叫号码：<span class="iparea" style="font-size: 13px;" id="originatingCall"></span>
                            </div>
                            <div style="margin-top: 5px;font-size: 13px;">
                                命中关键词：<span class="iparea" style="font-size: 13px;" id="keyNum"></span>
                            </div>


                            <div style="margin-top: 5px;font-size: 13px;">
                                拨打状态:<span style="font-size: 10px;" id="statusinfo"></span>
                            </div>

                            <h4>客户意向评估等级</h4>
                            <div class="dflex">
                                <div class="item" data-v="6" id="level6">
                                    A类<span class="tip">(有明确意向)</span>
                                </div>

                                <div class="item" data-v="5" id="level5">
                                    B类<span class="tip">(可能有意向)</span>
                                </div>

                                <div class="item" data-v="4" id="level4">
                                    C类<span class="tip">(明确拒绝)</span>
                                </div>

                                <div class="item" data-v="3" id="level3">
                                    D类<span class="tip">(用户忙)</span>
                                </div>
                                <div class="item" data-v="2" id="level2">
                                    E类<span class="tip">(拨打失败)</span>
                                </div>
                                <div class="item" data-v="1" id="level1">
                                    F类<span class="tip">(无效客户)</span>
                                </div>
                            </div>
                            <h5 style="text-align:center;color:#909090;margin-top:12px;font-size:12px;">
                                温馨提示：该客户意向评估等级可以修改</h5>

                        </div>

                        <div id="chatcontent" class="content chat-block" tabindex="0">
                            <div class="audio-c">
                                <audio src="" id="record_path" controls="controls"></audio>
                            </div>
                            <div id="msglist">
                            </div>
                        </div>


                    </div>
                </div>

            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消
                </button>
                <!--修改完客户等级了 需要刷新客户 并且关闭通话详情-->
                <button type="button" class="btn btn-primary" onclick="aa();">确认</button>
            </div>
        </div>

    </div>
    <script type="text/javascript">
        //修改完客户等级了 需要刷新客户 并且关闭通话详情
        function aa() {
            $('#call-detail').modal('hide');
            //每次翻页 都会 再id="page" 中储存页码 这样方便我们刷新状态  依旧是还那个页码
            $page = $("#page").val();
            getsearch2($page);
        }

        //查看用户信息 和拨打信息
        function gotoDetail(mobile, taskId, id, froms) {
            if (froms == '') {
                froms = 'record';
            }
            /*
			var see_button = $('.show_record[data-id="' + id + '"]');
			var see_status = see_button.text();
			console.log(see_status);
			if (see_status === '未查看') {
			  see_button.css('color', '#0e90fe');
			  see_button.text('已查看');
			} else if (see_status === '未看') {
			  see_button.css('color', '#0e90fe');
			  see_button.text('已看');
			}
			*/
            // window.location.href = "{:url(\'detail\')}/id/"+uid;
            if (froms == 'record') {
                var data = {
                    'mobile': mobile,
                    'taskId': taskId,
                    'recordId': id,
                    'froms': froms
                };
            } else {
                var data = {
                    id: id
                };
            }
            $.post("{:url('backdetail')}", data, function (data) {
                if (data) {
                    // console.log(data);
                    if (data.code == 0) {
                        var memberInfo = data.data.memberInfo;
                        //通话记录
                        var bills = data.data.bills;
                        if (memberInfo.length == 0 && bills.length == 0) {
                            console.log("暂无数据");
                        }
                        // console.log(memberInfo.nickname);
                        $("#nickname").text(memberInfo.nickname)
                        $("#sex").text(memberInfo.sex);
                        $("#mobile").text(memberInfo.mobile);
                        $("#last_dial_time").text(memberInfo.last_dial_time);

                        $("#duration").text(memberInfo.duration + '秒');
                        $("#call_time").text(memberInfo.call_times + '轮');
                        $("#originatingCall").text(memberInfo.originating_call);
                        $("#keyNum").text(data.data.num);
                        var strstatus = "未拨打";

                        switch (memberInfo.status) {
                            case 2:
                                strstatus = "已接通";
                                break;
                            case 3:
                                strstatus = "无人接听";
                                break;
                            case 4:
                                strstatus = "停机";
                                break;
                            case 5:
                                strstatus = "空号";
                                break;
                            case 6:
                                strstatus = "正在通话中";
                                break;
                            case 7:
                                strstatus = "关机";
                                break;
                            case 8:
                                strstatus = "用户拒接";
                                break;
                            case 9:
                                strstatus = "网络忙";
                                break;
                            case 10:
                                strstatus = "来电提醒";
                                break;
                            case 11:
                                strstatus = "呼叫转移失败";
                                break;
                            default:
                                strstatus = "--";
                                break;
                        }
                        $("#statusinfo").text(strstatus);
                        $(".greenactive").removeClass("greenactive");

                        if (memberInfo.level == 1) {
                            $("#level1").addClass("greenactive");
                        } else if (memberInfo.level == 2) {
                            $("#level2").addClass("greenactive");
                        } else if (memberInfo.level == 3) {
                            $("#level3").addClass("greenactive");
                        } else if (memberInfo.level == 4) {
                            $("#level4").addClass("greenactive");
                        } else if (memberInfo.level == 5) {
                            $("#level5").addClass("greenactive");
                        } else if (memberInfo.level == 6) {
                            $("#level6").addClass("greenactive");
                        }

                        $("#record_path").attr('src', '{:config("oss_domain")}' + memberInfo.record_path);

                        $("#msglist").empty();

                        for (var i = 0; i < bills.length; i++) {

                            var tempbills = bills[i];

                            if (tempbills.role == 0) {
                                var tempstr = '<div class="jimi_lists clearfix">' +
                                    '<div class="header_img  icon iconfont icon-zuoxi1"></div>' +
                                    '<table class="msg" cellspacing="0" cellpadding="0">' +
                                    '<tbody>' +
                                    '<tr>' +
                                    '<td></td>' +
                                    '<td></td>' +
                                    '</tr>' +
                                    '<tr>' +
                                    '<td class="lt"></td>' +
                                    '<td class="tt"></td>' +
                                    '<td class="rt"></td>' +
                                    '</tr>' +
                                    '<tr>' +
                                    '<td class="lm"><span></span></td>' +
                                    '<td class="mm">' +
                                    '<span class="wel"><span class="visitor"><p>' +
                                    '' + tempbills.message + '</p></span></span>' +
                                    '</td>' +
                                    '<td class="rm">' +
                                    '</td>' +
                                    '</tr>' +
                                    '<tr>' +
                                    '<td class="lb"></td>' +
                                    '<td class="bm"></td>' +
                                    '<td class="rb"></td>' +
                                    '</tr>' +
                                    '<tr><td></td></tr>' +
                                    '</tbody>' +
                                    '</table>' +
                                    '</div>';

                            } else {
                                var tempstr = '<div class="customer_lists clearfix">' +
                                    '<div class="header_img jimi3 icon iconfont icon-gerenkehuguanli">' +
                                    '</div>' +
                                    '<table class="msg" cellspacing="0" cellpadding="0">' +
                                    '<tbody>' +
                                    '<tr>' +
                                    '<td></td>' +
                                    '<td></td>' +
                                    '</tr>' +
                                    '<tr>' +
                                    '<td class="lt"></td>' +
                                    '<td class="tt"></td>' +
                                    '<td class="rt"></td>' +
                                    '</tr>'

                                    +
                                    '<tr>' +
                                    '<td class="lm"></td>' +
                                    '<td class="mm">' + tempbills.message + '</td>' +
                                    '<td class="rm"><span></span></td>' +
                                    '</tr>' +
                                    '<tr>' +
                                    '<td class="lb"></td>' +
                                    '<td class="bm"></td>' +
                                    '<td class="rb"></td>' +
                                    '</tr>'

                                    +
                                    '</tbody>' +
                                    '</table>' +
                                    '</div>';

                                if ((tempbills.status == 1) && tempbills.hit_keyword) {
                                    tempstr += '<div class="customer_lists clearfix">' +
                                        '<div class="session-item-left">' +
                                        '<div class="ant-popover-placement ant-popover-placement-left">' +
                                        '<div class="popover-content">【' + tempbills.hit_keyword + '】<br></div>' +
                                        '</div>' +
                                        '</div>' +
                                        '</div>';
                                }
                            }
                            $("#msglist").append(tempstr);
                        }
                        $('#call-detail').modal('show');
                    } else {
                        // console.log(data);
                        alert(data.msg);
                    }
                } else {
                    // console.log(data);
                    //	window.location.href=window.location.href;
                }
            });
            $("#thisId").val(id);
        }

        $('.item').click(function () {
            var level = $(this).attr('data-v'); //要修改的等级
            var uid = $("#thisId").val(); //用户id
            var url = "{:url('changeLevel')}";
            var data = {
                'uid': uid,
                'level': level,
            };
            $.post(url, data, function (res) {
                if (res.code == 0) {

                } else {
                    alert(res.msg);
                }
            });
            $(".greenactive").removeClass("greenactive");
            $(this).addClass("greenactive");
        });

        $(function(){
            var task_id = $('.c_taskleftdata').find('.active').data('id');
            $('#taskexampletaskID').val(task_id);
        })
        function validation2(type){
          <?php if($is_verification == 1): ?>
            $('#tips_model').modal('hide');
            $('#show_validation').html(html);
            $('#export_val').attr('onclick','export_val('+type+')')
            $('#export-validation').modal('show');
            msm_send();
          <?php else: ?>
            $('#tips_model').modal('hide');
            outexcel();
          <?php endif; ?>
        }
        function validation3(type){
            <?php if($is_verification == 1): ?>
              $('#tips_model').modal('hide');
              $('#show_validation2').html(html);
              $('#export_val').attr('onclick','export_val('+type+')')
              $('#export-validation').modal('show');
              msm_send();
            <?php else: ?>
              $('#tips_model').modal('hide');
              outoutexcelNotCall();
            <?php endif; ?>
        }
        function is_timingshow(){
            var task_id = $('.c_taskleftdata').find('.active').data('id');

            //任务详情中显示定时的时间和日期
            $(".timings").hover(function () {
                if($('#is_timing').html() == '是'){
                    $("#timing").removeClass('hide');
                }else{
                    $("#timing").addClass('hide');
                }
            }, function () {
                if($('#is_timing').html() == '是'){
                    $("#timing").addClass('hide');
                }else{
                    $("#timing").addClass('hide');
                }
            });
            $("#timing").hover(function () {
                if($('#is_timing').html() == '是'){
                    $("#timing").removeClass('hide');
                }else{
                    $("#timing").addClass('hide');
                }
            }, function () {
                if($('#is_timing').html() == '是'){
                    $("#timing").addClass('hide');
                }else{
                    $("#timing").addClass('hide');
                }
            });
            var href = "{:url('index/get_date_time')}"
            $.ajax({
                type: "POST",
                dataType: 'json',
                url: href,
                data: {task_id:task_id},
                success: function (data) {
                    console.log(data);
                    var html_date = '';
                    var html_time = '';
                    $.each(data.data.date,function(index,object){
                        html_date +='<p><span>'+object.start_date+'</span><span>~</span><span>'+object.end_date+'</span></p>';
                    })
                    $.each(data.data.time,function(index,object){
                        html_time +='<p><span>'+object.start_time+'</span><span>~</span><span>'+object.end_time+'</span></p>';
                    })
                    $('#timing').find('.timing-time').html(html_time);
                    $('#timing').find('.timing-date').html(html_date);
                },
                error: function (data) {
                }
            })

        }
    </script>
</div>
{include file="public/tageter" /}
{/block}
